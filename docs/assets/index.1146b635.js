var Ct=Object.defineProperty;var _t=Object.getOwnPropertySymbols;var Yt=Object.prototype.hasOwnProperty,zt=Object.prototype.propertyIsEnumerable;var Q=(e,t,n)=>t in e?Ct(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,I=(e,t)=>{for(var n in t||(t={}))Yt.call(t,n)&&Q(e,n,t[n]);if(_t)for(var n of _t(t))zt.call(t,n)&&Q(e,n,t[n]);return e};var a=(e,t,n)=>(Q(e,typeof t!="symbol"?t+"":t,n),n);import{j as $t,a as Bt,F as Gt,_ as P,p as qt,S as Ft}from"./vendor.39f216ad.js";const Ut=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerpolicy&&(o.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?o.credentials="include":i.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}};Ut();function q(e,t,n,s,i,o,r,l,u){return e*i*u+t*o*r+n*s*l-e*o*l-t*s*u-n*i*r}function Wt(e,t,n,s,i,o){const r=q(e,t,1,n,s,1,i,o,1),l=-q(e*e+t*t,t,1,n*n+s*s,s,1,i*i+o*o,o,1),u=q(e*e+t*t,e,1,n*n+s*s,n,1,i*i+o*o,i,1),d=-q(e*e+t*t,e,t,n*n+s*s,n,s,i*i+o*o,i,o);return{x:-l/(2*r),y:-u/(2*r),radius:Math.sqrt(l*l+u*u-4*r*d)/(2*Math.abs(r))}}function g(e,t){return e.toFixed(t).replace(/0+$/,"").replace(/\.$/,"")}const M=30,tt=6,F=6,U=30,Kt="black",Ht="blue",Vt="green";class C{constructor(){a(this,"selected",!1);a(this,"active",!1);a(this,"text","")}curr_colour(){return this.selected?Ht:this.active?Vt:Kt}}var v;(function(e){e[e.POINTER=1]="POINTER",e[e.DRAW_NODE=2]="DRAW_NODE",e[e.DRAW_LINK=3]="DRAW_LINK",e[e.DRAW_ACCEPT=4]="DRAW_ACCEPT",e[e.ELIMINATE=5]="ELIMINATE"})(v||(v={}));var ft;(function(e){e[e.LOAD=1]="LOAD",e[e.SAVE=2]="SAVE",e[e.UNDO=3]="UNDO",e[e.REDO=4]="REDO",e[e.SUBSET_CONSTRUCT=5]="SUBSET_CONSTRUCT",e[e.RESET_ZOOM=6]="RESET_ZOOM",e[e.FORCE_EXPAND=7]="FORCE_EXPAND"})(ft||(ft={}));var W;(function(e){e[e.LEFT=0]="LEFT",e[e.MIDDLE=1]="MIDDLE",e[e.RIGHT=2]="RIGHT"})(W||(W={}));const c=$t,w=Bt,Zt=Gt,Jt=c("svg",{width:"32",height:"32",version:"1.1",viewBox:"0 0 8.4667 8.4667",xmlns:"http://www.w3.org/2000/svg",children:c("path",{d:"m3.1653 7.0667-1.933-5.8264 5.7157 2.768-2.9306 0.50995z",fill:"none",stroke:"#000","stroke-width":".6"})}),Qt=w("svg",{width:"32",height:"32",version:"1.1",viewBox:"0 0 8.4667 8.4667",xmlns:"http://www.w3.org/2000/svg",children:[c("defs",{children:c("linearGradient",{id:"linearGradient1456",x1:"-.20338",x2:"6.9917",y1:"4.8619",y2:"4.8619",gradientTransform:"matrix(.90021 0 0 .90021 .43043 .48516)",gradientUnits:"userSpaceOnUse",children:c("stop",{offset:"0"})})}),w("g",{"fill-opacity":"0",children:[c("path",{d:"m6.232 3.9065c0.10409 0.29923 0.16065 0.6207 0.16065 0.95539-1e-7 1.6054-1.3014 2.9068-2.9068 2.9068s-2.9068-1.3014-2.9068-2.9068c-6e-8 -1.6054 1.3014-2.9068 2.9068-2.9068 0.79428 0 1.5142 0.31857 2.0388 0.83491",stroke:"url(#linearGradient1456)","stroke-width":".6"}),c("path",{d:"m7.3871 0.89393c0.49447 0.28548 0.48084 0.27601 0.20293 0.75735l-2.6045 4.5111c-1.0851 0.77062-0.81911 0.9242-1.0851 0.77062s0 0 0.12482-1.325l2.6045-4.5111c0.27791-0.48135 0.27693-0.48031 0.75735-0.20293z",stroke:"#000","stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":"7.7","stroke-width":".6"})]})]}),te=w("svg",{width:"32",height:"32",version:"1.1",viewBox:"0 0 8.4667 8.4667",xmlns:"http://www.w3.org/2000/svg",children:[c("defs",{children:c("linearGradient",{id:"linearGradient1456",x1:"-.20338",x2:"6.9917",y1:"4.8619",y2:"4.8619",gradientTransform:"matrix(.90021 0 0 .90021 .43043 .48516)",gradientUnits:"userSpaceOnUse",children:c("stop",{offset:"0"})})}),w("g",{"fill-opacity":"0","stroke-linecap":"round",children:[c("path",{d:"m3.4859 7.7687c-1.6054 0-2.9068-1.3014-2.9068-2.9068-5e-8 -1.3719 0.9504-2.5218 2.2287-2.8273",stroke:"url(#linearGradient1456)","stroke-width":".6"}),c("path",{d:"m7.3871 0.89393c0.49447 0.28548 0.48084 0.27601 0.20293 0.75735l-2.6045 4.5111c-1.0851 0.77062-0.81911 0.9242-1.0851 0.77062s0 0 0.12482-1.325l2.6045-4.5111c0.27791-0.48135 0.27693-0.48031 0.75735-0.20293z",stroke:"#000","stroke-linejoin":"round","stroke-miterlimit":"7.7","stroke-width":".6"}),c("path",{d:"m4.5891 2.0245-1.7057 0.9848v-0.9848-0.9848l0.85286 0.4924z",stroke:"#000","stroke-miterlimit":"7.7","stroke-width":".6"})]})]}),ee=w("svg",{width:"32",height:"32",version:"1.1",viewBox:"0 0 8.4667 8.4667",xmlns:"http://www.w3.org/2000/svg",children:[c("defs",{children:c("linearGradient",{id:"linearGradient1456",x1:"-.20338",x2:"6.9917",y1:"4.8619",y2:"4.8619",gradientTransform:"matrix(.90021 0 0 .90021 .43043 .48516)",gradientUnits:"userSpaceOnUse",children:c("stop",{offset:"0"})})}),w("g",{"fill-opacity":"0","stroke-width":".6",children:[c("path",{d:"m6.232 3.9065c0.10409 0.29923 0.16065 0.6207 0.16065 0.95539-1e-7 1.6054-1.3014 2.9068-2.9068 2.9068s-2.9068-1.3014-2.9068-2.9068c-6e-8 -1.6054 1.3014-2.9068 2.9068-2.9068 0.79428 0 1.5142 0.31857 2.0388 0.83491",stroke:"url(#linearGradient1456)"}),c("path",{d:"m7.3871 0.89393c0.49447 0.28548 0.48084 0.27601 0.20293 0.75735l-2.6045 4.5111c-1.0851 0.77062-0.81911 0.9242-1.0851 0.77062s0 0 0.12482-1.325l2.6045-4.5111c0.27791-0.48135 0.27693-0.48031 0.75735-0.20293z",stroke:"#000","stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":"7.7"}),c("path",{d:"m3.9484 6.6643c-0.14786 0.037828-0.30282 0.05794-0.46248 0.05794-1.0274 0-1.8603-0.8329-1.8603-1.8603s0.8329-1.8603 1.8603-1.8603c0.63874 0 1.2023 0.32192 1.5373 0.81236",stroke:"#000"})]})]}),ne=w("svg",{width:"32",height:"32",version:"1.1",viewBox:"0 0 8.4667 8.4667",xmlns:"http://www.w3.org/2000/svg",children:[c("defs",{children:c("linearGradient",{id:"linearGradient1456",x1:"-.20338",x2:"6.9917",y1:"4.8619",y2:"4.8619",gradientTransform:"matrix(.90021 0 0 .90021 .43043 .48516)",gradientUnits:"userSpaceOnUse",children:c("stop",{offset:"0"})})}),c("text",{transform:"scale(1.0175 .98284)",x:"3.9714818",y:"4.2760758",fill:"#000000","font-family":"sans-serif","font-size":"5.6444px","stroke-miterlimit":"5.85","stroke-width":".2",style:"line-height:0.15",children:c("tspan",{x:"3.9714818",y:"4.2760758","font-family":"Times","font-size":"5.6444px",stroke:"#000000","stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":"5.85","stroke-width":".2",children:".*"})}),c("path",{d:"m3.4859 7.7687c-1.6054 0-2.9068-1.3014-2.9068-2.9068-5e-8 -1.3719 0.9504-2.5218 2.2287-2.8273","fill-opacity":"0",stroke:"url(#linearGradient1456)","stroke-linecap":"round","stroke-width":".6"}),c("path",{d:"m4.5891 2.0245-1.7057 0.9848v-0.9848-0.9848l0.85286 0.4924z","fill-opacity":"0",stroke:"#000","stroke-linecap":"round","stroke-miterlimit":"7.7","stroke-width":".6"})]}),se=w("svg",{width:"48",height:"48",version:"1.1",viewBox:"0 0 12.7 12.7",xmlns:"http://www.w3.org/2000/svg",children:[w("g",{children:[c("g",{transform:"matrix(.49129 0 0 .49129 3.58 6.7208)","aria-label":"D",children:c("path",{d:"m10.787 8.1542q0 0.25838 0.12402 0.34106 0.12919 0.082682 0.5271 0.082682 1.2402 0 2.0412-0.49092 1.2299-0.75447 1.2299-2.5786 0-1.6278-1.0129-2.4495-0.86816-0.7028-2.2996-0.7028-0.35657 0-0.48576 0.077514-0.12402 0.077514-0.12402 0.34106zm-2.005 0.62528q0.57877-0.062012 0.75447-0.20671 0.1757-0.14986 0.1757-0.74931v-4.7077q0-0.57877-0.17053-0.74414-0.17053-0.16536-0.75964-0.20671v-0.19637h2.8525q1.4418 0 2.4391 0.47542 1.7983 0.85266 1.7983 3.0489 0 0.79065-0.32556 1.5038-0.32039 0.71313-0.97151 1.2041-0.41341 0.31006-0.85783 0.47025-0.81132 0.29972-1.9947 0.29972h-2.9404z","stroke-width":".53855"})}),c("path",{d:"m2.2843 5.201q0.29643-0.013982 0.38872-0.10906 0.095082-0.097878 0.095082-0.40829v-1.7954h-0.4782v-0.18737h0.4782q0-0.44185 0.12025-0.74667 0.22931-0.58447 0.84175-0.58447 0.24609 0 0.43905 0.097878 0.19576 0.097878 0.19576 0.26287 0 0.092285-0.067116 0.16499-0.067116 0.072709-0.1622 0.072709-0.0811 0-0.13983-0.047541-0.058727-0.050337-0.13983-0.17338l-0.047541-0.072709q-0.039151-0.058727-0.092285-0.097878-0.053134-0.041948-0.14822-0.041948-0.21254 0-0.28804 0.20974-0.041948 0.11186-0.041948 0.29363v0.66277h0.70193v0.18737h-0.69633v1.7954q0 0.31601 0.083896 0.40549 0.086692 0.086692 0.44744 0.11186v0.078303h-1.4905z"}),c("g",{transform:"matrix(1.3529 0 0 1.3529 -1.0931 -2.6215)","aria-label":"s",children:c("path",{d:"m7.1126 4.701h0.068213q0.047542 0.23564 0.12816 0.36173 0.14469 0.23151 0.42375 0.23151 0.15503 0 0.24391-0.084749 0.09095-0.086816 0.09095-0.22324 0-0.086816-0.051676-0.16743-0.051677-0.080615-0.1819-0.1571l-0.23151-0.13229q-0.25425-0.13643-0.37414-0.27492-0.11989-0.13849-0.11989-0.32659 0-0.23151 0.16536-0.38034t0.41548-0.14883q0.10955 0 0.23978 0.041341 0.13229 0.041341 0.14883 0.041341 0.037207 0 0.053743-0.010335t0.028939-0.033073h0.049609l0.014469 0.57671h-0.064078q-0.041341-0.2005-0.11162-0.31213-0.12816-0.20671-0.37-0.20671-0.14469 0-0.22738 0.088883-0.082682 0.088883-0.082682 0.20877 0 0.19017 0.28525 0.339l0.27285 0.14676q0.44028 0.23978 0.44028 0.5581 0 0.24391-0.18397 0.39894-0.1819 0.15503-0.47749 0.15503-0.12402 0-0.28112-0.041341-0.1571-0.041341-0.18604-0.041341-0.024805 0-0.043408 0.018604-0.018604 0.016536-0.028939 0.041341h-0.053743z","stroke-width":".19557"})}),c("g",{transform:"matrix(1.131 0 0 1.131 -2.8973 1.1692)","aria-label":"m",children:c("path",{d:"m3.8942 8.1695q0.16123-0.014469 0.21497-0.053743 0.082682-0.059945 0.082682-0.23978v-1.0687q0-0.15296-0.041341-0.2005-0.039274-0.047542-0.13229-0.047542-0.043408 0-0.066146 0.00413-0.020671 0.00413-0.049609 0.014469v-0.072347l0.14883-0.049609q0.080615-0.026872 0.26458-0.097152 0.18397-0.07028 0.1943-0.07028 0.010335 0 0.012402 0.010335 0.00207 0.010335 0.00207 0.039274v0.27905q0.20464-0.18604 0.35347-0.25631 0.14883-0.072347 0.30592-0.072347 0.21291 0 0.339 0.14469 0.066146 0.078548 0.10955 0.21291 0.15296-0.15502 0.26665-0.22944 0.19637-0.12816 0.40101-0.12816 0.3328 0 0.44442 0.27078 0.064079 0.15296 0.064079 0.48369v0.85783q0 0.14676 0.064079 0.2005 0.066146 0.051676 0.23564 0.068213v0.053743h-0.93224v-0.057877q0.17983-0.016536 0.23564-0.072347 0.057878-0.05581 0.057878-0.22738v-0.8909q0-0.2005-0.043408-0.29559-0.076481-0.1695-0.29972-0.1695-0.13436 0-0.26665 0.088883-0.076481 0.051676-0.1881 0.16536v1.0583q0 0.16743 0.057878 0.25425 0.059945 0.086816 0.25011 0.093018v0.053743h-0.94878v-0.053743q0.19637-0.024805 0.25011-0.095085 0.053743-0.07028 0.053743-0.3452v-0.57878q0-0.31833-0.041341-0.43822-0.068213-0.20257-0.28939-0.20257-0.12609 0-0.24805 0.07028-0.12196 0.068213-0.21497 0.17983v1.1307q0 0.1571 0.053744 0.21704 0.05581 0.059945 0.23978 0.062012v0.053743h-0.94051z","stroke-width":".23394"})}),c("path",{d:"m6.8544 3.3246-0.49723 0.28708v-0.57415z","stop-color":"#000000",stroke:"#000","stroke-linecap":"round","stroke-width":".1"}),c("path",{d:"m6.8544 9.3714-0.49723 0.28708v-0.57415z","stop-color":"#000000",stroke:"#000","stroke-linecap":"round","stroke-width":".1"})]}),w("g",{"fill-opacity":"0",stroke:"#000","stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":"5.85","stroke-width":".1",children:[c("circle",{cx:"3.3246",cy:"3.3246",r:"2.42","stop-color":"#000000",style:"font-variation-settings:normal"}),c("circle",{cx:"9.3754",cy:"3.3246",r:"2.42","stop-color":"#000000",style:"font-variation-settings:normal"}),c("circle",{cx:"9.3754",cy:"9.3754",r:"2.42","stop-color":"#000000",style:"font-variation-settings:normal"}),c("circle",{cx:"3.3246",cy:"9.3754",r:"2.42","stop-color":"#000000",style:"font-variation-settings:normal"})]}),w("g",{fill:"none",stroke:"#000","stroke-width":".15",children:[c("path",{d:"m5.7446 3.3246h0.6121"}),c("path",{d:"m7.7082 5.145-2.233 2.0818"}),c("path",{d:"m5.7446 9.3754h0.62902"})]}),c("path",{transform:"rotate(135 5.9432 7.5856)",d:"m6.5324 8.1792-0.49723 0.28708v-0.57415z","stop-color":"#000000",stroke:"#000","stroke-linecap":"round","stroke-width":".1"})]});const et={[v.POINTER]:"Select: Click on a node or a link to select it.",[v.DRAW_NODE]:"Draw Node: Click anywhere to create a new node.",[v.DRAW_LINK]:"Draw Link: Click and drag from and to nodes to create transition links.",[v.DRAW_ACCEPT]:"Draw Accept: Click on a state to toggle its accepting status.",[v.ELIMINATE]:"Eliminate: Click on a state to eliminate it, creating partial regular expressions if necessary."};class ie extends P{constructor(){super();z(["curr_tool"],this)}render(){return w("div",{id:"toolbar",children:[c(Y,{tooltip:"Select",icon:Jt,tool_mode:v.POINTER}),c(Y,{tooltip:"Draw Node (Dbl Click)",icon:Qt,tool_mode:v.DRAW_NODE}),c(Y,{tooltip:"Draw Link (Shift)",icon:te,tool_mode:v.DRAW_LINK}),c(Y,{tooltip:"Make Accepting State (Dbl Click)",icon:ee,tool_mode:v.DRAW_ACCEPT}),c(Y,{tooltip:"Eliminate State",icon:ne,tool_mode:v.ELIMINATE})]})}}class Y extends P{constructor(t){super(t);a(this,"mutator",t=>{if(t.curr_tool!=this.props.tool_mode)return t.curr_tool=this.props.tool_mode,["curr_tool"]})}render(){return c("div",{class:`tool-container ${this.props.tool_mode==x("curr_tool")?"selected":""}`,"data-tooltip":this.props.tooltip,onClick:t=>_(this.mutator),children:this.props.icon})}}class O extends C{constructor(t,n){super();a(this,"node");a(this,"text");a(this,"anchorAngle");a(this,"mouseOffsetAngle");this.node=t,this.anchorAngle=0,this.mouseOffsetAngle=0,this.text="",n&&this.set_anchor_point(n.x,n.y)}set_mouse_start(t,n){this.mouseOffsetAngle=this.anchorAngle-Math.atan2(n-this.node.y,t-this.node.x)}set_anchor_point(t,n){this.anchorAngle=Math.atan2(n-this.node.y,t-this.node.x)+this.mouseOffsetAngle;const s=Math.round(this.anchorAngle/(Math.PI/2))*(Math.PI/2);Math.abs(this.anchorAngle-s)<.1&&(this.anchorAngle=s),this.anchorAngle<-Math.PI&&(this.anchorAngle+=2*Math.PI),this.anchorAngle>Math.PI&&(this.anchorAngle-=2*Math.PI)}get_endpoints_and_circle(){const t=this.node.x+1.5*M*Math.cos(this.anchorAngle),n=this.node.y+1.5*M*Math.sin(this.anchorAngle),s=.75*M,i=this.anchorAngle-Math.PI*.8,o=this.anchorAngle+Math.PI*.8,r=t+s*Math.cos(i),l=n+s*Math.sin(i),u=t+s*Math.cos(o),d=n+s*Math.sin(o);return{hasCircle:!0,startX:r,startY:l,endX:u,endY:d,startAngle:i,endAngle:o,circleX:t,circleY:n,circleRadius:s}}draw(t,n=!1){const s=this.get_endpoints_and_circle();t.beginPath(),t.arc(s.circleX,s.circleY,s.circleRadius,s.startAngle,s.endAngle,!1),t.stroke();const i=s.circleX+s.circleRadius*Math.cos(this.anchorAngle),o=s.circleY+s.circleRadius*Math.sin(this.anchorAngle);$(t,this.text,i,o,this.anchorAngle,this.selected,n),B(t,s.endX,s.endY,s.endAngle+Math.PI*.4)}contains_point(t){const n=this.get_endpoints_and_circle(),s=t.x-n.circleX,i=t.y-n.circleY,o=Math.sqrt(s*s+i*i)-n.circleRadius;return Math.abs(o)<F}}class D extends C{constructor(t,n){super();a(this,"node");a(this,"deltaX");a(this,"deltaY");a(this,"text");this.node=t,this.deltaX=0,this.deltaY=0,this.text="",n&&this.set_anchor_point(n.x,n.y)}set_anchor_point(t,n){this.deltaX=t-this.node.x,this.deltaY=n-this.node.y,Math.abs(this.deltaX)<tt&&(this.deltaX=0),Math.abs(this.deltaY)<tt&&(this.deltaY=0)}get_start_point(){return{x:this.node.x+this.deltaX,y:this.node.y+this.deltaY}}get_endpoints(){const t=this.node.x+this.deltaX,n=this.node.y+this.deltaY,s=this.node.closest_point_on_circle(t,n);return{startX:t,startY:n,endX:s.x,endY:s.y}}draw(t,n=!1){const s=this.get_endpoints();t.beginPath(),t.moveTo(s.startX,s.startY),t.lineTo(s.endX,s.endY),t.stroke();const i=Math.atan2(s.startY-s.endY,s.startX-s.endX);$(t,this.text,s.startX,s.startY,i,this.selected,n),B(t,s.endX,s.endY,Math.atan2(-this.deltaY,-this.deltaX))}contains_point(t){const n=t.x,s=t.y,i=this.get_endpoints(),o=i.endX-i.startX,r=i.endY-i.startY,l=Math.sqrt(o*o+r*r),u=(o*(n-i.startX)+r*(s-i.startY))/(l*l),d=(o*(s-i.startY)-r*(n-i.startX))/l;return u>0&&u<1&&Math.abs(d)<F}}class y extends C{constructor(t,n){super();a(this,"x");a(this,"y");a(this,"mouseOffsetX");a(this,"mouseOffsetY");a(this,"isAcceptState");a(this,"text");this.x=t,this.y=n,this.mouseOffsetX=0,this.mouseOffsetY=0,this.isAcceptState=!1,this.text=""}set_mouse_start(t,n){this.mouseOffsetX=this.x-t,this.mouseOffsetY=this.y-n}set_anchor_point(t,n){this.x=t+this.mouseOffsetX,this.y=n+this.mouseOffsetY}draw(t,n=!1){t.beginPath(),t.arc(this.x,this.y,M,0,2*Math.PI,!1),t.stroke(),$(t,this.text,this.x,this.y,null,this.selected,n),this.isAcceptState&&(t.beginPath(),t.arc(this.x,this.y,M-6,0,2*Math.PI,!1),t.stroke())}closest_point_on_circle(t,n){const s=t-this.x,i=n-this.y,o=Math.sqrt(s*s+i*i);return{x:this.x+s*M/o,y:this.y+i*M/o}}contains_point(t){return(t.x-this.x)*(t.x-this.x)+(t.y-this.y)*(t.y-this.y)<M*M}}function K(e){typeof window!="undefined"&&localStorage&&JSON&&(localStorage.fsm=V(e))}function oe(e){if(typeof window!="undefined"){if(!localStorage||!JSON)return;try{const t=localStorage.getItem("fsm");if(t!=null){const n=H(t);e.nodes=n.nodes,e.links=n.links}}catch{localStorage.fsm=""}return["nodes","links"]}}function H(e){const t=[],n=[];if(!JSON)return{nodes:t,links:n};const s=JSON.parse(e);for(let i=0;i<s.nodes.length;i++){const o=s.nodes[i],r=new y(o.x,o.y);r.isAcceptState=o.isAcceptState,r.text=o.text,t.push(r)}for(let i=0;i<s.links.length;i++){const o=s.links[i];let r=null;o.type=="SelfLink"?(r=new O(t[o.node]),r.anchorAngle=o.anchorAngle,r.text=o.text):o.type=="StartLink"?(r=new D(t[o.node]),r.deltaX=o.deltaX,r.deltaY=o.deltaY,r.text=o.text):(o.type=="NodeLink"||o.type=="Link")&&(r=new S(t[o.nodeA],t[o.nodeB]),r.parallelPart=o.parallelPart,r.perpendicularPart=o.perpendicularPart,r.text=o.text,r.lineAngleAdjust=o.lineAngleAdjust),r!=null&&n.push(r)}return{nodes:t,links:n}}function V(e){if(!JSON)return"";const t=e.nodes,n=e.links,s={nodes:[],links:[]};for(let i=0;i<t.length;i++){const o=t[i];let r={x:o.x,y:o.y,text:o.text,isAcceptState:o.isAcceptState};s.nodes.push(r)}for(let i=0;i<n.length;i++){const o=n[i];let r;o instanceof O?r={type:"SelfLink",node:t.indexOf(o.node),text:o.text,anchorAngle:o.anchorAngle}:o instanceof D?r={type:"StartLink",node:t.indexOf(o.node),text:o.text,deltaX:o.deltaX,deltaY:o.deltaY}:o instanceof S&&(r={type:"NodeLink",nodeA:t.indexOf(o.nodeA),nodeB:t.indexOf(o.nodeB),text:o.text,lineAngleAdjust:o.lineAngleAdjust,parallelPart:o.parallelPart,perpendicularPart:o.perpendicularPart}),r!=null&&s.links.push(r)}return JSON.stringify(s)}let T=[],E="",R=[];function re(e){return T=[],R=[],E=V(e),e.can={undo:!1,redo:!1},["can"]}function nt(e){const t=V(e);E!=t&&(T.push(E),E=t,R=[])}function pt(e){if(e.selected_object!=null)return e.selected_object.selected=!1,e.selected_object=void 0,["selected_object"]}function mt(e){if(_(pt),T.length>0){let t=T.pop();R.push(E),E=t;const n=H(t);return e.nodes=n.nodes,e.links=n.links,e.can.undo=T.length>0,e.can.redo=R.length>0,e.textbar="Undo.",["nodes","links","can","textbar"]}else return console.warn("Tried to undo with no actions to undo."),e.textbar="Nothing left to undo!",["textbar"]}function st(e){_(pt);let t=R.pop();if(t!=null){T.push(E),E=t;const n=H(t);return e.nodes=n.nodes,e.links=n.links,e.can.undo=T.length>0,e.can.redo=R.length>0,e.textbar="Redo.",["nodes","links","can","textbar"]}else return console.warn("Tried to redo with no actions to redo."),e.textbar="Nothing left to redo!",["textbar"]}function ce(e){e.last_tool=e.curr_tool,e.textbar=et[e.curr_tool],ct(["textbar"])}function le(e){e.canvas.draw()}function gt(e){document.title=`fsmD \u2014 ${e.file_name}`}const N={temp_link:void 0,canvas:void 0,view_zone:{zoom:1,x:0,y:0},export_dimensions:{width:800,height:600},active_objects:[],selected_object:void 0,nodes:[],links:[],last_tool:v.POINTER,curr_tool:v.POINTER,curr_menu:void 0,can:{undo:!1,redo:!1},textbar:"Welcome to fsmD. Draw and convert finite state machines.",file_name:"untitled"},L={temp_link:[],canvas:[],view_zone:[],export_dimensions:[],active_objects:[],selected_object:[],nodes:[],links:[],last_tool:[],curr_tool:[],curr_menu:[],can:[],textbar:[],file_name:[]},ae={temp_link:[],canvas:[le],view_zone:[],export_dimensions:[],active_objects:[],selected_object:[nt,K],nodes:[nt,K],links:[nt,K],last_tool:[],curr_tool:[ce],curr_menu:[],can:[],textbar:[],file_name:[gt]},xt=new Map;function z(e,t){for(const n of e)L[n].includes(t)||L[n].push(t);xt.set(t,e)}function he(e){const t=xt.get(e);if(t!=null)for(let n of t)for(let s=L[n].length-1;s>=0;s--)e==L[n][s]&&(L[n].splice(s,1),s--)}let it;function ot(){return it}function de(e){it==null&&(it=e),N.canvas=e}function rt(e){const t=[];for(const n of e)for(const s of ae[n])t.includes(s)||t.push(s);for(const n of t)n(N)}function vt(e,t=!0,...n){let s=e(N,...n);s!=null&&(t&&rt(s),lt(s))}function _(e,t=!0){let n=e(N);n!=null&&(t&&rt(n),lt(n))}function ct(e){lt(e),rt(e)}function x(e){return N[e]}function ue(e){return e(N)}function lt(e){const t=[];for(const n of e)for(const s of L[n])t.includes(s)||t.push(s);for(const n of t)n.setState({})}const wt=["Alpha","Beta","Gamma","Delta","Epsilon","Zeta","Eta","Theta","Iota","Kappa","Lambda","Mu","Nu","Xi","Omicron","Pi","Rho","Sigma","Tau","Upsilon","Phi","Chi","Psi","Omega"];function $(e,t,n,s,i,o,r=!1){const l=bt(t);e.font='20px "Times New Roman", serif';const u=kt(l);if(n-=u/2,i!=null){const d=Math.cos(i),h=Math.sin(i),p=(u/2+5)*(d>0?1:-1),m=(10+5)*(h>0?1:-1),k=h*Math.pow(Math.abs(h),40)*p-d*Math.pow(Math.abs(d),10)*m;n+=p-h*k,s+=m+d*k}"advancedFillText"in e?e.advancedFillText(l,t,n+u/2,s,i):(n=Math.round(n),s=Math.round(s),e.fillText(l,n,s+6),o&&r&&document.hasFocus()&&(n+=u,e.beginPath(),e.moveTo(n,s-10),e.lineTo(n,s+10),e.stroke()))}function B(e,t,n,s){const i=Math.cos(s),o=Math.sin(s);e.beginPath(),e.moveTo(t,n),e.lineTo(t-8*i+5*o,n-8*o-5*i),e.lineTo(t-8*i-5*o,n-8*o+5*i),e.fill()}function kt(e){const t=ot();if(t!=null){const n=t.ctx;if(n!=null)return n.font='20px "Times New Roman", serif',n.measureText(e).width}return 0}function bt(e){for(let t=0;t<wt.length;t++){const n=wt[t];e=e.replace(new RegExp("\\\\"+n,"g"),String.fromCharCode(913+t+ +(t>16))),e=e.replace(new RegExp("\\\\"+n.toLowerCase(),"g"),String.fromCharCode(945+t+ +(t>16)))}for(let t=0;t<10;t++)e=e.replace(new RegExp("_"+t,"g"),String.fromCharCode(8320+t));return e}function _e(e){e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");let t="";for(let n=0;n<e.length;n++){let s=e.charCodeAt(n);s>=32&&s<=126?t+=e[n]:t+="&#"+s+";"}return t}class S extends C{constructor(t,n){super();a(this,"nodeA");a(this,"nodeB");a(this,"text");a(this,"lineAngleAdjust");a(this,"parallelPart");a(this,"perpendicularPart");this.nodeA=t,this.nodeB=n,this.text="",this.lineAngleAdjust=0,this.parallelPart=.5,this.perpendicularPart=0}get_anchor_point(){const t=this.nodeB.x-this.nodeA.x,n=this.nodeB.y-this.nodeA.y,s=Math.sqrt(t*t+n*n);return{x:this.nodeA.x+t*this.parallelPart-n*this.perpendicularPart/s,y:this.nodeA.y+n*this.parallelPart+t*this.perpendicularPart/s}}set_anchor_point(t,n){const s=this.nodeB.x-this.nodeA.x,i=this.nodeB.y-this.nodeA.y,o=Math.sqrt(s*s+i*i);this.parallelPart=(s*(t-this.nodeA.x)+i*(n-this.nodeA.y))/(o*o),this.perpendicularPart=(s*(n-this.nodeA.y)-i*(t-this.nodeA.x))/o,this.parallelPart>0&&this.parallelPart<1&&Math.abs(this.perpendicularPart)<tt&&(this.lineAngleAdjust=+(this.perpendicularPart<0)*Math.PI,this.perpendicularPart=0)}get_endpoints_and_circle(){if(this.perpendicularPart==0){const p=(this.nodeA.x+this.nodeB.x)/2,m=(this.nodeA.y+this.nodeB.y)/2,k=this.nodeA.closest_point_on_circle(p,m),b=this.nodeB.closest_point_on_circle(p,m);return{hasCircle:!1,startX:k.x,startY:k.y,endX:b.x,endY:b.y}}const t=this.get_anchor_point(),n=Wt(this.nodeA.x,this.nodeA.y,this.nodeB.x,this.nodeB.y,t.x,t.y),s=this.perpendicularPart>0,i=s?1:-1,o=Math.atan2(this.nodeA.y-n.y,this.nodeA.x-n.x)-i*M/n.radius,r=Math.atan2(this.nodeB.y-n.y,this.nodeB.x-n.x)+i*M/n.radius,l=n.x+n.radius*Math.cos(o),u=n.y+n.radius*Math.sin(o),d=n.x+n.radius*Math.cos(r),h=n.y+n.radius*Math.sin(r);return{hasCircle:!0,startX:l,startY:u,endX:d,endY:h,startAngle:o,endAngle:r,circleX:n.x,circleY:n.y,circleRadius:n.radius,reverseScale:i,isReversed:s}}draw(t,n=!1){const s=this.get_endpoints_and_circle();if(t.beginPath(),s.hasCircle?t.arc(s.circleX,s.circleY,s.circleRadius,s.startAngle,s.endAngle,s.isReversed):(t.moveTo(s.startX,s.startY),t.lineTo(s.endX,s.endY)),t.stroke(),s.hasCircle?B(t,s.endX,s.endY,s.endAngle-s.reverseScale*(Math.PI/2)):B(t,s.endX,s.endY,Math.atan2(s.endY-s.startY,s.endX-s.startX)),s.hasCircle){let i=s.startAngle,o=s.endAngle;o<i&&(o+=Math.PI*2);const r=(i+o)/2+ +s.isReversed*Math.PI,l=s.circleX+s.circleRadius*Math.cos(r),u=s.circleY+s.circleRadius*Math.sin(r);$(t,this.text,l,u,r,this.selected,n)}else{const i=(s.startX+s.endX)/2,o=(s.startY+s.endY)/2,r=Math.atan2(s.endX-s.startX,s.startY-s.endY);$(t,this.text,i,o,r+this.lineAngleAdjust,this.selected,n)}}contains_point(t){const n=t.x,s=t.y,i=this.get_endpoints_and_circle();if(i.hasCircle){const o=n-i.circleX,r=s-i.circleY,l=Math.sqrt(o*o+r*r)-i.circleRadius;if(Math.abs(l)<F){let u=Math.atan2(r,o),d=i.startAngle,h=i.endAngle;if(i.isReversed){const p=d;d=h,h=p}return h<d&&(h+=Math.PI*2),u<d?u+=Math.PI*2:u>h&&(u-=Math.PI*2),u>d&&u<h}}else{const o=i.endX-i.startX,r=i.endY-i.startY,l=Math.sqrt(o*o+r*r),u=(o*(n-i.startX)+r*(s-i.startY))/(l*l),d=(o*(s-i.startY)-r*(n-i.startX))/l;return u>0&&u<1&&Math.abs(d)<F}return!1}}const f={CONCAT:"*&*",KLEIN:"*",OR:"+",OPEN_LEFT:"(",CLOSE_RIGHT:")"},fe=[f.OR,f.OPEN_LEFT,f.CLOSE_RIGHT],pe=[f.CONCAT,f.OR],me=[f.KLEIN],ge=[f.OPEN_LEFT,f.OR,f.CONCAT,f.KLEIN],xe=[f.CLOSE_RIGHT,f.OR,f.CONCAT],yt={[f.KLEIN]:8,[f.CONCAT]:4,[f.OR]:2},G="\\epsilon";function ve(e){const t=we(e),n=[],s=[];for(let o=0;o<t.length;o++){const r=t[o];if(r==f.KLEIN)s.push(r);else if(pe.includes(r)){for(;s.length>0;){let l=s[s.length-1];if(l!=f.OPEN_LEFT&&yt[l]>=yt[r]){const u=s.pop();u!=null&&n.push(u)}else break}s.push(r)}else if(r==f.OPEN_LEFT)s.push(r);else if(r==f.CLOSE_RIGHT){for(;s.length>0&&s[s.length-1]!=f.OPEN_LEFT;){const u=s.pop();u!=null&&n.push(u)}if(s.length==0&&console.error("The operator stack is empty, fix the parentheses."),s.pop(),s.length>0&&me.includes(s[length-1])){const l=s.pop();l!=null&&n.push(l)}}else n.push(r)}let i=s.pop();for(;i!=null;)n.push(i),i=s.pop();return n}function we(e){e=e.replace(/(\w)\*/g,"($1)*"),e=bt(e);const t=[];let n=0,s=0;for(;s<e.length;){if(fe.includes(e[s]))n!=s&&t.push(e.slice(n,s)),n=s+1,t.push(e[s]);else if(e[s]==f.KLEIN){let i=t.length-1,o=0;for(;i>=0&&(t[i]==f.CLOSE_RIGHT?o++:t[i]==f.OPEN_LEFT&&o--,o!=0);)i--;t.splice(i,0,e[s]),n=s+1}s++}for(n!=s&&t.push(e.slice(n)),s=t.length-1;s>0;)!ge.includes(t[s-1])&&!xe.includes(t[s])&&t.splice(s,0,f.CONCAT),s--;return t}function at(e,t){for(const n of t)e.includes(n)||e.push(n)}function j(e){return e instanceof y?`${e.text}:${e.x},${e.y}`:e instanceof S?`${j(e.nodeA)}->${j(e.nodeB)}:${e.text}${e.get_anchor_point().x},${e.get_anchor_point().y}`:e instanceof D?`${j(e.node)}:${e.get_start_point().x},${e.get_start_point().y}`:JSON.stringify(e)}function At(){const e=ot(),t=x("export_dimensions");return e!=null&&e.el!=null?{x:Math.random()*(t.width-2*U)+U,y:Math.random()*(t.height-2*U)+U}:{x:0,y:0}}function ke(e,t,n){if(e.isAcceptState)return!1;const s=[],i=[],o=[],r=[];for(let d=0;d<n.length;d++){const h=n[d];if(h instanceof O&&h.node==e)o.push(h);else if(h instanceof S)h.nodeA==e?i.push(h):h.nodeB==e&&s.push(h);else if(h instanceof D&&h.node==e)return!1}let l="";if(o.length>0){const d=[];for(let h=0;h<o.length;h++)d.push(...o[h].text.split(","));d.length==1&&d[0].length==1?l=`${d[0]}*`:d.length>0&&(l=`(${d.join("+")})*`)}for(let d=0;d<s.length;d++){const h=s[d];for(let p=0;p<i.length;p++){const m=i[p];let k,b;b=`${Mt(h.text.split(",").map(X=>X.trim()).join("+"))}${l}${Mt(m.text.split(",").map(X=>X.trim()).join("+"))}`,h.nodeA==m.nodeB?k=new O(h.nodeA):k=new S(h.nodeA,m.nodeB),b=Ae(be(b)),k.text=b,n.push(k)}}let u=n.length;for(;u--;)(s.some(d=>d==n[u])||i.some(d=>d==n[u])||o.some(d=>d==n[u]))&&n.splice(u,1);t.splice(t.indexOf(e),1);for(let d=0;d<r.length;d++)n.push(r[d]);return ye(n),!0}function be(e){return e.replace(new RegExp(`/([)*w])(${G})/g`),"$1").replace(new RegExp(`/(${G})([(w])/g`),"$2")}function ye(e){const t=[],n=new Map;for(let i=0;i<e.length;i++){const o=e[i];if(o instanceof O){let r=j(o.node);const l=n.get(r);l!=null?l.push(o):n.set(r,[o])}else if(o instanceof S){let r=j(o.nodeA)+j(o.nodeB);const l=n.get(r);l!=null?l.push(o):n.set(r,[o])}}for(const i of n.values())if(i.length>1){i[0].text=`${i.map(o=>o.text).join("+")}`;for(let o=1;o<i.length;o++)t.push(i[o])}let s=e.length;for(;s--;)t.includes(e[s])&&e.splice(s,1)}function Mt(e){if(e.includes("+")){let t=ve(e);if(t.length>0&&t[t.length-1]==f.OR)if(e.charAt(0)==f.OPEN_LEFT&&e.charAt(e.length-1)==f.CLOSE_RIGHT){let n=0;for(let s=1;s<e.length-1;s++)if(e[s]==f.OPEN_LEFT?n++:e[s]==f.CLOSE_RIGHT&&n--,n<0)return`(${e})`;if(n!=0)return _(s=>(s.textbar=`String "${e}" has non matching number of parentheses.`,["textbar"])),console.warn(`String "${e}" has non matching number of parentheses.`),e}else return`(${e})`}return e}function Ae(e){if(e.length>2&&e.charAt(0)==f.OPEN_LEFT&&e.charAt(e.length-1)==f.CLOSE_RIGHT){let t=0;for(let n=1;n<e.length-1;n++)if(e[n]==f.OPEN_LEFT?t++:e[n]==f.CLOSE_RIGHT&&t--,t<0)return e;return t!=0?e:e.substring(1,e.length-1)}return e}class jt extends C{constructor(t,n){super();a(this,"from");a(this,"to");this.from=t,this.to=n}draw(t,n=!1){t.beginPath(),t.moveTo(this.to.x,this.to.y),t.lineTo(this.from.x,this.from.y),t.stroke(),B(t,this.to.x,this.to.y,Math.atan2(this.to.y-this.from.y,this.to.x-this.from.x))}contains_point(t){return!1}set_anchor_point(t,n){}}function Me(e){e.selected_object!=null&&(e.selected_object.selected=!1);const t=e.canvas.cursor.obj_at_last_pos;return e.selected_object=t,t!=null?(t.selected=!0,(t instanceof y||t instanceof O)&&t.set_mouse_start(e.canvas.cursor.mouse_down_pos.x,e.canvas.cursor.mouse_down_pos.y),e.textbar="Object selected. Click and drag to move or start typing to edit the text."):e.textbar="",["selected_object","textbar"]}function Pt(e){if(e.canvas.cursor.obj_at_last_pos==null){const t=e.canvas.cursor.last_pos,n=new y(t.x,t.y);return n.selected=!0,e.selected_object!=null&&(e.selected_object.selected=!1),e.selected_object=n,e.nodes.push(n),["nodes","selected_object"]}}function Ot(e){const t=e.canvas.cursor.obj_at_last_pos;return t instanceof y&&(t.isAcceptState=!t.isAcceptState),e.selected_object=t,["selected_object"]}function je(e){const t=e.canvas.cursor.last_pos;if(e.selected_object!=null)return e.selected_object.set_anchor_point(t.x,t.y),["nodes","links","selected_object"];{const n=I({},e.view_zone);return n.x=n.zoom*(t.x-e.canvas.cursor.mouse_down_pos.x)+n.x,n.y=n.zoom*(t.y-e.canvas.cursor.mouse_down_pos.y)+n.y,e.view_zone=n,["view_zone"]}}function St(e){let t;const n=e.canvas.cursor.obj_at_mouse_down,s=e.canvas.cursor.obj_at_last_pos,i=I({},e.canvas.cursor.mouse_down_pos),o=I({},e.canvas.cursor.last_pos);return n instanceof y&&s instanceof y?n==s?(t=new O(n),t.set_mouse_start(i.x,i.y),t.set_anchor_point(o.x,o.y)):t=new S(n,s):s instanceof y?t=new D(s,i):t=new jt(n instanceof y?n.closest_point_on_circle(o.x,o.y):i,o),e.temp_link=t,["temp_link"]}function Pe(e){return e.temp_link instanceof jt||(e.links.push(e.temp_link),e.temp_link.selected=!0,e.selected_object!=null&&(e.selected_object.selected=!1),e.selected_object=e.temp_link),e.temp_link=void 0,["links","temp_link"]}function Oe(e){let t=[];const n=e.selected_object;return n instanceof y&&(ke(n,e.nodes,e.links)?(e.textbar="State eliminated.",t=["nodes","links","selected_object","textbar"]):(e.textbar="Failed to eliminate state. Only non-accepting and non-starting states may be eliminated.",t=["textbar"])),e.selected_object!=null&&(e.selected_object.selected=!1,e.selected_object=void 0,t.push("selected_object")),t}function Dt(e){if(e.selected_object!=null){if(e.selected_object instanceof y){for(let t=e.nodes.length-1;t>=0;t--)if(e.selected_object==e.nodes[t]){e.nodes.splice(t,1);break}for(let t=e.links.length-1;t>=0;t--){const n=e.links[t];let s=!1;n instanceof S?s=n.nodeA==e.selected_object||n.nodeB==e.selected_object:(n instanceof D||n instanceof O)&&(s=n.node==e.selected_object),s&&e.links.splice(t,1)}}else for(let t=e.links.length-1;t>=0;t--)if(e.selected_object==e.links[t]){e.links.splice(t,1);break}return e.selected_object=void 0,["nodes","links","selected_object"]}}function Se(e,t){if(e.selected_object!=null)return e.selected_object.text=e.selected_object.text+t,["selected_object"]}function De(e){if(e.selected_object!=null)return e.selected_object.text=e.selected_object.text.substring(0,e.selected_object.text.length-1),["selected_object"]}function Ee(e){if(e.selected_object!=null)return["nodes","links"]}function Te(e,t){const n=e.canvas.event_to_canvas_space(t);return ht(e,n,Math.exp(-t.deltaY/1e3))}function Et(e){return ht(e,e.canvas.point_to_canvas_space({x:e.export_dimensions.width/2,y:e.export_dimensions.height/2}),1.2)}function Tt(e){return ht(e,e.canvas.point_to_canvas_space({x:e.export_dimensions.width/2,y:e.export_dimensions.height/2}),.8)}function ht(e,t,n){const s=e.view_zone,i=I({},s);return i.zoom=Math.min(Math.max(s.zoom*n,.3),3),i.x=(s.zoom-i.zoom)*t.x+s.x,i.y=(s.zoom-i.zoom)*t.y+s.y,e.view_zone=i,["view_zone"]}function It(e){Rt(V(e),`${e.file_name||new Date().toISOString().replace(/[^0-9|-]/g,"")}.fsmjson`,"application/json")}function Ie(e,t){const n=document.createElement("a");n.href=e.toDataURL(),n.download=t,n.click(),URL.revokeObjectURL(n.href)}function Rt(e,t,n="text/plain"){const s=new Blob([e],{type:n}),i=document.createElement("a");i.href=URL.createObjectURL(s),i.download=t,i.click(),URL.revokeObjectURL(i.href)}function Nt(e){Re().then(t=>{const[n,s]=t;try{const i=H(n);e.nodes=i.nodes,e.links=i.links,e.file_name=s.substring(0,s.lastIndexOf(".")),ct(["nodes","links","can","file_name","canvas"])}catch(i){console.error(i),e.textbar="Error opening file.",ct(["textbar"])}})}async function Re(){return new Promise((e,t)=>{const n=document.createElement("input");n.type="file",n.accept=".fsmjson",n.oninput=s=>{const i=s.target.files[0];i.text().then(o=>e([o,i.name]))},n.click()})}function Ne(e){_(t=>{K(t)})}function Le(e){_(t=>(t.canvas.resize(),["canvas"]))}function Xe(e){return e.key=="Shift"&&_(t=>{if(t.curr_tool==v.DRAW_LINK)return t.curr_tool=t.last_tool,t.textbar=et[t.curr_tool],["curr_tool","textbar"]},!1),e.preventDefault(),!1}function Ce(e){e.metaKey||e.ctrlKey?ze(e):Ye(e)}function Ye(e){switch(e.key){case"Shift":_(t=>{if(t.curr_tool==v.DRAW_LINK){t.last_tool=t.curr_tool;return}return t.curr_tool=v.DRAW_LINK,t.textbar=et[t.curr_tool],["curr_tool","textbar"]},!1);break;case"Backspace":_(De,!1);break;case"Delete":_(Dt);break;default:if(e.key.length==1)vt(Se,!1,e.key);else return}if(x("selected_object")!=null)return e.preventDefault(),!1}function ze(e){switch(e.key.toUpperCase()){case"O":_(Nt);break;case"S":_(It);break;case"Y":_(st);break;case"Z":{e.shiftKey?_(st):_(mt);break}case"=":_(Et);break;case"-":_(Tt);break;default:return}return e.preventDefault(),!1}function $e(e){x("curr_menu")!=null&&_(t=>(t.curr_menu=void 0,["curr_menu"]))}class Lt{constructor(){a(this,"state_names");a(this,"transitions");a(this,"starting_state");a(this,"accepting_states");this.state_names=[],this.transitions=new Map,this.starting_state=-1,this.accepting_states=[]}load(t,n){this.state_names=[],this.transitions=new Map,this.starting_state=-1,this.accepting_states=[];const s=new Map;let i=0;for(let o=0;o<t.length;o++){const r=t[o];s.set(j(r),i),this.state_names.push(r.text),r.isAcceptState&&this.accepting_states.push(i),i++}for(let o=0;o<n.length;o++){const r=n[o];if(r instanceof S){const l=s.get(j(r.nodeA)),u=s.get(j(r.nodeB)),d=r.text.split(",").map(h=>h.trim());if(l!=null&&u!=null){let h=this.transitions.get(l);h==null&&(h=new Map,this.transitions.set(l,h));for(const p of d){let m=h.get(p);m==null&&(m=[],h.set(p,m)),m.push(u)}}}else if(r instanceof O){const l=s.get(j(r.node)),u=l,d=r.text.split(",").map(h=>h.trim());if(l!=null&&u!=null){let h=this.transitions.get(l);h==null&&(h=new Map,this.transitions.set(l,h));for(const p of d){let m=h.get(p);m==null&&(m=[],h.set(p,m)),m.push(u)}}}else if(r instanceof D){const l=s.get(j(r.node));l!=null&&(this.starting_state=l)}}}create_elements(){const t=[],n=[],s=new Map;for(let i=0;i<this.state_names.length;i++){const o=At(),r=new y(o.x,o.y);r.text=this.state_names[i],s.set(i,r),this.accepting_states.includes(i)&&(r.isAcceptState=!0),t.push(r)}for(const[i,o]of this.transitions.entries()){const r=s.get(i);if(r!=null)for(const[l,u]of o.entries())for(const d of u){const h=s.get(d);if(h!=null){let p;i==d?p=new O(r):(p=new S(r,h),p.perpendicularPart+=100*Math.random()),p.text=l,n.push(p)}}}if(this.starting_state!=-1){const i=s.get(this.starting_state);if(i!=null){const o=new D(i),r=At();o.set_anchor_point(r.x,r.y),o.text="start",n.push(o)}}return{nodes:t,links:n}}add_transitions(t,n,s){let i=this.transitions.get(t);i==null&&(i=new Map,this.transitions.set(t,i));let o=i.get(n);o==null&&(o=[],i.set(n,o)),at(o,s)}add_transition(t,n,s){let i=this.transitions.get(t);i==null&&(i=new Map,this.transitions.set(t,i));let o=i.get(n);o==null&&(o=[],i.set(n,o)),o.includes(s)||o.push(s)}deep_delta(t,n){const s=[];for(const i of this.get_equivalents(t))at(s,this.shallow_delta(i,n));return this.get_equivalents(s).slice()}shallow_delta(t,n){let s=this.transitions.get(t);if(s!=null){let i=s.get(n);if(i!=null)return i.slice()}return[]}get_equivalents(t){Array.isArray(t)?t=t.slice():t=[t];const n=t.slice();let s=n.pop();for(;s!=null;){let i=this.shallow_delta(s,G);for(const o of i.values())t.includes(o)||(n.push(o),t.push(o));s=n.pop()}return t}is_deterministic(){for(const t of this.transitions.values())for(const[n,s]of t.entries())if(n==G||s.length>1)return!1;return!0}}function Be(e){const t=new Lt,n=e.nodes,s=e.links;if(t.load(n,s),t.is_deterministic())return console.warn("Tried to perform subset construction on a DFA. The automaton must have at least 1 \u03B5 transition or nondeterministic transition."),e.textbar="Tried to perform subset construction on a DFA. The automaton must have at least one \u03B5 or nondeterministic transition.",["textbar"];if(t.starting_state==-1)return console.warn("FA has no starting state (denoted by a link --> to the state) so subset construction failed."),e.textbar="FA has no starting state (denoted by a link --> to the state) so subset construction failed.",["textbar"];const i=Ge(t),{nodes:o,links:r}=i.create_elements();return qe(n,s,o,r),e.selected_object=void 0,["nodes","links"]}function Ge(e){const t=new Lt,n=new Map,s=[],i=[];let o=0;t.starting_state=0;const r=e.get_equivalents(e.starting_state);n.set(Z(r),o);const l=Array.from(r).map(d=>e.state_names[d]);l.sort(),s.push(`{${l.join(",")}}`),i.push(r),Array.from(r).some(d=>e.accepting_states.includes(d))&&t.accepting_states.push(o),o++;let u=i.pop();for(;u!=null;){const d=Z(u),h=new Map;for(const p of u){const m=e.transitions.get(p);if(m!=null){for(const k of m.keys())if(k!=G){let b=h.get(k);b==null&&(b=[],h.set(k,b)),at(b,e.deep_delta(p,k))}}}for(const[p,m]of h.entries()){const k=Z(m),b=n.get(d);if(n.has(k))t.add_transition(b,p,n.get(k));else{const X=Z(m);n.set(X,o);const ut=Array.from(m).map(J=>e.state_names[J]);ut.sort(),s.push(`{${ut.join(",")}}`),i.push(m),Array.from(m).some(J=>e.accepting_states.includes(J))&&t.accepting_states.push(o),t.add_transition(b,p,o),o++}}u=i.pop()}return t.state_names=s,t}function Z(e){const t=e.slice();return t.sort(),t.join(",")}function qe(e,t,n,s){e.splice(0,e.length),t.splice(0,t.length);for(let i=0;i<n.length;i++)e.push(n[i]);for(let i=0;i<s.length;i++)t.push(s[i])}function Xt(e){const t={zoom:1,x:0,y:0},n={width:e.canvas.el.width,height:e.canvas.el.height};return n.width/n.height<e.export_dimensions.width/e.export_dimensions.height?(t.zoom=n.width/e.export_dimensions.width,t.y=(n.height-e.export_dimensions.height*t.zoom)/2):(t.zoom=n.height/e.export_dimensions.height,t.x=(n.width-e.export_dimensions.width*t.zoom)/2),e.view_zone=t,["view_zone"]}class Fe{constructor(){a(this,"fillStyle");a(this,"strokeStyle");a(this,"lineWidth");a(this,"font");a(this,"_points");a(this,"_svgData");a(this,"_transX");a(this,"_transY");this.fillStyle="black",this.strokeStyle="black",this.lineWidth=1,this.font="12px Arial, sans-serif",this._points=[],this._svgData="",this._transX=0,this._transY=0}toSVG(){const t=x("export_dimensions");return`<?xml version="1.0" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">

<svg width="${t.width}" height="${t.height}" version="1.1" xmlns="http://www.w3.org/2000/svg">
' ${this._svgData} </svg>
`}beginPath(){this._points=[]}arc(t,n,s,i,o,r){t+=this._transX,n+=this._transY;const l='stroke="'+this.strokeStyle+'" stroke-width="'+this.lineWidth+'" fill="none"';if(o-i==Math.PI*2)this._svgData+="	<ellipse "+l+' cx="'+g(t,3)+'" cy="'+g(n,3)+'" rx="'+g(s,3)+'" ry="'+g(s,3)+`"/>
`;else{if(r){const b=i;i=o,o=b}o<i&&(o+=Math.PI*2);const u=t+s*Math.cos(i),d=n+s*Math.sin(i),h=t+s*Math.cos(o),p=n+s*Math.sin(o),m=Math.abs(o-i)>Math.PI,k=1;this._svgData+="	<path "+l+' d="',this._svgData+="M "+g(u,3)+","+g(d,3)+" ",this._svgData+="A "+g(s,3)+","+g(s,3)+" ",this._svgData+="0 ",this._svgData+=+m+" ",this._svgData+=+k+" ",this._svgData+=g(h,3)+","+g(p,3),this._svgData+=`"/>
`}}moveTo(t,n){t+=this._transX,n+=this._transY,this._points.push({x:t,y:n})}lineTo(t,n){t+=this._transX,n+=this._transY,this._points.push({x:t,y:n})}stroke(){if(this._points.length!=0){this._svgData+='	<polygon stroke="'+this.strokeStyle+'" stroke-width="'+this.lineWidth+'" points="';for(let t=0;t<this._points.length;t++)this._svgData+=(t>0?" ":"")+g(this._points[t].x,3)+","+g(this._points[t].y,3);this._svgData+=`"/>
`}}fill(){if(this._points.length!=0){this._svgData+='	<polygon fill="'+this.fillStyle+'" stroke-width="'+this.lineWidth+'" points="';for(let t=0;t<this._points.length;t++)this._svgData+=(t>0?" ":"")+g(this._points[t].x,3)+","+g(this._points[t].y,3);this._svgData+=`"/>
`}}fillText(t,n,s){n+=this._transX,s+=this._transY,t.replace(" ","").length>0&&(this._svgData+='	<text x="'+g(n,3)+'" y="'+g(s,3)+'" font-family="Times New Roman" font-size="20">'+_e(t)+`</text>
`)}translate(t,n){this._transX=t,this._transY=n}save(){}restore(){}clearRect(){}rect(){}}function Ue(e){const t=new Fe;return e.selected_object!=null&&(e.selected_object.selected=!1,e.selected_object=void 0),e.canvas.draw_using(t),Rt(t.toSVG(),`${e.file_name}.svg`,"image/svg+xml"),["selected_object"]}class We{constructor(){a(this,"_points");a(this,"_texData");a(this,"_scale");a(this,"strokeStyle","black");a(this,"fillStyle","black");a(this,"lineWidth",1);a(this,"font","");this._points=[],this._texData="",this._scale=.1}toLaTeX(){return`\\documentclass[12pt]{article}
\\usepackage{tikz}

\\begin{document}

\\begin{center}
\\begin{tikzpicture}[scale=0.2]
\\tikzstyle{every node}+=[inner sep=0pt]
`+this._texData+`\\end{tikzpicture}
\\end{center}

\\end{document}
`}beginPath(){this._points=[]}arc(t,n,s,i,o,r){if(t*=this._scale,n*=this._scale,s*=this._scale,o-i==Math.PI*2)this._texData+="\\draw ["+this.strokeStyle+"] ("+g(t,3)+","+g(-n,3)+") circle ("+g(s,3)+`);
`;else{if(r){const l=i;i=o,o=l}o<i&&(o+=Math.PI*2),Math.min(i,o)<-2*Math.PI?(i+=2*Math.PI,o+=2*Math.PI):Math.max(i,o)>2*Math.PI&&(i-=2*Math.PI,o-=2*Math.PI),i=-i,o=-o,this._texData+="\\draw ["+this.strokeStyle+"] ("+g(t+s*Math.cos(i),3)+","+g(-n+s*Math.sin(i),3)+") arc ("+g(i*180/Math.PI,5)+":"+g(o*180/Math.PI,5)+":"+g(s,3)+`);
`}}moveTo(t,n){t*=this._scale,n*=this._scale,this._points.push({x:t,y:n})}lineTo(t,n){t*=this._scale,n*=this._scale,this._points.push({x:t,y:n})}stroke(){if(this._points.length!=0){this._texData+="\\draw ["+this.strokeStyle+"]";for(let t=0;t<this._points.length;t++){const n=this._points[t];this._texData+=(t>0?" --":"")+" ("+g(n.x,2)+","+g(-n.y,2)+")"}this._texData+=`;
`}}fill(){if(this._points.length!=0){this._texData+="\\fill ["+this.strokeStyle+"]";for(let t=0;t<this._points.length;t++){const n=this._points[t];this._texData+=(t>0?" --":"")+" ("+g(n.x,2)+","+g(-n.y,2)+")"}this._texData+=`;
`}}advancedFillText(t,n,s,i,o){if(t.replace(" ","").length>0){let r="";if(o!=null){const l=kt(t),u=Math.cos(o),d=Math.sin(o);Math.abs(u)>Math.abs(d)?u>0?(r="[right] ",s-=l/2):(r="[left] ",s+=l/2):d>0?(r="[below] ",i-=10):(r="[above] ",i+=10)}s*=this._scale,i*=this._scale,this._texData+="\\draw ("+g(s,2)+","+g(-i,2)+") node "+r+"{$"+n.replace(/ /g,"\\mbox{ }")+`$};
`}}translate(){}save(){}restore(){}clearRect(){}rect(){}}function Ke(e){const t=new We;return e.selected_object!=null&&(e.selected_object.selected=!1,e.selected_object=void 0),e.canvas.draw_using(t),navigator.clipboard.writeText(t.toLaTeX()),["selected_object"]}function He(e){e.selected_object!=null&&(e.selected_object.selected=!1,e.selected_object=void 0);const t=document.createElement("canvas");return t.width=e.export_dimensions.width,t.height=e.export_dimensions.height,e.canvas.draw_using(t.getContext("2d")),Ie(t,`${e.file_name}.png`),["selected_object"]}class A extends P{constructor(t){super(t)}render(){return w("div",{class:this.state.clickable?"menu-item":"menu-item disabled",onMouseUp:t=>_(this.props.action),children:[c("span",{class:"menu-item-text",children:this.props.text}),c("span",{class:"menu-item-shortcut",children:this.props.shortcut})]})}}class dt extends P{constructor(){super();a(this,"onClick",t=>{_(this.click_this),t.stopPropagation()});a(this,"onHover",t=>{_(this.hover_this),t.stopPropagation()});a(this,"hover_this",t=>{if(t.curr_menu!=null&&t.curr_menu!=this.props.title)return t.curr_menu=this.props.title,["curr_menu"]});a(this,"click_this",t=>(t.curr_menu!=this.props.title?t.curr_menu=this.props.title:t.curr_menu=void 0,["curr_menu"]))}render(){const t=x("curr_menu")==this.props.title;return w("div",{class:"menu-tab-root",children:[c("div",{class:`menu-tab-button ${t?"selected":""}`,onMouseDown:this.onClick,onMouseEnter:this.onHover,onClick:n=>{n.stopPropagation()},children:this.props.title}),t?c("div",{class:"menu-item-container",children:this.props.children}):""]})}}class Ve extends P{constructor(){super();a(this,"onClick",t=>{_(n=>{if(n.selected_object!=null)return n.selected_object.selected=!1,n.selected_object=void 0,["selected_object"]})});a(this,"onInput",t=>{_(n=>{n.file_name=t.target.innerText,gt(n)}),t.stopPropagation()});z(["file_name"],this)}render(){return c("span",{contentEditable:!0,role:"textbox",type:"text",class:"menu-filename",onInput:this.onInput,onMouseDown:this.onClick,children:x("file_name")})}}class Ze extends P{render(){return w("div",{class:"menubar",children:[c(Ve,{}),c("div",{class:"menu-logo",children:se}),c(Je,{})]})}}class Je extends P{constructor(){super();z(["curr_menu"],this)}render(){return w("div",{class:"menubar-tab-container",children:[w(dt,{title:"File",children:[c(A,{text:"Open",shortcut:"Ctrl+O",action:Nt}),c(A,{text:"Save As",shortcut:"Ctrl+S",action:It}),c(A,{text:"Save PNG",shortcut:"",action:He}),c(A,{text:"Save SVG",shortcut:"",action:Ue}),c(A,{text:"Copy LaTeX",shortcut:"",action:Ke})]}),w(dt,{title:"Edit",children:[c(A,{text:"Undo",shortcut:"Ctrl+Z",action:mt}),c(A,{text:"Redo",shortcut:"Ctrl+Y",action:st}),c(A,{text:"Delete",shortcut:"Delete",action:Dt}),c(A,{text:"Subset Construction",shortcut:"",action:Be})]}),w(dt,{title:"View",children:[c(A,{text:"Reset Zoom",shortcut:"",action:Xt}),c(A,{text:"Zoom In",shortcut:"Ctrl+=",action:Et}),c(A,{text:"Zoom Out",shortcut:"Ctrl+-",action:Tt})]})]})}}function Qe(e){const t=x("nodes"),n=x("links");for(let s=0;s<t.length;s++)if(t[s].contains_point(e))return t[s];for(let s=0;s<n.length;s++)if(n[s].contains_point(e))return n[s]}class tn{constructor(t){a(this,"canvas");a(this,"mouse_down",t=>{switch(this.sync_canvas_coordinates(t,!0),this.canvas.cursor.mouse_down_pos=I({},this.canvas.cursor.last_pos),this.canvas.cursor.obj_at_mouse_down=this.canvas.cursor.obj_at_last_pos,_(Me),this.canvas.cursor.down=!0,x("curr_tool")){case v.DRAW_LINK:_(St,!1)}this.canvas.cursor.moving=!1});a(this,"mouse_up",t=>(this.sync_canvas_coordinates(t),this.canvas.cursor.down=!1,this.canvas.cursor.moving?_(Ee):t.button==W.LEFT?this.left_click():t.button==W.RIGHT&&this.right_click(),x("temp_link")!=null&&_(Pe),this.canvas.cursor.moving=!1,t.preventDefault(),!1));a(this,"mouse_move",t=>{this.sync_canvas_coordinates(t,!0),this.canvas.cursor.moving=!0,this.canvas.cursor.down&&this.drag()});a(this,"dbl_click",t=>{this.sync_canvas_coordinates(t),this.canvas.cursor.obj_at_last_pos instanceof y?_(Ot):_(Pt)});a(this,"wheel",t=>{if(!this.canvas.cursor.down)return vt(Te,!0,t),t.preventDefault(),!1});a(this,"drag",()=>{switch(x("curr_tool")){case v.DRAW_LINK:{_(St,!1);break}default:_(je,!1)}});a(this,"left_click",()=>{switch(x("curr_tool")){case v.DRAW_NODE:_(Pt);break;case v.DRAW_ACCEPT:_(Ot);break;case v.ELIMINATE:_(Oe);break}});a(this,"right_click",()=>{});this.canvas=t}prevent_default(t){return t.preventDefault(),!1}sync_canvas_coordinates(t,n=!1){this.canvas.cursor.last_pos=this.canvas.event_to_canvas_space(t),n&&(this.canvas.cursor.obj_at_last_pos=Qe(this.canvas.cursor.last_pos))}}class en extends P{constructor(){super();a(this,"ref",qt());a(this,"el");a(this,"ctx");a(this,"cursor");a(this,"handlers");a(this,"caret_interval",-1);a(this,"caret_function",()=>{x("selected_object")==null?(window.clearInterval(this.caret_interval),this.caret_interval=-1):this.setState({caret_visible:!this.state.caret_visible})});a(this,"draw",()=>{const t=x("view_zone");if(this.ctx!=null)this.ctx.setTransform(t.zoom,0,0,t.zoom,t.x,t.y),this.draw_using(this.ctx,!0);else if(this.el!=null){const n=this.el.getContext("2d");n!=null&&(this.ctx=n,n.setTransform(t.zoom,0,0,t.zoom,t.x,t.y),this.draw_using(n,!0))}});this.state={caret_visible:!1,selected_zone:void 0},this.cursor={mouse_down_pos:{x:0,y:0},obj_at_mouse_down:void 0,last_pos:{x:0,y:0},obj_at_last_pos:void 0,down:!1,moving:!1},this.handlers=new tn(this)}componentDidMount(){de(this),this.el=this.ref.current,this.ctx=this.el.getContext("2d"),this.resize(),this.el.onmousedown=this.handlers.mouse_down,this.el.onmousemove=this.handlers.mouse_move,this.el.onmouseup=this.handlers.mouse_up,this.el.ondblclick=this.handlers.dbl_click,this.el.oncontextmenu=this.handlers.prevent_default,this.el.onwheel=this.handlers.wheel,_(Xt),z(["nodes","links","active_objects","selected_object","temp_link","view_zone","export_dimensions"],this),ue(this.draw)}componentWillUnmount(){he(this)}shouldComponentUpdate(){return this.reinit_caret(),this.draw(),!1}render(){return c("canvas",{ref:this.ref,id:"canvas",children:w("span",{children:["Your browser does not support",c("br",{}),"the HTML5 <canvas> element"]})})}reinit_caret(){x("selected_object")!=null&&this.caret_interval==-1&&(this.caret_interval=window.setInterval(this.caret_function,300))}event_to_canvas_space(t){const n=x("view_zone"),s=this.el.getBoundingClientRect(),i={x:t.clientX-s.x,y:t.clientY-s.y};return{x:(i.x-n.x)/n.zoom,y:(i.y-n.y)/n.zoom}}point_to_canvas_space(t){const n=x("view_zone");return{x:(t.x-n.x)/n.zoom,y:(t.y-n.y)/n.zoom}}draw_using(t,n=!1){if(this.el!=null){const s=x("nodes"),i=x("links"),o=x("selected_object"),r=x("temp_link"),l=x("export_dimensions"),u=this.point_to_canvas_space({x:0,y:0}),d=this.point_to_canvas_space({x:this.el.width,y:this.el.height});t.clearRect(u.x,u.y,d.x-u.x,d.y-u.y),t.save(),n&&(t.beginPath(),t.fillStyle="white",t.rect(-1,-1,l.width+2,l.height+2),t.fill(),t.stroke());for(let h=0;h<s.length;h++)t.lineWidth=1,t.fillStyle=t.strokeStyle=s[h].curr_colour(),s[h].draw(t,s[h]==o&&this.state.caret_visible);for(let h=0;h<i.length;h++)t.lineWidth=1,t.fillStyle=t.strokeStyle=i[h].curr_colour(),i[h].draw(t,i[h]==o&&this.state.caret_visible);r!=null&&(t.lineWidth=1,t.fillStyle=t.strokeStyle="black",r.draw(t,r==o&&this.state.caret_visible)),t.restore()}}resize(){this.el.width=this.el.offsetWidth,this.el.height=this.el.offsetHeight}}class nn extends P{constructor(){super();a(this,"last_str");this.last_str=x("textbar"),z(["textbar"],this)}shouldComponentUpdate(){const t=x("textbar");return this.last_str==t?!1:(this.last_str=t,!0)}render(){return c("div",{class:"text-bar",children:this.last_str})}}class sn extends P{constructor(){super(...arguments);a(this,"canvas")}componentWillMount(){this.init()}componentDidMount(){this.canvas=ot()}render(){return w(Zt,{children:[c(Ze,{}),c(ie,{}),c(en,{}),c(nn,{})]})}init(){window.onkeydown=Ce,window.onkeyup=Xe,window.onresize=Le,window.onbeforeunload=Ne,window.onclick=$e,_(oe),_(re)}}console.time("Render Time");Ft(c(sn,{}),document.getElementById("app"));console.timeEnd("Render Time");
