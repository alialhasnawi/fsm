(()=>{"use strict";const t="*&*",e="*",n="+",s="(",i=")",o=[n,s,i],r=[t,n],a=[e],l=[s,n,t,e],c=[i,n,t],h={KLEIN_OP:8,CONCAT_OP:4,OR_OP:2},d="\\epsilon",u={cursorVisible:!0,selectedObject:null,currentLink:null,movingObject:!1,originalClick:null},f=[],g=[];let p;CanvasRenderingContext2D,CanvasRenderingContext2D;class x{constructor(t,e){this.x=t,this.y=e,this.mouseOffsetX=0,this.mouseOffsetY=0,this.isAcceptState=!1,this.text=""}setMouseStart(t,e){this.mouseOffsetX=this.x-t,this.mouseOffsetY=this.y-e}setAnchorPoint(t,e){this.x=t+this.mouseOffsetX,this.y=e+this.mouseOffsetY}draw(t){t.beginPath(),t.arc(this.x,this.y,30,0,2*Math.PI,!1),t.stroke(),O(t,this.text,this.x,this.y,null,u.selectedObject==this),this.isAcceptState&&(t.beginPath(),t.arc(this.x,this.y,24,0,2*Math.PI,!1),t.stroke())}closestPointOnCircle(t,e){const n=t-this.x,s=e-this.y,i=Math.sqrt(n*n+s*s);return{x:this.x+30*n/i,y:this.y+30*s/i}}containsPoint(t,e){return(t-this.x)*(t-this.x)+(e-this.y)*(e-this.y)<900}}class A{constructor(t,e){this.node=t,this.anchorAngle=0,this.mouseOffsetAngle=0,this.text="",e&&this.setAnchorPoint(e.x,e.y)}setMouseStart(t,e){this.mouseOffsetAngle=this.anchorAngle-Math.atan2(e-this.node.y,t-this.node.x)}setAnchorPoint(t,e){this.anchorAngle=Math.atan2(e-this.node.y,t-this.node.x)+this.mouseOffsetAngle;const n=Math.round(this.anchorAngle/(Math.PI/2))*(Math.PI/2);Math.abs(this.anchorAngle-n)<.1&&(this.anchorAngle=n),this.anchorAngle<-Math.PI&&(this.anchorAngle+=2*Math.PI),this.anchorAngle>Math.PI&&(this.anchorAngle-=2*Math.PI)}getEndPointsAndCircle(){const t=this.node.x+45*Math.cos(this.anchorAngle),e=this.node.y+45*Math.sin(this.anchorAngle),n=22.5,s=this.anchorAngle-.8*Math.PI,i=this.anchorAngle+.8*Math.PI;return{hasCircle:!0,startX:t+n*Math.cos(s),startY:e+n*Math.sin(s),endX:t+n*Math.cos(i),endY:e+n*Math.sin(i),startAngle:s,endAngle:i,circleX:t,circleY:e,circleRadius:n}}draw(t){const e=this.getEndPointsAndCircle();t.beginPath(),t.arc(e.circleX,e.circleY,e.circleRadius,e.startAngle,e.endAngle,!1),t.stroke();const n=e.circleX+e.circleRadius*Math.cos(this.anchorAngle),s=e.circleY+e.circleRadius*Math.sin(this.anchorAngle);O(t,this.text,n,s,this.anchorAngle,u.selectedObject==this),P(t,e.endX,e.endY,e.endAngle+.4*Math.PI)}containsPoint(t,e){const n=this.getEndPointsAndCircle(),s=t-n.circleX,i=e-n.circleY,o=Math.sqrt(s*s+i*i)-n.circleRadius;return Math.abs(o)<6}}class y{constructor(t,e){this.node=t,this.deltaX=0,this.deltaY=0,this.text="",e&&this.setAnchorPoint(e.x,e.y)}setAnchorPoint(t,e){this.deltaX=t-this.node.x,this.deltaY=e-this.node.y,Math.abs(this.deltaX)<6&&(this.deltaX=0),Math.abs(this.deltaY)<6&&(this.deltaY=0)}getStartPoint(){return{x:this.node.x+this.deltaX,y:this.node.y+this.deltaY}}getEndPoints(){const t=this.node.x+this.deltaX,e=this.node.y+this.deltaY,n=this.node.closestPointOnCircle(t,e);return{startX:t,startY:e,endX:n.x,endY:n.y}}draw(t){const e=this.getEndPoints();t.beginPath(),t.moveTo(e.startX,e.startY),t.lineTo(e.endX,e.endY),t.stroke();const n=Math.atan2(e.startY-e.endY,e.startX-e.endX);O(t,this.text,e.startX,e.startY,n,u.selectedObject==this),P(t,e.endX,e.endY,Math.atan2(-this.deltaY,-this.deltaX))}containsPoint(t,e){const n=this.getEndPoints(),s=n.endX-n.startX,i=n.endY-n.startY,o=Math.sqrt(s*s+i*i),r=(s*(t-n.startX)+i*(e-n.startY))/(o*o),a=(s*(e-n.startY)-i*(t-n.startX))/o;return r>0&&r<1&&Math.abs(a)<6}}const m=["Alpha","Beta","Gamma","Delta","Epsilon","Zeta","Eta","Theta","Iota","Kappa","Lambda","Mu","Nu","Xi","Omicron","Pi","Rho","Sigma","Tau","Upsilon","Phi","Chi","Psi","Omega"];function b(t){for(let e=0;e<m.length;e++){const n=m[e];t=(t=t.replace(new RegExp("\\\\"+n,"g"),String.fromCharCode(913+e+ +(e>16)))).replace(new RegExp("\\\\"+n.toLowerCase(),"g"),String.fromCharCode(945+e+ +(e>16)))}for(let e=0;e<10;e++)t=t.replace(new RegExp("_"+e,"g"),String.fromCharCode(8320+e));return t}function P(t,e,n,s){const i=Math.cos(s),o=Math.sin(s);t.beginPath(),t.moveTo(e,n),t.lineTo(e-8*i+5*o,n-8*o-5*i),t.lineTo(e-8*i-5*o,n-8*o+5*i),t.fill()}function M(){return(document.activeElement||document.body)==document.body}function O(t,e,n,s,i,o){const r=b(e);t.font='20px "Times New Roman", serif';const a=t.measureText(r).width;if(n-=a/2,null!=i){const t=Math.cos(i),e=Math.sin(i),o=(a/2+5)*(t>0?1:-1),r=15*(e>0?1:-1),l=e*Math.pow(Math.abs(e),40)*o-t*Math.pow(Math.abs(t),10)*r;n+=o-e*l,s+=r+t*l}"advancedFillText"in t?t.advancedFillText(r,e,n+a/2,s,i):(n=Math.round(n),s=Math.round(s),t.fillText(r,n,s+6),o&&j&&M()&&document.hasFocus()&&(n+=a,t.beginPath(),t.moveTo(n,s-10),t.lineTo(n,s+10),t.stroke()))}let w,j=!0;function S(){clearInterval(w),w=setInterval((function(){j=!j,X()}),500),j=!0}function X(){(function(t){t.clearRect(0,0,p.width,p.height),t.save(),t.translate(.5,.5);for(let e=0;e<f.length;e++)t.lineWidth=1,t.fillStyle=t.strokeStyle=f[e]==u.selectedObject?"blue":"black",f[e].draw(t);for(let e=0;e<g.length;e++)t.lineWidth=1,t.fillStyle=t.strokeStyle=g[e]==u.selectedObject?"blue":"black",g[e].draw(t);null!=u.currentLink&&(t.lineWidth=1,t.fillStyle=t.strokeStyle="black",u.currentLink.draw(t)),t.restore()})(p.getContext("2d")),function(){if(!localStorage||!JSON)return;const t={nodes:[],links:[]};for(let e=0;e<f.length;e++){const n=f[e];let s={x:n.x,y:n.y,text:n.text,isAcceptState:n.isAcceptState};t.nodes.push(s)}for(let e=0;e<g.length;e++){const n=g[e];let s=null;n instanceof A?s={type:"SelfLink",node:f.indexOf(n.node),text:n.text,anchorAngle:n.anchorAngle}:n instanceof y?s={type:"StartLink",node:f.indexOf(n.node),text:n.text,deltaX:n.deltaX,deltaY:n.deltaY}:n instanceof C&&(s={type:"Link",nodeA:f.indexOf(n.nodeA),nodeB:f.indexOf(n.nodeB),text:n.text,lineAngleAdjust:n.lineAngleAdjust,parallelPart:n.parallelPart,perpendicularPart:n.perpendicularPart}),null!=s&&t.links.push(s)}localStorage.fsm=JSON.stringify(t)}()}function Y(t,e){for(let n=0;n<f.length;n++)if(f[n].containsPoint(t,e))return f[n];for(let n=0;n<g.length;n++)if(g[n].containsPoint(t,e))return g[n];return null}function k(t){return t.key}function v(t){const e=function(t){let e=(t=t||window.event).target,n=0,s=0;for(;e.offsetParent;)n+=e.offsetLeft,s+=e.offsetTop,e=e.offsetParent;return{x:n,y:s}}(t),n=function(t){return{x:(t=t||window.event).pageX||t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,y:t.pageY||t.clientY+document.body.scrollTop+document.documentElement.scrollTop}}(t);return{x:n.x-e.x,y:n.y-e.y}}function _(t,e,n,s,i,o,r,a,l){return t*i*l+e*o*r+n*s*a-t*o*a-e*s*l-n*i*r}class C{constructor(t,e){this.nodeA=t,this.nodeB=e,this.text="",this.lineAngleAdjust=0,this.parallelPart=.5,this.perpendicularPart=0}getAnchorPoint(){const t=this.nodeB.x-this.nodeA.x,e=this.nodeB.y-this.nodeA.y,n=Math.sqrt(t*t+e*e);return{x:this.nodeA.x+t*this.parallelPart-e*this.perpendicularPart/n,y:this.nodeA.y+e*this.parallelPart+t*this.perpendicularPart/n}}setAnchorPoint(t,e){const n=this.nodeB.x-this.nodeA.x,s=this.nodeB.y-this.nodeA.y,i=Math.sqrt(n*n+s*s);this.parallelPart=(n*(t-this.nodeA.x)+s*(e-this.nodeA.y))/(i*i),this.perpendicularPart=(n*(e-this.nodeA.y)-s*(t-this.nodeA.x))/i,this.parallelPart>0&&this.parallelPart<1&&Math.abs(this.perpendicularPart)<6&&(this.lineAngleAdjust=+(this.perpendicularPart<0)*Math.PI,this.perpendicularPart=0)}getEndPointsAndCircle(){if(0==this.perpendicularPart){const t=(this.nodeA.x+this.nodeB.x)/2,e=(this.nodeA.y+this.nodeB.y)/2,n=this.nodeA.closestPointOnCircle(t,e),s=this.nodeB.closestPointOnCircle(t,e);return{hasCircle:!1,startX:n.x,startY:n.y,endX:s.x,endY:s.y}}const t=this.getAnchorPoint(),e=function(t,e,n,s,i,o){const r=_(t,e,1,n,s,1,i,o,1),a=-_(t*t+e*e,e,1,n*n+s*s,s,1,i*i+o*o,o,1),l=_(t*t+e*e,t,1,n*n+s*s,n,1,i*i+o*o,i,1),c=-_(t*t+e*e,t,e,n*n+s*s,n,s,i*i+o*o,i,o);return{x:-a/(2*r),y:-l/(2*r),radius:Math.sqrt(a*a+l*l-4*r*c)/(2*Math.abs(r))}}(this.nodeA.x,this.nodeA.y,this.nodeB.x,this.nodeB.y,t.x,t.y),n=this.perpendicularPart>0,s=n?1:-1,i=Math.atan2(this.nodeA.y-e.y,this.nodeA.x-e.x)-30*s/e.radius,o=Math.atan2(this.nodeB.y-e.y,this.nodeB.x-e.x)+30*s/e.radius;return{hasCircle:!0,startX:e.x+e.radius*Math.cos(i),startY:e.y+e.radius*Math.sin(i),endX:e.x+e.radius*Math.cos(o),endY:e.y+e.radius*Math.sin(o),startAngle:i,endAngle:o,circleX:e.x,circleY:e.y,circleRadius:e.radius,reverseScale:s,isReversed:n}}draw(t){const e=this.getEndPointsAndCircle();if(t.beginPath(),e.hasCircle?t.arc(e.circleX,e.circleY,e.circleRadius,e.startAngle,e.endAngle,e.isReversed):(t.moveTo(e.startX,e.startY),t.lineTo(e.endX,e.endY)),t.stroke(),e.hasCircle?P(t,e.endX,e.endY,e.endAngle-e.reverseScale*(Math.PI/2)):P(t,e.endX,e.endY,Math.atan2(e.endY-e.startY,e.endX-e.startX)),e.hasCircle){let n=e.startAngle,s=e.endAngle;s<n&&(s+=2*Math.PI);const i=(n+s)/2+ +e.isReversed*Math.PI,o=e.circleX+e.circleRadius*Math.cos(i),r=e.circleY+e.circleRadius*Math.sin(i);O(t,this.text,o,r,i,u.selectedObject==this)}else{const n=(e.startX+e.endX)/2,s=(e.startY+e.endY)/2,i=Math.atan2(e.endX-e.startX,e.startY-e.endY);O(t,this.text,n,s,i+this.lineAngleAdjust,u.selectedObject==this)}}containsPoint(t,e){const n=this.getEndPointsAndCircle();if(!n.hasCircle){const s=n.endX-n.startX,i=n.endY-n.startY,o=Math.sqrt(s*s+i*i),r=(s*(t-n.startX)+i*(e-n.startY))/(o*o),a=(s*(e-n.startY)-i*(t-n.startX))/o;return r>0&&r<1&&Math.abs(a)<6}{const s=t-n.circleX,i=e-n.circleY,o=Math.sqrt(s*s+i*i)-n.circleRadius;if(Math.abs(o)<6){let t=Math.atan2(i,s),e=n.startAngle,o=n.endAngle;if(n.isReversed){const t=e;e=o,o=t}return o<e&&(o+=2*Math.PI),t<e?t+=2*Math.PI:t>o&&(t-=2*Math.PI),t>e&&t<o}}return!1}}function L(t,e){for(const n of e.values())t.add(n)}function B(t){return t instanceof x?`${t.text}:${t.x},${t.y}`:t instanceof C?`${B(t.nodeA)}->${B(t.nodeB)}:${t.text}${t.getAnchorPoint().x},${t.getAnchorPoint().y}`:t instanceof y?`${B(t.node)}:${t.getStartPoint().x},${t.getStartPoint().y}`:JSON.stringify(t)}function R(){return{x:Math.random()*(p.width-60)+30,y:Math.random()*(p.height-60)+30}}function $(t,e,n){if(t.isAcceptState)return;const s=[],i=[],o=[],r=[];for(let e=0;e<n.length;e++){const r=n[e];if(r instanceof A&&r.node==t)o.push(r);else if(r instanceof C)r.nodeA==t?i.push(r):r.nodeB==t&&s.push(r);else if(r instanceof y&&r.node==t)return}let a="";if(o.length>0){const t=[];for(let e=0;e<o.length;e++)t.push(...o[e].text.split(","));1==t.length&&1==t[0].length?a=`${t[0]}*`:t.length>0&&(a=`(${t.join("+")})*`)}for(let t=0;t<s.length;t++){const e=s[t];for(let t=0;t<i.length;t++){const s=i[t];let o,r;r=`${T(e.text.split(",").map((t=>t.trim())).join("+"))}${a}${T(s.text.split(",").map((t=>t.trim())).join("+"))}`,o=e.nodeA==s.nodeB?new A(e.nodeA):new C(e.nodeA,s.nodeB),r=E(r.replace(new RegExp("/([)*w])(\\epsilon)/g"),"$1").replace(new RegExp("/(\\epsilon)([(w])/g"),"$2")),o.text=r,n.push(o)}}let l=n.length;for(;l--;)(s.some((t=>t==n[l]))||i.some((t=>t==n[l]))||o.some((t=>t==n[l])))&&n.splice(l,1);e.splice(e.indexOf(t),1);for(let t=0;t<r.length;t++)n.push(r[t]);!function(t){const e=[],n=new Map;for(let e=0;e<t.length;e++){const s=t[e];if(s instanceof A)continue;if(!(s instanceof C))continue;let i=B(s.nodeA)+B(s.nodeB);n.get(i)?n.get(i).push(s):n.set(i,[s])}for(const t of n.values())if(t.length>1){t[0].text=`${t.map((t=>t.text)).join("+")}`;for(let n=1;n<t.length;n++)e.push(t[n])}let s=t.length;for(;s--;)e.some((e=>e==t[s]))&&t.splice(s,1)}(n)}function T(d){if(d.includes("+")){let u=function(n){const d=function(n){n=b(n=n.replace(/(\w)\*/g,"($1)*"));const r=[];let a=0,h=0;for(;h<n.length;){if(o.includes(n[h]))a!=h&&r.push(n.slice(a,h)),a=h+1,r.push(n[h]);else if(n[h]==e){let t=r.length-1,e=0;for(;t>=0&&(r[t]==i?e++:r[t]==s&&e--,0!=e);)t--;r.splice(t,0,n[h]),a=h+1}h++}for(a!=h&&r.push(n.slice(a)),h=r.length-1;h>0;)l.includes(r[h-1])||c.includes(r[h])||r.splice(h,0,t),h--;return r}(n),u=[],f=[];for(let t=0;t<d.length;t++){const n=d[t];if(n==e)f.push(n);else if(r.includes(n)){for(;f.length>0;){let t=f[f.length-1];if(!(t!=s&&h[t]>=h[n]))break;u.push(f.pop())}f.push(n)}else if(n==s)f.push(n);else if(n==i){for(;f.length>0&&f[f.length-1]!=s;)u.push(f.pop());0==f.length&&console.error("The operator stack is empty, fix the parentheses."),f.pop(),f.length>0&&a.includes(f[length-1])&&u.push(f.pop())}else u.push(n)}for(;f.length>0;)u.push(f.pop());return u}(d);if(u.length>0&&u[u.length-1]==n){if(d.charAt(0)!=s||d.charAt(d.length-1)!=i)return`(${d})`;{let t=0;for(let e=1;e<d.length-1;e++)if(d[e]==s?t++:d[e]==i&&t--,t<0)return`(${d})`;if(0!=t)return console.warn(`String "${d}" has non matching number of parentheses.`),d}}}return d}function E(t){if(t.length>2&&t.charAt(0)==s&&t.charAt(t.length-1)==i){let e=0;for(let n=1;n<t.length-1;n++)if(t[n]==s?e++:t[n]==i&&e--,e<0)return t;return 0!=e?t:t.substring(1,t.length-1)}return t}class I{constructor(t,e){this.from=t,this.to=e}draw(t){t.beginPath(),t.moveTo(this.to.x,this.to.y),t.lineTo(this.from.x,this.from.y),t.stroke(),P(t,this.to.x,this.to.y,Math.atan2(this.to.y-this.from.y,this.to.x-this.from.x))}}class q{constructor(){this.#t()}#t(){this.state_names=[],this.transitions=new Map,this.starting_state=-1,this.accepting_states=new Set}load(t,e){this.#t();const n=new Map;let s=0;for(let e=0;e<t.length;e++){const i=t[e];n.set(B(i),s),this.state_names.push(i.text),i.isAcceptState&&this.accepting_states.add(s),s++}for(let t=0;t<e.length;t++){const s=e[t];if(s instanceof C){const t=n.get(B(s.nodeA)),e=n.get(B(s.nodeB)),i=s.text.split(",").map((t=>t.trim()));this.transitions.has(t)||this.transitions.set(t,new Map);for(const n of i)this.transitions.get(t).has(n)||this.transitions.get(t).set(n,new Set),this.transitions.get(t).get(n).add(e)}else if(s instanceof A){const t=n.get(B(s.node)),e=t,i=s.text.split(",").map((t=>t.trim()));this.transitions.has(t)||this.transitions.set(t,new Map);for(const n of i)this.transitions.get(t).has(n)||this.transitions.get(t).set(n,new Set),this.transitions.get(t).get(n).add(e)}else s instanceof y&&(this.starting_state=n.get(B(s.node)))}}create_elements(){const t=[],e=[],n=new Map;for(let e=0;e<this.state_names.length;e++){const s=R(),i=new x(s.x,s.y);i.text=this.state_names[e],n.set(e,i),this.accepting_states.has(e)&&(i.isAcceptState=!0),t.push(i)}for(const[t,s]of this.transitions.entries())for(const[i,o]of s.entries())for(const s of o.values()){let o;t==s?o=new A(n.get(t)):(R(),o=new C(n.get(t),n.get(s)),o.perpendicularPart+=100*Math.random()),o.text=i,e.push(o)}if(-1!=this.starting_state){const t=new y(n.get(this.starting_state)),s=R();t.setAnchorPoint(s.x,s.y),t.text="start",e.push(t)}return{nodes:t,links:e}}add_transitions(t,e,n){this.transitions.has(t)||this.transitions.set(t,new Map),this.transitions.get(t).has(e)||this.transitions.get(t).set(e,new Set),L(this.transitions.get(t).get(e),n)}add_transition(t,e,n){this.transitions.has(t)||this.transitions.set(t,new Map),this.transitions.get(t).has(e)||this.transitions.get(t).set(e,new Set),this.transitions.get(t).get(e).add(n)}deep_delta(t,e){const n=new Set;for(const s of this.get_equivalents(t).values())L(n,this.shallow_delta(s,e));return this.get_equivalents(n)}shallow_delta(t,e){return this.transitions.has(t)&&this.transitions.get(t).has(e)?new Set(this.transitions.get(t).get(e)):new Set}get_equivalents(t){t=t instanceof Set?new Set(t):new Set([t]);const e=Array.from(t);for(;e.length>0;){let n=this.shallow_delta(e.pop(),d);for(const s of n.values())t.has(s)||(e.push(s),t.add(s))}return t}is_deterministic(){for(const t of this.transitions.values())for(const[e,n]of t.entries())if(e==d||n.size>1)return!1;return!0}}function N(t){const e=Array.from(t);return e.sort(),e.join(",")}window.onload=function(){var t;t=document.getElementById("canvas"),p=t,function(){if(localStorage&&JSON)try{const t=JSON.parse(localStorage.fsm);for(let e=0;e<t.nodes.length;e++){const n=t.nodes[e],s=new x(n.x,n.y);s.isAcceptState=n.isAcceptState,s.text=n.text,f.push(s)}for(let e=0;e<t.links.length;e++){const n=t.links[e];let s=null;"SelfLink"==n.type?(s=new A(f[n.node]),s.anchorAngle=n.anchorAngle,s.text=n.text):"StartLink"==n.type?(s=new y(f[n.node]),s.deltaX=n.deltaX,s.deltaY=n.deltaY,s.text=n.text):"Link"==n.type&&(s=new C(f[n.nodeA],f[n.nodeB]),s.parallelPart=n.parallelPart,s.perpendicularPart=n.perpendicularPart,s.text=n.text,s.lineAngleAdjust=n.lineAngleAdjust),null!=s&&g.push(s)}}catch(t){localStorage.fsm=""}}(),X(),p.onmousedown=function(t){const e=v(t);return u.selectedObject=Y(e.x,e.y),u.movingObject=!1,u.originalClick=e,null!=u.selectedObject?(D&&u.selectedObject instanceof x?u.currentLink=new A(u.selectedObject,e):(u.movingObject=!0,"setMouseStart"in u.selectedObject&&u.selectedObject.setMouseStart(e.x,e.y)),S()):D&&(u.currentLink=new I(e,e)),X(),!M()&&(S(),!0)},p.ondblclick=function(t){const e=v(t);u.selectedObject=Y(e.x,e.y),null==u.selectedObject?(u.selectedObject=new x(e.x,e.y),f.push(u.selectedObject),S(),X()):u.selectedObject instanceof x&&(u.selectedObject.isAcceptState=!u.selectedObject.isAcceptState,X())},p.onmousemove=function(t){const e=v(t);if(null!=u.currentLink){let t=Y(e.x,e.y);t instanceof x||(t=null),null==u.selectedObject?u.currentLink=null!=t?new y(t,u.originalClick):new I(u.originalClick,e):t==u.selectedObject?u.currentLink=new A(u.selectedObject,e):u.currentLink=null!=t?new C(u.selectedObject,t):new I(u.selectedObject.closestPointOnCircle(e.x,e.y),e),X()}u.movingObject&&(u.selectedObject.setAnchorPoint(e.x,e.y),u.selectedObject instanceof x&&function(t){for(let e=0;e<f.length;e++)f[e]!=t&&(Math.abs(t.x-f[e].x)<6&&(t.x=f[e].x),Math.abs(t.y-f[e].y)<6&&(t.y=f[e].y))}(u.selectedObject),X())},p.onmouseup=function(t){u.movingObject=!1,null!=u.currentLink&&(u.currentLink instanceof I||(u.selectedObject=u.currentLink,g.push(u.currentLink),S()),u.currentLink=null,X())},p.oncontextmenu=function(t){return function(){const t=new q;if(t.load(f,g),t.is_deterministic())return void console.warn("Tried to perform subset construction on a DFA.");if(-1==t.starting_state)return void console.warn("FA has no starting state so subset construction failed.");const e=function(t){const e=new q,n=new Map,s=[],i=[];let o=0;e.starting_state=0;const r=t.get_equivalents(t.starting_state);n.set(N(r),o);const a=Array.from(r).map((e=>t.state_names[e]));for(a.sort(),s.push(`{${a.join("")}}`),i.push(r),Array.from(r).some((e=>t.accepting_states.has(e)))&&e.accepting_states.add(o),o++;i.length>0;){const r=i.pop(),a=N(r),l=n.get(a),c=new Map;for(const e of r)if(t.transitions.has(e))for(const n of t.transitions.get(e).keys())n!=d&&(c.has(n)||c.set(n,new Set),L(c.get(n),t.deep_delta(e,n)));for(const[r,a]of c.entries()){const c=N(a);if(n.has(c))e.add_transition(l,r,n.get(c));else{const c=N(a);n.set(c,o);const h=Array.from(a).map((e=>t.state_names[e]));h.sort(),s.push(`{${h.join("")}}`),i.push(a),Array.from(a).some((e=>t.accepting_states.has(e)))&&e.accepting_states.add(o),e.add_transition(l,r,o),o++}}}return e.state_names=s,e}(t),{nodes:n,links:s}=e.create_elements();!function(t,e){f.splice(0,f.length),g.splice(0,g.length);for(let e=0;e<t.length;e++)f.push(t[e]);for(let t=0;t<e.length;t++)g.push(e[t])}(n,s)}(),u.selectedObject=null,X(),t.preventDefault(),!1}};let D=!1;document.addEventListener("keydown",(function(t){const e=k(t);if("Shift"==e)D=!0;else{if(!M())return!0;if("Backspace"==e)return null!=u.selectedObject&&"text"in u.selectedObject&&(u.selectedObject.text=u.selectedObject.text.substr(0,u.selectedObject.text.length-1),S(),X()),!1;if("Delete"==e){if(null!=u.selectedObject){for(let t=0;t<f.length;t++)f[t]==u.selectedObject&&f.splice(t--,1);for(let t=0;t<g.length;t++)g[t]!=u.selectedObject&&g[t].node!=u.selectedObject&&g[t].nodeA!=u.selectedObject&&g[t].nodeB!=u.selectedObject||g.splice(t--,1);u.selectedObject=null,X()}}else if("]"==e){if(null!=Y)for(let t=0;t<f.length;t++)f[t]==u.selectedObject&&($(u.selectedObject,f,g),u.selectedObject=null,X())}else if(1==e.length&&e.charCodeAt(0)&&e.charCodeAt(0)&&null!=u.selectedObject&&"text"in u.selectedObject)return u.selectedObject.text+=e,S(),X(),t.preventDefault(),!1}})),document.addEventListener("keyup",(function(t){"Shift"==k(t)&&(D=!1)}))})();