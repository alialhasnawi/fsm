{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./components/elements/self_link.ts","webpack:///./components/elements/abstract.ts","webpack:///./index.tsx","webpack:///./components/elements/node_link.ts","webpack:///./components/canvas/handlers.ts","webpack:///./components/canvas/collide.ts","webpack:///./components/canvas/canvas.tsx","webpack:///./components/action_bar/actions.ts","webpack:///./components/elements/start_link.ts","webpack:///./common/math.ts","webpack:///./export_as/latex.ts","webpack:///./algs/subset_construct.ts","webpack:///./algs/data.ts","webpack:///./algs/shared_utils.ts","webpack:///./components/elements/state_node.ts","webpack:///./export_as/png.ts","webpack:///./export_as/svg.ts","webpack:///./components/tool_bar/tool_bar.tsx","webpack:///../node_modules/.pnpm/preact-cli@3.3.3_26ed57f0a92fea1141353e0a8157fcb1/node_modules/preact-cli/lib/lib/entry.js","webpack:///./algs/constants.ts","webpack:///./store/files.ts","webpack:///./store/store.ts","webpack:///./store/effects.ts","webpack:///./store/undo_redo.ts","webpack:///./types.ts","webpack:///./algs/expr.ts","webpack:///./algs/eliminate.ts","webpack:///./components/tool_bar/tools.ts","webpack:///./components/elements/temporary_link.ts","webpack:///./components/elements/text_utils.ts","webpack:///../src/util.js","webpack:///../src/create-element.js","webpack:///../src/component.js","webpack:///../src/diff/children.js","webpack:///../src/diff/props.js","webpack:///../src/diff/index.js","webpack:///../src/render.js","webpack:///../src/clone-element.js","webpack:///../src/create-context.js","webpack:///../src/constants.js","webpack:///../src/options.js","webpack:///../src/diff/catch-error.js","webpack:///./components/action_bar/action_bar.tsx","webpack:///./components/elements/constants.ts","webpack:///./store/backup.ts"],"names":["__webpack_require__","moduleId","installedModules","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","SelfLink","DrawableElement","constructor","node","mouse","super","this","anchorAngle","mouseOffsetAngle","text","set_anchor_point","x","y","set_mouse_start","Math","atan2","snap","round","PI","abs","get_endpoints_and_circle","circleX","NODE_RADIUS","cos","circleY","sin","circleRadius","startAngle","endAngle","draw","with_caret","stuff","beginPath","arc","stroke","textX","textY","draw_text","selected","draw_arrow","endX","endY","contains_point","pos","dx","dy","distance","sqrt","HIT_TARGET_PADDING","curr_colour","SELECTED_COLOUR","active","ACTIVE_COLOUR","STANDARD_COLOUR","App","Component","componentWillMount","init","componentDidMount","canvas","get_canvas","render","id","href","mutate","restore_backup","reset_undo_redo","window","onkeydown","e","state","curr_tool","CanvasTool","DRAW_LINK","last_tool","Tools","length","mutate_with_args","preventDefault","onkeyup","NodeLink","a","b","nodeA","nodeB","lineAngleAdjust","parallelPart","perpendicularPart","get_anchor_point","scale","SNAP_TO_PADDING","midX","midY","start","closest_point_on_circle","end","anchor","circle","circleFromThreePoints","isReversed","reverseScale","radius","hasCircle","startX","startY","moveTo","lineTo","textAngle","percent","angle","temp","_CanvasHandler","sync_canvas_coordinates","cursor","mouse_down_pos","last_pos","obj_at_mouse_down","obj_at_last_pos","down","get_state","moving","button","MouseButton","LEFT","left_click","RIGHT","right_click","undefined","drag","StateNode","DRAW_NODE","DRAW_ACCEPT","ELIMINATE","subset_construct","prevent_default","update_object_at_cursor","event_to_canvas_space","nodes","links","object_at","Canvas","createRef","clearInterval","caret_interval","setState","caret_visible","zone","ctx","setTransform","zoom","draw_using","el","getContext","selected_zone","handlers","set_default_canvas","ref","current","onmousedown","mouse_down","onmousemove","mouse_move","onmouseup","mouse_up","ondblclick","dbl_click","oncontextmenu","onwheel","wheel","subscribe","access","componentWillUnmount","unsubscribe","shouldComponentUpdate","reinit_caret","width","CANVAS_SIZE","height","setInterval","caret_function","view","rect","getBoundingClientRect","clientX","clientY","point_to_canvas_space","with_border","selected_object","current_link","upper_left","lower_right","clearRect","save","lineWidth","fillStyle","strokeStyle","restore","reset_camera","view_zone","StartLink","deltaX","deltaY","get_start_point","get_endpoints","det","f","g","h","x1","y1","x2","y2","x3","y3","bx","by","fixed","number","digits","toFixed","replace","export_to_latex","exporter","ExportAsLaTeX","navigator","clipboard","writeText","toLaTeX","_points","_texData","_scale","min","max","push","fill","advancedFillText","originalText","angleOrNull","nodeParams","measure_text","translate","fa","FAData","load","is_deterministic","console","warn","starting_state","dfa","name_to_index","Map","names","state_stack","curr","dfa_start_set","get_equivalents","set","_set_to_string","start_state_names","Array","from","map","state_names","sort","join","some","accepting_states","includes","origin","pop","from_name","transitions","from_state_transitions","transition","keys","EPSILON","result","inplace_union","deep_delta","output","entries","to_name","has","add_transition","_subset_alg","new_nodes","new_links","create_elements","splice","replace_elements","arr","slice","node_to_index","to_symbol","isAcceptState","link","options","split","trim","option","opt","index","index_to_node","rand_pos","start_node","ends","end_node","random","add_transitions","to","shallow_dests","shallow_delta","stack","isArray","top","destinations","dest","values","trans_map","JSON","stringify","canvas_el","CANVAS_PADDING","mouseOffsetX","mouseOffsetY","export_to_png","document","createElement","save_canvas","file_name","export_to_svg","ExportAsSVG","save_file","toSVG","font","_svgData","_transX","_transY","style","useGreaterThan180","goInPositiveDirection","fillText","text_to_xml","ToolBar","Tool","tooltip","icon","tool_mode","POINTER","props","onClick","mutator","hydrate","Preact","interopDefault","default","normalizeURL","url","serviceWorker","register","__webpack_public_path__","require","root","getElementById","body","firstElementChild","app","preRenderData","inlineDataElement","querySelector","parse","decodeURI","innerHTML","CLI_DATA","currentURL","canHydrate","location","pathname","OPS","CONCAT","KLEIN","OR","OPEN_LEFT","CLOSE_RIGHT","INFIX_CHAR_OPS","BIN_OPS","FUNCTIONS_OPS","L_NON_CONCAT_OPS","R_NON_CONCAT_OPS","OP_PRECEDENCE","save_as","canvas_to_string","Date","toISOString","toDataURL","download","click","URL","revokeObjectURL","data","type","Blob","createObjectURL","open","async","Promise","resolve","f_input","accept","oninput","target","files","then","_open_text","rep","next_state","string_to_canvas","substring","lastIndexOf","force_update","error","component","_subscribers","_subscriber_map","subbed_keys","_canvas","_state","post_actions","actions","action","_post_effects","func","execute_actions","push_update","args","will_update","subscriber","comp","temp_link","active_objects","can","undo","redo","effect_undo_redo","effect_save_backup","_undo_stack","_redo_stack","_curr","prev","str","deselect","next_str","CanvasAction","to_RPN","lst","convert_latex_shortcuts","last","locator","score","_parse_tokens","op_stack","token","next","_eliminate","incoming_links","outgoing_links","self_links","self_reg","self_options","_","in_link","j","out_link","new_link","to_safe_str","strip_parenthesis","RegExp","indexOf","deletable","node_link_data","similar","minimize_links","rpn","charAt","update_select","at_cursor","draw_node","new_node","toggle_accept_state","obj","next_view","update_temp_link","start_pos","end_pos","TemporaryLink","end_temp_link","eliminate","should_update","delete_element","should_delete","type_text","delete_char","end_drag","prev_view","draw_space","exp","original_text","angle_or_null","is_selected","cornerPointX","cornerPointY","slide","pow","hasFocus","measureText","greek_letter_names","String","fromCharCode","toLowerCase","charCodeAt","assign","removeNode","parentNode","removeChild","children","normalizedProps","arguments","defaultProps","createVNode","original","vnode","vnodeId","Fragment","context","getDomSibling","childIndex","sibling","updateParentDomPointers","child","base","enqueueRender","rerenderQueue","process","prevDebounce","debounceRendering","defer","queue","commitQueue","oldVNode","oldDom","parentDom","diff","ownerSVGElement","commitRoot","diffChildren","renderResult","newParentVNode","oldParentVNode","globalContext","isSvg","excessDomChildren","isHydrating","childVNode","newDom","firstChildDom","refs","oldChildren","EMPTY_ARR","oldChildrenLength","EMPTY_OBJ","reorderChildren","placeChild","unmount","applyRef","tmp","toChildArray","out","nextDom","sibDom","outer","appendChild","nextSibling","insertBefore","setStyle","setProperty","IS_NON_DIMENSIONAL","test","dom","oldValue","useCapture","cssText","_listeners","addEventListener","eventProxyCapture","eventProxy","removeEventListener","setAttribute","removeAttribute","event","newVNode","isNew","oldProps","oldState","snapshot","clearProcessingException","newProps","provider","componentContext","newType","contextType","doRender","sub","getDerivedStateFromProps","componentWillReceiveProps","forEach","componentWillUpdate","componentDidUpdate","getChildContext","getSnapshotBeforeUpdate","diffElementNodes","diffed","cb","oldHtml","newHtml","nodeType","localName","createTextNode","createElementNS","is","childNodes","dangerouslySetInnerHTML","attributes","diffProps","checked","parentVNode","skipRemove","replaceNode","firstChild","cloneElement","createContext","defaultValue","contextId","Consumer","contextValue","Provider","subs","_props","old","isValidElement","ctor","handled","getDerivedStateFromError","componentDidCatch","update","callback","forceUpdate","setTimeout","ActionBar","Action","handle_click","localStorage","storage","getItem","json","backup","backupNode","backupLink","backup_link"],"mappings":"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","file":"bundle.42efa.esm.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/fsm/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"e4PF\");\n","import { FSMContext, Point2D, SelfLinkCircle } from \"../../types\";\r\nimport { DrawableElement } from \"./abstract\";\r\nimport { HIT_TARGET_PADDING, NODE_RADIUS } from \"./constants\";\r\nimport { StateNode } from \"./state_node\";\r\nimport { draw_arrow, draw_text } from \"./text_utils\";\r\n\r\n/** A circular link connecting a state to itself. */\r\nexport class SelfLink extends DrawableElement {\r\n\tpublic node: StateNode;\r\n\tpublic text: string;\r\n\tpublic anchorAngle: number;\r\n\tprivate mouseOffsetAngle: number;\r\n\r\n\tconstructor(node: StateNode, mouse?: Point2D) {\r\n\t\tsuper();\r\n\t\tthis.node = node;\r\n\t\tthis.anchorAngle = 0;\r\n\t\tthis.mouseOffsetAngle = 0;\r\n\t\tthis.text = '';\r\n\r\n\t\tif (mouse) {\r\n\t\t\tthis.set_anchor_point(mouse.x, mouse.y);\r\n\t\t}\r\n\t}\r\n\r\n\tset_mouse_start(x: number, y: number) {\r\n\t\tthis.mouseOffsetAngle = this.anchorAngle - Math.atan2(y - this.node.y, x - this.node.x);\r\n\t};\r\n\r\n\tset_anchor_point(x: number, y: number) {\r\n\t\tthis.anchorAngle = Math.atan2(y - this.node.y, x - this.node.x) + this.mouseOffsetAngle;\r\n\t\t// snap to 90 degrees\r\n\t\tconst snap = Math.round(this.anchorAngle / (Math.PI / 2)) * (Math.PI / 2);\r\n\t\tif (Math.abs(this.anchorAngle - snap) < 0.1) this.anchorAngle = snap;\r\n\t\t// keep in the range -pi to pi so our containsPoint() function always works\r\n\t\tif (this.anchorAngle < -Math.PI) this.anchorAngle += 2 * Math.PI;\r\n\t\tif (this.anchorAngle > Math.PI) this.anchorAngle -= 2 * Math.PI;\r\n\t};\r\n\r\n\tprivate get_endpoints_and_circle(): SelfLinkCircle {\r\n\t\tconst circleX = this.node.x + 1.5 * NODE_RADIUS * Math.cos(this.anchorAngle);\r\n\t\tconst circleY = this.node.y + 1.5 * NODE_RADIUS * Math.sin(this.anchorAngle);\r\n\t\tconst circleRadius = 0.75 * NODE_RADIUS;\r\n\t\tconst startAngle = this.anchorAngle - Math.PI * 0.8;\r\n\t\tconst endAngle = this.anchorAngle + Math.PI * 0.8;\r\n\t\tconst startX = circleX + circleRadius * Math.cos(startAngle);\r\n\t\tconst startY = circleY + circleRadius * Math.sin(startAngle);\r\n\t\tconst endX = circleX + circleRadius * Math.cos(endAngle);\r\n\t\tconst endY = circleY + circleRadius * Math.sin(endAngle);\r\n\t\treturn {\r\n\t\t\t'hasCircle': true,\r\n\t\t\t'startX': startX,\r\n\t\t\t'startY': startY,\r\n\t\t\t'endX': endX,\r\n\t\t\t'endY': endY,\r\n\t\t\t'startAngle': startAngle,\r\n\t\t\t'endAngle': endAngle,\r\n\t\t\t'circleX': circleX,\r\n\t\t\t'circleY': circleY,\r\n\t\t\t'circleRadius': circleRadius\r\n\t\t};\r\n\t}\r\n\r\n\tdraw(c: FSMContext, with_caret: boolean = false) {\r\n\t\tconst stuff = this.get_endpoints_and_circle();\r\n\t\t// draw arc\r\n\t\tc.beginPath();\r\n\t\tc.arc(stuff.circleX, stuff.circleY, stuff.circleRadius, stuff.startAngle, stuff.endAngle, false);\r\n\t\tc.stroke();\r\n\t\t// draw the text on the loop farthest from the node\r\n\t\tconst textX = stuff.circleX + stuff.circleRadius * Math.cos(this.anchorAngle);\r\n\t\tconst textY = stuff.circleY + stuff.circleRadius * Math.sin(this.anchorAngle);\r\n\t\tdraw_text(c, this.text, textX, textY, this.anchorAngle, this.selected, with_caret);\r\n\t\t// draw the head of the arrow\r\n\t\tdraw_arrow(c, stuff.endX, stuff.endY, stuff.endAngle + Math.PI * 0.4);\r\n\t}\r\n\r\n\tcontains_point(pos: Point2D) {\r\n\t\tconst stuff = this.get_endpoints_and_circle();\r\n\t\tconst dx = pos.x - stuff.circleX;\r\n\t\tconst dy = pos.y - stuff.circleY;\r\n\t\tconst distance = Math.sqrt(dx * dx + dy * dy) - stuff.circleRadius;\r\n\t\treturn (Math.abs(distance) < HIT_TARGET_PADDING);\r\n\t}\r\n}","/**\n * Parent class and types of nodes and links.\n */\n\nimport { FSMContext, Point2D } from \"../../types\";\nimport { ACTIVE_COLOUR, SELECTED_COLOUR, STANDARD_COLOUR } from \"./constants\";\nimport { NodeLink } from \"./node_link\";\nimport { SelfLink } from \"./self_link\";\nimport { StartLink } from \"./start_link\";\nimport { StateNode } from \"./state_node\";\nimport { TemporaryLink } from \"./temporary_link\";\n\n/**\n * A canvas element which can be drawn using a canvas context.\n */\nexport abstract class DrawableElement {\n    public selected: boolean = false;\n    public active: boolean = false;\n    public text: string = '';\n\n    abstract draw(ctx: FSMContext, with_caret: boolean): void;\n\n    public curr_colour(): string {\n        if (this.selected)\n            return SELECTED_COLOUR;\n        if (this.active)\n            return ACTIVE_COLOUR;\n        return STANDARD_COLOUR;\n    }\n\n    abstract contains_point(pos: Point2D): boolean;\n    abstract set_anchor_point(x: number, y: number): void;\n}\n\nexport type FSMLink = NodeLink | SelfLink | StartLink;\nexport type AnyLink = FSMLink | TemporaryLink;\nexport type FSMStringableElement = StateNode | FSMLink;\nexport type FSMElementString = string;\n","/**\n * Bind key handlers and render the app.\n */\n\nimport { Component, Fragment, h } from 'preact';\nimport { ActionBar } from './components/action_bar/action_bar';\nimport { Canvas } from './components/canvas/canvas';\nimport * as Tools from './components/tool_bar/tools';\nimport { ToolBar } from './components/tool_bar/tool_bar';\nimport { restore_backup } from './store/backup';\nimport { get_canvas, mutate, mutate_with_args } from './store/store';\nimport { reset_undo_redo } from './store/undo_redo';\nimport './style/main.css';\nimport { CanvasTool, State } from './types';\n\n\nclass App extends Component {\n    private canvas: Canvas | undefined;\n\n\n    componentWillMount() {\n        this.init();\n    }\n\n    componentDidMount() {\n        this.canvas = get_canvas();\n    }\n\n    render() {\n        return (\n            <>\n                <div id=\"preact_root\">\n                    <ActionBar />\n                    <ToolBar />\n                    <Canvas />\n                </div>\n                <div>\n                    {/* <p class=\"center\">Export as: <a id=\"a-saveAsPNG\">PNG</a> | <a id=\"a-saveAsSVG\">SVG</a>\n                        | <a id=\"a-saveAsLaTeX\">LaTeX</a></p> */}\n                    <textarea id=\"output\"></textarea>\n                    <p>The big white box above is the FSM designer.&nbsp; Here's how to use it:</p>\n                    <ul>\n                        <li><b>Add a state:</b> double-click on the canvas</li>\n                        <li><b>Add an arrow:</b> shift-drag on the canvas</li>\n                        <li><b>Move something:</b> drag it around</li>\n                        <li><b>Delete something:</b> click it and press the delete key (not the backspace key)</li>\n                    </ul>\n                    <ul>\n                        <li><b>Make accept state:</b> double-click on an existing state</li>\n                        <li><b>Type numeric subscript:</b> put an underscore before the number (like \"S_0\")</li>\n                        <li><b>Type greek letter:</b> put a backslash before it (like \"\\beta\")</li>\n                        <li><b>Eliminate a non-accept, non-start state:</b> use the state tool or press ]</li>\n                        <li><b>Perform subset construction:</b> right click anywhere on the canvas</li>\n                    </ul>\n                    <p>This was made in HTML5 and JavaScript using the canvas element.</p>\n                </div>\n                <p>Created by <a href=\"http://madebyevan.com/\">Evan Wallace</a> in 2010 <br />\n                    + Extended by <a href=\"https://alialhasnawi.github.io/\">Ali Al-Hasnawi in 2021</a>\n                </p>\n            </>\n        );\n    };\n\n    init(): void {\n        /** On initialized. */\n        mutate(restore_backup);\n        mutate(reset_undo_redo);\n\n        // Bind keyboard shortcuts.\n        if (typeof window != 'undefined') {\n            window.onkeydown = e => {\n                switch (e.key) {\n                    // Shift activates link drawing.\n                    case 'Shift': mutate((state: State) => {\n                        // Note: This is an illegal mutation of last_tool for reducing render calls.\n                        if (state.curr_tool == CanvasTool.DRAW_LINK) { state.last_tool = state.curr_tool; return; };\n                        state.curr_tool = CanvasTool.DRAW_LINK;\n                        return ['curr_tool'];\n                    }, false); break;\n\n                    // Backspace deletes text.\n                    case 'Backspace': mutate(Tools.delete_char, false); break;\n\n                    // ] is for state elimination.\n                    case ']': mutate(Tools.eliminate); break;\n\n                    // Delete is for deleting the element.\n                    case 'Delete': mutate(Tools.delete_element); break;\n\n                    // Try to enter a key.\n                    default: if (e.key.length == 1) {\n                        mutate_with_args(Tools.type_text, false, e.key);\n                    }\n\n                }\n\n                // Prevent actions.\n                e.preventDefault();\n                return false;\n            }\n\n            window.onkeyup = e => {\n                if (e.key == 'Shift') {\n                    // Unshifting return to node drawing.\n                    mutate((state: State) => {\n                        if (state.curr_tool != CanvasTool.DRAW_LINK) return;\n                        state.curr_tool = state.last_tool;\n                        return ['curr_tool'];\n                    }, false);\n\n                }\n\n                // Prevent actions.\n                e.preventDefault();\n                return false;\n            }\n        }\n    }\n}\n\nexport default App;","import { circleFromThreePoints } from \"../../common/math\";\r\nimport { FSMContext, NodeLinkEndPointsAndCircle, Point2D } from \"../../types\";\r\nimport { DrawableElement } from \"./abstract\";\r\nimport { HIT_TARGET_PADDING, NODE_RADIUS, SNAP_TO_PADDING } from \"./constants\";\r\nimport { StateNode } from \"./state_node\";\r\nimport { draw_arrow, draw_text } from \"./text_utils\";\r\n\r\n/** A link connecting 2 nodes. */\r\nexport class NodeLink extends DrawableElement {\r\n\tpublic nodeA: StateNode;\r\n\tpublic nodeB: StateNode;\r\n\tpublic text: string;\r\n\tpublic lineAngleAdjust: number;\r\n\tpublic parallelPart: number;\r\n\tpublic perpendicularPart: number;\r\n\r\n\tconstructor(a: StateNode, b: StateNode) {\r\n\t\tsuper();\r\n\t\tthis.nodeA = a;\r\n\t\tthis.nodeB = b;\r\n\t\tthis.text = '';\r\n\t\tthis.lineAngleAdjust = 0; // value to add to textAngle when link is straight line\r\n\r\n\t\t// make anchor point relative to the locations of nodeA and nodeB\r\n\t\tthis.parallelPart = 0.5; // percentage from nodeA to nodeB\r\n\t\tthis.perpendicularPart = 0; // pixels from line between nodeA and nodeB\r\n\t}\r\n\r\n\tget_anchor_point(): Point2D {\r\n\t\tconst dx = this.nodeB.x - this.nodeA.x;\r\n\t\tconst dy = this.nodeB.y - this.nodeA.y;\r\n\t\tconst scale = Math.sqrt(dx * dx + dy * dy);\r\n\t\treturn {\r\n\t\t\t'x': this.nodeA.x + dx * this.parallelPart - dy * this.perpendicularPart / scale,\r\n\t\t\t'y': this.nodeA.y + dy * this.parallelPart + dx * this.perpendicularPart / scale\r\n\t\t};\r\n\t};\r\n\r\n\tset_anchor_point(x: number, y: number) {\r\n\t\tconst dx = this.nodeB.x - this.nodeA.x;\r\n\t\tconst dy = this.nodeB.y - this.nodeA.y;\r\n\t\tconst scale = Math.sqrt(dx * dx + dy * dy);\r\n\t\tthis.parallelPart = (dx * (x - this.nodeA.x) + dy * (y - this.nodeA.y)) / (scale * scale);\r\n\t\tthis.perpendicularPart = (dx * (y - this.nodeA.y) - dy * (x - this.nodeA.x)) / scale;\r\n\t\t// snap to a straight line\r\n\t\tif (this.parallelPart > 0 && this.parallelPart < 1 && Math.abs(this.perpendicularPart) < SNAP_TO_PADDING) {\r\n\t\t\tthis.lineAngleAdjust = +(this.perpendicularPart < 0) * Math.PI;\r\n\t\t\tthis.perpendicularPart = 0;\r\n\t\t}\r\n\t};\r\n\r\n\tprivate get_endpoints_and_circle(): NodeLinkEndPointsAndCircle {\r\n\t\tif (this.perpendicularPart == 0) {\r\n\t\t\tconst midX = (this.nodeA.x + this.nodeB.x) / 2;\r\n\t\t\tconst midY = (this.nodeA.y + this.nodeB.y) / 2;\r\n\t\t\tconst start = this.nodeA.closest_point_on_circle(midX, midY);\r\n\t\t\tconst end = this.nodeB.closest_point_on_circle(midX, midY);\r\n\t\t\treturn {\r\n\t\t\t\t'hasCircle': false,\r\n\t\t\t\t'startX': start.x,\r\n\t\t\t\t'startY': start.y,\r\n\t\t\t\t'endX': end.x,\r\n\t\t\t\t'endY': end.y,\r\n\t\t\t};\r\n\t\t}\r\n\t\tconst anchor = this.get_anchor_point();\r\n\t\tconst circle = circleFromThreePoints(this.nodeA.x, this.nodeA.y, this.nodeB.x, this.nodeB.y, anchor.x, anchor.y);\r\n\t\tconst isReversed = (this.perpendicularPart > 0);\r\n\t\tconst reverseScale = isReversed ? 1 : -1;\r\n\t\tconst startAngle = Math.atan2(this.nodeA.y - circle.y, this.nodeA.x - circle.x) - reverseScale * NODE_RADIUS / circle.radius;\r\n\t\tconst endAngle = Math.atan2(this.nodeB.y - circle.y, this.nodeB.x - circle.x) + reverseScale * NODE_RADIUS / circle.radius;\r\n\t\tconst startX = circle.x + circle.radius * Math.cos(startAngle);\r\n\t\tconst startY = circle.y + circle.radius * Math.sin(startAngle);\r\n\t\tconst endX = circle.x + circle.radius * Math.cos(endAngle);\r\n\t\tconst endY = circle.y + circle.radius * Math.sin(endAngle);\r\n\t\treturn {\r\n\t\t\thasCircle: true,\r\n\t\t\tstartX: startX,\r\n\t\t\tstartY: startY,\r\n\t\t\tendX: endX,\r\n\t\t\tendY: endY,\r\n\t\t\tstartAngle: startAngle,\r\n\t\t\tendAngle: endAngle,\r\n\t\t\tcircleX: circle.x,\r\n\t\t\tcircleY: circle.y,\r\n\t\t\tcircleRadius: circle.radius,\r\n\t\t\treverseScale: reverseScale,\r\n\t\t\tisReversed: isReversed,\r\n\t\t};\r\n\t};\r\n\r\n\tdraw(c: FSMContext, with_caret: boolean = false) {\r\n\t\t\r\n\t\tconst stuff = this.get_endpoints_and_circle();\r\n\t\t// draw arc\r\n\t\tc.beginPath();\r\n\t\tif (stuff.hasCircle) {\r\n\t\t\tc.arc(stuff.circleX, stuff.circleY, stuff.circleRadius, stuff.startAngle, stuff.endAngle, stuff.isReversed);\r\n\t\t} else {\r\n\t\t\tc.moveTo(stuff.startX, stuff.startY);\r\n\t\t\tc.lineTo(stuff.endX, stuff.endY);\r\n\t\t}\r\n\t\tc.stroke();\r\n\t\t// draw the head of the arrow\r\n\t\tif (stuff.hasCircle) {\r\n\t\t\tdraw_arrow(c, stuff.endX, stuff.endY, stuff.endAngle - stuff.reverseScale * (Math.PI / 2));\r\n\t\t} else {\r\n\t\t\tdraw_arrow(c, stuff.endX, stuff.endY, Math.atan2(stuff.endY - stuff.startY, stuff.endX - stuff.startX));\r\n\t\t}\r\n\t\t// draw the text\r\n\t\tif (stuff.hasCircle) {\r\n\t\t\tlet startAngle = stuff.startAngle;\r\n\t\t\tlet endAngle = stuff.endAngle;\r\n\t\t\tif (endAngle < startAngle) {\r\n\t\t\t\tendAngle += Math.PI * 2;\r\n\t\t\t}\r\n\t\t\tconst textAngle = (startAngle + endAngle) / 2 + +stuff.isReversed * Math.PI;\r\n\t\t\tconst textX = stuff.circleX + stuff.circleRadius * Math.cos(textAngle);\r\n\t\t\tconst textY = stuff.circleY + stuff.circleRadius * Math.sin(textAngle);\r\n\t\t\tdraw_text(c, this.text, textX, textY, textAngle, this.selected, with_caret);\r\n\t\t} else {\r\n\t\t\tconst textX = (stuff.startX + stuff.endX) / 2;\r\n\t\t\tconst textY = (stuff.startY + stuff.endY) / 2;\r\n\t\t\tconst textAngle = Math.atan2(stuff.endX - stuff.startX, stuff.startY - stuff.endY);\r\n\t\t\tdraw_text(c, this.text, textX, textY, textAngle + this.lineAngleAdjust, this.selected, with_caret);\r\n\t\t}\r\n\t};\r\n\r\n\tcontains_point(pos: Point2D) {\r\n\t\tconst x = pos.x;\r\n\t\tconst y = pos.y;\r\n\t\tconst stuff = this.get_endpoints_and_circle();\r\n\t\tif (stuff.hasCircle) {\r\n\t\t\tconst dx = x - stuff.circleX;\r\n\t\t\tconst dy = y - stuff.circleY;\r\n\t\t\tconst distance = Math.sqrt(dx * dx + dy * dy) - stuff.circleRadius;\r\n\t\t\tif (Math.abs(distance) < HIT_TARGET_PADDING) {\r\n\t\t\t\tlet angle = Math.atan2(dy, dx);\r\n\t\t\t\tlet startAngle = stuff.startAngle;\r\n\t\t\t\tlet endAngle = stuff.endAngle;\r\n\t\t\t\tif (stuff.isReversed) {\r\n\t\t\t\t\tconst temp = startAngle;\r\n\t\t\t\t\tstartAngle = endAngle;\r\n\t\t\t\t\tendAngle = temp;\r\n\t\t\t\t}\r\n\t\t\t\tif (endAngle < startAngle) {\r\n\t\t\t\t\tendAngle += Math.PI * 2;\r\n\t\t\t\t}\r\n\t\t\t\tif (angle < startAngle) {\r\n\t\t\t\t\tangle += Math.PI * 2;\r\n\t\t\t\t} else if (angle > endAngle) {\r\n\t\t\t\t\tangle -= Math.PI * 2;\r\n\t\t\t\t}\r\n\t\t\t\treturn (angle > startAngle && angle < endAngle);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tconst dx = stuff.endX - stuff.startX;\r\n\t\t\tconst dy = stuff.endY - stuff.startY;\r\n\t\t\tconst length = Math.sqrt(dx * dx + dy * dy);\r\n\t\t\tconst percent = (dx * (x - stuff.startX) + dy * (y - stuff.startY)) / (length * length);\r\n\t\t\tconst distance = (dx * (y - stuff.startY) - dy * (x - stuff.startX)) / length;\r\n\t\t\treturn (percent > 0 && percent < 1 && Math.abs(distance) < HIT_TARGET_PADDING);\r\n\t\t}\r\n\t\treturn false;\r\n\t};\r\n}","/**\n * Canvas input handlers.\n * \n * @note Move this to a class in the future to avoid dependencies.\n */\n\nimport { subset_construct } from \"../../algs/subset_construct\";\nimport { get_state, mutate, mutate_with_args } from \"../../store/store\";\nimport { CanvasTool, MouseButton } from \"../../types\";\nimport { StateNode } from \"../elements/state_node\";\nimport * as Tools from \"../tool_bar/tools\";\nimport { Canvas } from \"./canvas\";\nimport { object_at } from \"./collide\";\n\nexport class _CanvasHandler {\n    private canvas: Canvas;\n\n    constructor(canvas: Canvas) {\n        this.canvas = canvas;\n    }\n\n    /** Dummy event handler. */\n    prevent_default(e: Event) {\n        e.preventDefault();\n        return false;\n    }\n\n    /**\n     * Sync up the state's cursor with the given mouse event.\n     * @param canvas_coord Point in canvas element space.\n     */\n    sync_canvas_coordinates(e: MouseEvent, update_object_at_cursor: boolean = false) {\n        this.canvas.cursor.last_pos = this.canvas.event_to_canvas_space(e);\n        if (update_object_at_cursor) this.canvas.cursor.obj_at_last_pos = object_at(this.canvas.cursor.last_pos);\n    }\n\n    mouse_down = (e: MouseEvent) => {\n        // Update cursor.\n        this.sync_canvas_coordinates(e, true);\n        this.canvas.cursor.mouse_down_pos = { ... this.canvas.cursor.last_pos };\n        this.canvas.cursor.obj_at_mouse_down = this.canvas.cursor.obj_at_last_pos;\n\n        // Select if possible.\n        mutate(Tools.update_select);\n        this.canvas.cursor.down = true;\n\n\n        // Hand over control to tools.\n        switch (get_state('curr_tool')) {\n            case CanvasTool.DRAW_LINK: mutate(Tools.update_temp_link, false);\n        }\n\n        this.canvas.cursor.moving = false;\n    }\n\n    mouse_up = (e: MouseEvent) => {\n        // Update cursor.\n        this.sync_canvas_coordinates(e);\n        this.canvas.cursor.down = false;\n\n        if (this.canvas.cursor.moving) {\n            mutate(Tools.end_drag);\n        } else {\n            // The mouse was clicked.\n            if (e.button == MouseButton.LEFT)\n                this.left_click();\n            else if (e.button == MouseButton.RIGHT)\n                this.right_click();\n        }\n\n        // Pop the temp link if it exists.\n        if (get_state('temp_link') != undefined) mutate(Tools.end_temp_link);\n\n        this.canvas.cursor.moving = false;\n\n        e.preventDefault();\n        return false;\n    }\n\n    mouse_move = (e: MouseEvent) => {\n        // Update cursor.\n        this.sync_canvas_coordinates(e, true);\n        this.canvas.cursor.moving = true;\n\n        // Only drag if the mouse was down.\n        if (this.canvas.cursor.down) {\n            this.drag();\n        }\n    }\n\n    dbl_click = (e: MouseEvent) => {\n        // Shortcut for node creation / toggling accept state ported from original.\n        this.sync_canvas_coordinates(e);\n\n        const obj = this.canvas.cursor.obj_at_last_pos;\n\n        if (obj instanceof StateNode)\n            // Toggle accept.\n            mutate(Tools.toggle_accept_state);\n        else\n            // Create node.\n            mutate(Tools.draw_node);\n    }\n\n    wheel = (e: WheelEvent) => {\n        if (!this.canvas.cursor.down) {\n            mutate_with_args(Tools.zoom, true, e);\n\n            e.preventDefault();\n            return false;\n        }\n    }\n\n    private drag = () => {\n        switch (get_state('curr_tool')) {\n            // A link is being drawn.\n            case CanvasTool.DRAW_LINK: { mutate(Tools.update_temp_link, false); break; }\n            // An object is being dragged.\n            default: mutate(Tools.drag, false);\n        }\n    }\n\n    private left_click = () => {\n        switch (get_state('curr_tool')) {\n            // A node is being created.\n            case CanvasTool.DRAW_NODE: mutate(Tools.draw_node); break;\n            case CanvasTool.DRAW_ACCEPT: mutate(Tools.toggle_accept_state); break;\n            case CanvasTool.ELIMINATE: mutate(Tools.eliminate); break;\n        }\n    }\n\n    private right_click = () => {\n        mutate(subset_construct);\n    }\n}\n\n","/** \n * Collision detection of states and nodes.\n */\n\nimport { get_state } from \"../../store/store\";\nimport { Point2D } from \"../../types\";\nimport { DrawableElement } from \"../elements/abstract\";\n\nexport function object_at(pos: Point2D): DrawableElement | undefined {\n    const nodes = get_state('nodes');\n    const links = get_state('links');\n\n    for (let i = 0; i < nodes.length; i++) {\n        if (nodes[i].contains_point(pos)) {\n            return nodes[i];\n        }\n    }\n    for (let i = 0; i < links.length; i++) {\n        if (links[i].contains_point(pos)) {\n            return links[i];\n        }\n    }\n\n    return undefined;\n}","/**\n * Canvas component wrapper and event binder.\n * The Canvas retains and updates its own cursor data state.\n */\n\nimport { Component, ComponentChild, createRef, h } from \"preact\";\nimport { access, get_state, set_default_canvas, subscribe, unsubscribe } from \"../../store/store\";\nimport { CanvasRectangle, CanvasViewTransform, FSMContext, Point2D } from \"../../types\";\nimport { DrawableElement } from \"../elements/abstract\";\nimport { CANVAS_SIZE } from \"../elements/constants\";\nimport { _CanvasHandler } from \"./handlers\";\n\nimport './style.css';\n\n/** State only accessible to the canvas and it's handlers. */\ntype CanvasRenderState = {\n    caret_visible: boolean,\n    selected_zone: CanvasRectangle | undefined,\n};\n\ntype CursorData = {\n    mouse_down_pos: Point2D,\n    obj_at_mouse_down: DrawableElement | undefined,\n    last_pos: Point2D,\n    obj_at_last_pos: DrawableElement | undefined,\n    down: boolean,\n    moving: boolean,\n};\n\nexport class Canvas extends Component<any, CanvasRenderState> {\n    private ref = createRef();\n    public el: HTMLCanvasElement | undefined;\n\n    public ctx: CanvasRenderingContext2D | undefined;\n    public cursor: CursorData;\n\n    private handlers: _CanvasHandler;\n\n    private caret_interval: number = -1;\n\n    constructor() {\n        super();\n        this.state = {\n            caret_visible: false,\n            selected_zone: undefined,\n        };\n        this.cursor = {\n            mouse_down_pos: { x: 0, y: 0 },\n            obj_at_mouse_down: undefined,\n            last_pos: { x: 0, y: 0 },\n            obj_at_last_pos: undefined,\n            down: false,\n            moving: false,\n        };\n        this.handlers = new _CanvasHandler(this);\n    }\n\n    componentDidMount() {\n        set_default_canvas(this);\n        this.el = this.ref.current;\n        this.ctx = this.el!.getContext('2d')!;\n\n        this.el!.onmousedown = this.handlers.mouse_down;\n        this.el!.onmousemove = this.handlers.mouse_move;\n        this.el!.onmouseup = this.handlers.mouse_up;\n        this.el!.ondblclick = this.handlers.dbl_click;\n        this.el!.oncontextmenu = this.handlers.prevent_default;\n        this.el!.onwheel = this.handlers.wheel;\n\n        subscribe(['nodes', 'links', 'active_objects', 'selected_object', 'temp_link', 'view_zone'], this);\n        access(this.draw);\n    }\n\n    componentWillUnmount() {\n        unsubscribe(this);\n    }\n\n    shouldComponentUpdate() {\n        this.reinit_caret();\n        this.draw();\n        return false;\n    }\n\n    render(): ComponentChild {\n        return (\n            <canvas ref={this.ref} id=\"canvas\" width={CANVAS_SIZE.x} height={CANVAS_SIZE.y}>\n                <span>Your browser does not support<br />the HTML5 &lt;canvas&gt; element</span>\n            </canvas>\n        );\n    }\n\n    /** Restart the caret blink interval. */\n    reinit_caret() {\n        if (get_state('selected_object') != null && this.caret_interval == -1) {\n            this.caret_interval = window.setInterval(this.caret_function, 300);\n        }\n    }\n\n    private caret_function = () => {\n        if (get_state('selected_object') == null) {\n            window.clearInterval(this.caret_interval);\n            this.caret_interval = -1;\n        } else {\n            this.setState({ caret_visible: !this.state.caret_visible });\n        }\n    }\n\n    /**\n     * Convert a mouse event to it's corresponding point in canvas draw space.\n     */\n    public event_to_canvas_space(e: MouseEvent): Point2D {\n        const view = get_state('view_zone');\n        const rect = this.el!.getBoundingClientRect();\n        const element_space = {\n            x: e.clientX - rect.x,\n            y: e.clientY - rect.y,\n        };\n\n        // Apply the inverse of the view transform.\n        return {\n            x: (element_space.x - view.x) / view.zoom,\n            y: (element_space.y - view.y) / view.zoom,\n        }\n    }\n\n    /** Convert a point in canvas element space to it's corresponding point in canvas draw space. */\n    public point_to_canvas_space(p: Point2D): Point2D {\n        const view = get_state('view_zone');\n\n        // Apply the inverse of the view transform.\n        return {\n            x: (p.x - view.x) / view.zoom,\n            y: (p.y - view.y) / view.zoom,\n        }\n    }\n\n    /** Draw the canvas using its own 2D context. */\n    draw = () => {\n        const zone = get_state('view_zone');\n\n        if (this.ctx != null) {\n            this.ctx.setTransform(zone.zoom, 0, 0, zone.zoom, zone.x, zone.y);\n            this.draw_using(this.ctx, true);\n        } else if (this.el != null) {\n            const ctx = this.el.getContext(\"2d\");\n            if (ctx != null) {\n                this.ctx = ctx;\n                ctx.setTransform(zone.zoom, 0, 0, zone.zoom, zone.x, zone.y);\n                this.draw_using(ctx, true);\n            }\n        }\n    }\n\n    draw_using(ctx: FSMContext, with_border: boolean = false) {\n        if (this.el != null) {\n            const nodes = get_state(\"nodes\");\n            const links = get_state(\"links\");\n            const selected_object = get_state(\"selected_object\");\n            const current_link = get_state(\"temp_link\");\n\n            // Draw rectangle.\n            const upper_left = this.point_to_canvas_space({ x: 0, y: 0 });\n            const lower_right = this.point_to_canvas_space({ x: this.el.width, y: this.el.height });\n            ctx.clearRect(upper_left.x, upper_left.y, lower_right.x - upper_left.x, lower_right.y - upper_left.y);\n            ctx.save();\n\n            if (with_border) {\n                ctx.beginPath();\n                ctx.rect(-1, -1, this.el.width + 2, this.el.height + 2);\n                ctx.stroke();\n            }\n\n            for (let i = 0; i < nodes.length; i++) {\n                ctx.lineWidth = 1;\n                ctx.fillStyle = ctx.strokeStyle = nodes[i].curr_colour();\n                nodes[i].draw(ctx, nodes[i] == selected_object && this.state.caret_visible);\n            }\n            for (let i = 0; i < links.length; i++) {\n                ctx.lineWidth = 1;\n                ctx.fillStyle = ctx.strokeStyle = links[i].curr_colour();\n                links[i].draw(ctx, links[i] == selected_object && this.state.caret_visible);\n            }\n            if (current_link != null) {\n                ctx.lineWidth = 1;\n                ctx.fillStyle = ctx.strokeStyle = 'black';\n                current_link.draw(ctx, current_link == selected_object && this.state.caret_visible);\n            }\n\n            // // Debug.\n            // ctx.fillStyle = ctx.strokeStyle = 'magenta';\n            // if (this.cursor.obj_at_mouse_down != null) this.cursor.obj_at_mouse_down.draw(ctx, false);\n            // ctx.fillStyle = ctx.strokeStyle = 'lime';\n            // if (this.cursor.obj_at_last_pos != null) this.cursor.obj_at_last_pos.draw(ctx, false);\n\n            ctx.restore();\n        }\n    }\n}","import { State, StateKey } from \"../../types\";\n\nexport { redo, undo } from \"../../store/undo_redo\";\nexport { subset_construct } from \"../../algs/subset_construct\";\n\nexport function reset_camera(state: State): StateKey[] | undefined {\n    state.view_zone = { zoom: 1, x: 0, y: 0 };\n\n    return ['view_zone'];\n}\n\nexport {open, save_as} from \"../../store/files\";","import { FSMContext, Point2D } from \"../../types\";\r\nimport { DrawableElement } from \"./abstract\";\r\nimport { HIT_TARGET_PADDING, SNAP_TO_PADDING } from \"./constants\";\r\nimport { StateNode } from \"./state_node\";\r\nimport { draw_arrow, draw_text } from \"./text_utils\";\r\n\r\n/** A link from a textbox to a node. */\r\nexport class StartLink extends DrawableElement {\r\n\tpublic node: StateNode;\r\n\tpublic deltaX: number;\r\n\tpublic deltaY: number;\r\n\tpublic text: string;\r\n\r\n\tconstructor(node: StateNode, start?: Point2D) {\r\n\t\tsuper();\r\n\t\tthis.node = node;\r\n\t\tthis.deltaX = 0;\r\n\t\tthis.deltaY = 0;\r\n\t\tthis.text = '';\r\n\r\n\t\tif (start) {\r\n\t\t\tthis.set_anchor_point(start.x, start.y);\r\n\t\t}\r\n\t}\r\n\r\n\tset_anchor_point(x: number, y: number) {\r\n\t\tthis.deltaX = x - this.node.x;\r\n\t\tthis.deltaY = y - this.node.y;\r\n\r\n\t\tif (Math.abs(this.deltaX) < SNAP_TO_PADDING) {\r\n\t\t\tthis.deltaX = 0;\r\n\t\t}\r\n\r\n\t\tif (Math.abs(this.deltaY) < SNAP_TO_PADDING) {\r\n\t\t\tthis.deltaY = 0;\r\n\t\t}\r\n\t};\r\n\r\n\tget_start_point() {\r\n\t\treturn {\r\n\t\t\tx: this.node.x + this.deltaX,\r\n\t\t\ty: this.node.y + this.deltaY\r\n\t\t}\r\n\t}\r\n\r\n\tget_endpoints() {\r\n\t\tconst startX = this.node.x + this.deltaX;\r\n\t\tconst startY = this.node.y + this.deltaY;\r\n\t\tconst end = this.node.closest_point_on_circle(startX, startY);\r\n\t\treturn {\r\n\t\t\t'startX': startX,\r\n\t\t\t'startY': startY,\r\n\t\t\t'endX': end.x,\r\n\t\t\t'endY': end.y,\r\n\t\t};\r\n\t};\r\n\r\n\tdraw(c: FSMContext, with_caret: boolean = false) {\r\n\t\tconst stuff = this.get_endpoints();\r\n\r\n\t\t// draw the line\r\n\t\tc.beginPath();\r\n\t\tc.moveTo(stuff.startX, stuff.startY);\r\n\t\tc.lineTo(stuff.endX, stuff.endY);\r\n\t\tc.stroke();\r\n\r\n\t\t// draw the text at the end without the arrow\r\n\t\tconst textAngle = Math.atan2(stuff.startY - stuff.endY, stuff.startX - stuff.endX);\r\n\t\tdraw_text(c, this.text, stuff.startX, stuff.startY, textAngle, this.selected, with_caret);\r\n\r\n\t\t// draw the head of the arrow\r\n\t\tdraw_arrow(c, stuff.endX, stuff.endY, Math.atan2(-this.deltaY, -this.deltaX));\r\n\t};\r\n\r\n\tcontains_point(pos: Point2D) {\r\n\t\tconst x = pos.x;\r\n\t\tconst y = pos.y;\r\n\t\tconst stuff = this.get_endpoints();\r\n\t\tconst dx = stuff.endX - stuff.startX;\r\n\t\tconst dy = stuff.endY - stuff.startY;\r\n\t\tconst length = Math.sqrt(dx * dx + dy * dy);\r\n\t\tconst percent = (dx * (x - stuff.startX) + dy * (y - stuff.startY)) / (length * length);\r\n\t\tconst distance = (dx * (y - stuff.startY) - dy * (x - stuff.startX)) / length;\r\n\t\treturn (percent > 0 && percent < 1 && Math.abs(distance) < HIT_TARGET_PADDING);\r\n\t};\r\n}","/** \r\n * Math utility functions.\r\n * @module\r\n */\r\n\r\n/**\r\n * Return the determinant of\r\n * a b c\r\n * d e f\r\n * g h i\r\n */\r\nfunction det(a: number, b: number, c: number, d: number, e: number, f: number, g: number, h: number, i: number) {\r\n\treturn a * e * i + b * f * g + c * d * h - a * f * h - b * d * i - c * e * g;\r\n}\r\n\r\n/**\r\n * Return a circle object given 3 coordinates.\r\n */\r\nexport function circleFromThreePoints(x1: number, y1: number, x2: number, y2: number, x3: number, y3: number) {\r\n\tconst a = det(x1, y1, 1, x2, y2, 1, x3, y3, 1);\r\n\tconst bx = -det(x1 * x1 + y1 * y1, y1, 1, x2 * x2 + y2 * y2, y2, 1, x3 * x3 + y3 * y3, y3, 1);\r\n\tconst by = det(x1 * x1 + y1 * y1, x1, 1, x2 * x2 + y2 * y2, x2, 1, x3 * x3 + y3 * y3, x3, 1);\r\n\tconst c = -det(x1 * x1 + y1 * y1, x1, y1, x2 * x2 + y2 * y2, x2, y2, x3 * x3 + y3 * y3, x3, y3);\r\n\treturn {\r\n\t\t'x': -bx / (2 * a),\r\n\t\t'y': -by / (2 * a),\r\n\t\t'radius': Math.sqrt(bx * bx + by * by - 4 * a * c) / (2 * Math.abs(a))\r\n\t};\r\n}\r\n\r\n/**\r\n * Replace excess zeroes with .'s.\r\n */\r\nexport function fixed(number: number, digits: number) {\r\n\treturn number.toFixed(digits).replace(/0+$/, '').replace(/\\.$/, '');\r\n}\r\n","import { fixed } from \"../common/math\";\nimport { measure_text } from \"../components/elements/text_utils\";\nimport { Point2D, State, StateKey } from \"../types\";\n\n// draw using this instead of a canvas and call toLaTeX() afterward\n/**\n * LaTeX rendering context.\n * @extends CanvasRenderingContext2D\n */\nexport class ExportAsLaTeX {\n\tprivate _points: Point2D[];\n\tprivate _texData: string;\n\tprivate _scale: number;\n\tpublic strokeStyle: string = \"black\";\n\tpublic fillStyle: string = \"black\";\n\tpublic lineWidth: number = 1;\n\tpublic font: string = '';\n\n\tconstructor() {\n\t\tthis._points = [];\n\t\tthis._texData = '';\n\t\tthis._scale = 0.1; // to convert pixels to document space (TikZ breaks if the numbers get too big, above 500?)\n\t}\n\n\ttoLaTeX() {\n\t\treturn '\\\\documentclass[12pt]{article}\\n' +\n\t\t\t'\\\\usepackage{tikz}\\n' +\n\t\t\t'\\n' +\n\t\t\t'\\\\begin{document}\\n' +\n\t\t\t'\\n' +\n\t\t\t'\\\\begin{center}\\n' +\n\t\t\t'\\\\begin{tikzpicture}[scale=0.2]\\n' +\n\t\t\t'\\\\tikzstyle{every node}+=[inner sep=0pt]\\n' +\n\t\t\tthis._texData +\n\t\t\t'\\\\end{tikzpicture}\\n' +\n\t\t\t'\\\\end{center}\\n' +\n\t\t\t'\\n' +\n\t\t\t'\\\\end{document}\\n';\n\t}\n\n\tbeginPath() {\n\t\tthis._points = [];\n\t}\n\n\tarc(x: number, y: number, radius: number, startAngle: number, endAngle: number, isReversed: boolean) {\n\t\tx *= this._scale;\n\t\ty *= this._scale;\n\t\tradius *= this._scale;\n\t\tif (endAngle - startAngle == Math.PI * 2) {\n\t\t\tthis._texData += '\\\\draw [' + this.strokeStyle + '] (' + fixed(x, 3) + ',' + fixed(-y, 3) + ') circle (' + fixed(radius, 3) + ');\\n';\n\t\t} else {\n\t\t\tif (isReversed) {\n\t\t\t\tconst temp = startAngle;\n\t\t\t\tstartAngle = endAngle;\n\t\t\t\tendAngle = temp;\n\t\t\t}\n\t\t\tif (endAngle < startAngle) {\n\t\t\t\tendAngle += Math.PI * 2;\n\t\t\t}\n\t\t\t// TikZ needs the angles to be in between -2pi and 2pi or it breaks\n\t\t\tif (Math.min(startAngle, endAngle) < -2 * Math.PI) {\n\t\t\t\tstartAngle += 2 * Math.PI;\n\t\t\t\tendAngle += 2 * Math.PI;\n\t\t\t} else if (Math.max(startAngle, endAngle) > 2 * Math.PI) {\n\t\t\t\tstartAngle -= 2 * Math.PI;\n\t\t\t\tendAngle -= 2 * Math.PI;\n\t\t\t}\n\t\t\tstartAngle = -startAngle;\n\t\t\tendAngle = -endAngle;\n\t\t\tthis._texData += '\\\\draw [' + this.strokeStyle + '] (' + fixed(x + radius * Math.cos(startAngle), 3) + ',' + fixed(-y + radius * Math.sin(startAngle), 3) + ') arc (' + fixed(startAngle * 180 / Math.PI, 5) + ':' + fixed(endAngle * 180 / Math.PI, 5) + ':' + fixed(radius, 3) + ');\\n';\n\t\t}\n\t}\n\n\tmoveTo(x: number, y: number) {\n\t\tx *= this._scale;\n\t\ty *= this._scale;\n\t\tthis._points.push({ 'x': x, 'y': y });\n\t}\n\n\tlineTo(x: number, y: number) {\n\t\tx *= this._scale;\n\t\ty *= this._scale;\n\t\tthis._points.push({ 'x': x, 'y': y });\n\t}\n\n\tstroke() {\n\t\tif (this._points.length == 0) return;\n\t\tthis._texData += '\\\\draw [' + this.strokeStyle + ']';\n\t\tfor (let i = 0; i < this._points.length; i++) {\n\t\t\tconst p = this._points[i];\n\t\t\tthis._texData += (i > 0 ? ' --' : '') + ' (' + fixed(p.x, 2) + ',' + fixed(-p.y, 2) + ')';\n\t\t}\n\t\tthis._texData += ';\\n';\n\t}\n\n\tfill() {\n\t\tif (this._points.length == 0) return;\n\t\tthis._texData += '\\\\fill [' + this.strokeStyle + ']';\n\t\tfor (let i = 0; i < this._points.length; i++) {\n\t\t\tconst p = this._points[i];\n\t\t\tthis._texData += (i > 0 ? ' --' : '') + ' (' + fixed(p.x, 2) + ',' + fixed(-p.y, 2) + ')';\n\t\t}\n\t\tthis._texData += ';\\n';\n\t}\n\n\tadvancedFillText(text: string, originalText: string, x: number, y: number, angleOrNull: number | undefined) {\n\t\tif (text.replace(' ', '').length > 0) {\n\t\t\tlet nodeParams = '';\n\t\t\t// x and y start off as the center of the text, but will be moved to one side of the box when angleOrNull != null\n\t\t\tif (angleOrNull != null) {\n\t\t\t\tconst width = measure_text(text);\n\t\t\t\tconst dx = Math.cos(angleOrNull);\n\t\t\t\tconst dy = Math.sin(angleOrNull);\n\t\t\t\tif (Math.abs(dx) > Math.abs(dy)) {\n\t\t\t\t\tif (dx > 0) nodeParams = '[right] ', x -= width / 2;\n\t\t\t\t\telse nodeParams = '[left] ', x += width / 2;\n\t\t\t\t} else {\n\t\t\t\t\tif (dy > 0) nodeParams = '[below] ', y -= 10;\n\t\t\t\t\telse nodeParams = '[above] ', y += 10;\n\t\t\t\t}\n\t\t\t}\n\t\t\tx *= this._scale;\n\t\t\ty *= this._scale;\n\t\t\tthis._texData += '\\\\draw (' + fixed(x, 2) + ',' + fixed(-y, 2) + ') node ' + nodeParams + '{$' + originalText.replace(/ /g, '\\\\mbox{ }') + '$};\\n';\n\t\t}\n\t}\n\n\ttranslate() { }\n\tsave() { }\n\trestore() { }\n\tclearRect() { }\n\trect() { }\n}\n\nexport function export_to_latex(state: State): StateKey[] | undefined {\n\tconst exporter = new ExportAsLaTeX();\n\n\tif (state.selected_object != null) {\n\t\tstate.selected_object.selected = false;\n\t\tstate.selected_object = undefined;\n\t}\n\n\tstate.canvas.draw_using(exporter);\n\n\tnavigator.clipboard.writeText(exporter.toLaTeX());\n\n\treturn ['selected_object'];\n}","/**\n * Subset construction for converting NFAs to DFAs.\n */\n\nimport { AnyLink } from \"../components/elements/abstract\";\nimport { StateNode } from \"../components/elements/state_node\";\nimport { State, StateKey } from \"../types\";\nimport { EPSILON } from \"./constants\";\nimport { FAData } from \"./data\";\nimport { inplace_union } from \"./shared_utils\";\n\n\n/**\n * Preform subset construction on the current \n */\nexport function subset_construct(state: State): StateKey[] | undefined {\n    const fa = new FAData();\n    const nodes = state.nodes;\n    const links = state.links;\n\n    fa.load(nodes, links);\n\n    if (fa.is_deterministic()) {\n        console.warn('Tried to perform subset construction on a DFA.');\n        return;\n    } else if (fa.starting_state == -1) {\n        console.warn('FA has no starting state so subset construction failed.');\n        return;\n    }\n\n    const dfa = _subset_alg(fa);\n    const { nodes: new_nodes, links: new_links } = dfa.create_elements();\n\n    replace_elements(nodes, links, new_nodes, new_links);\n\n    state.selected_object = undefined;\n\n    return ['nodes', 'links'];\n}\n\n/**\n * Return a new DFA equivalent to the given FA.\n */\nfunction _subset_alg(fa: FAData) {\n    const dfa = new FAData();\n\n    /** Map of all state strings, ex; '0,2,4' which have\n     * already been explored to index of state in the new DFA. */\n    const name_to_index = new Map<string, number>();\n    /** List of names of all state transitions corresponding\n     * to dfa.state_names. */\n    const names: string[] = [];\n    const state_stack: number[][] = [];\n\n    let curr = 0;\n\n    dfa.starting_state = 0;\n\n    // Initialize the FA and search with the FA's start/equivalent states.\n    // The steps are:\n    // 1. Create the set.\n    // 2. Get it's identifying symbol and assign it an index.\n    // 3. Give it a name and add it to the names array.\n    // 4. Push the state-set to the stack to be explored.\n    // 5. Check if the state should be accepting.\n\n    const dfa_start_set = fa.get_equivalents(fa.starting_state);\n    name_to_index.set(_set_to_string(dfa_start_set), curr);\n    const start_state_names = Array.from(dfa_start_set).map(i => fa.state_names[i]);\n    start_state_names.sort();\n    names.push(`{${start_state_names.join(',')}}`);\n    state_stack.push(dfa_start_set);\n\n    if (Array.from(dfa_start_set).some(i => fa.accepting_states.includes(i)))\n        dfa.accepting_states.push(curr);\n    curr++;\n\n    // Iterate over the state stack.\n    let origin = state_stack.pop();\n    while (origin != null) {\n        const from_name = _set_to_string(origin);\n\n        /** The new transitions from the popped state-set. */\n        const transitions = new Map<string, number[]>();\n\n        // Populate transitions.\n        for (const state of origin) {\n            const from_state_transitions = fa.transitions.get(state);\n            if (from_state_transitions != null) {\n                // Iterate over all possible transitions from the state.\n                for (const transition of from_state_transitions.keys()) {\n                    // Excluding epislon transitions.\n                    if (transition != EPSILON) {\n                        let result = transitions.get(transition);\n                        if (result == null) {\n                            result = [];\n                            transitions.set(transition, result);\n                        }\n                        inplace_union(result, fa.deep_delta(state, transition));\n                    }\n                }\n            }\n        }\n\n        // Add transitions map to dfa.\n        for (const [transition, output] of transitions.entries()) {\n            const to_name = _set_to_string(output);\n            const from = name_to_index.get(from_name)!;\n\n            if (name_to_index.has(to_name)) {\n                // Case 1, the state has already been defined.\n                // Add it to the dfa and move on.\n                dfa.add_transition(from, transition, name_to_index.get(to_name)!);\n            } else {\n                // Case 2, the state has not been defined.\n                const to_name = _set_to_string(output);\n\n                // Initialize the new state.\n                name_to_index.set(to_name, curr);\n                const state_names = Array.from(output).map(i => fa.state_names[i]);\n                state_names.sort();\n                names.push(`{${state_names.join(',')}}`);\n                state_stack.push(output);\n\n                // The state is accepting if any constituents are accepting.\n                if (Array.from(output).some(i => fa.accepting_states.includes(i)))\n                    dfa.accepting_states.push(curr);\n\n                // Add the transition. curr is the index of the newly created state.\n                dfa.add_transition(from, transition, curr);\n\n                curr++;\n            }\n\n        }\n\n        origin = state_stack.pop();\n    }\n\n    dfa.state_names = names;\n\n    return dfa;\n}\n\n/**\n * Convert a set to its string representation.\n */\nfunction _set_to_string(set: number[]) {\n    const arr = set.slice();\n    arr.sort();\n    return arr.join(',');\n}\n\n/**\n * Move new nodes and new links into node and links array.\n */\nfunction replace_elements(nodes: StateNode[], links: AnyLink[], new_nodes: StateNode[], new_links: AnyLink[]) {\n    nodes.splice(0, nodes.length);\n    links.splice(0, links.length);\n\n    for (let i = 0; i < new_nodes.length; i++)\n        nodes.push(new_nodes[i]);\n    for (let i = 0; i < new_links.length; i++)\n        links.push(new_links[i]);\n\n}","/**\n * Data objects parsed from the canvas elements.\n */\n\nimport { FSMCanvasState, Point2D } from \"../types\";\nimport { AnyLink, FSMElementString, FSMLink, FSMStringableElement } from \"../components/elements/abstract\";\nimport { NodeLink } from \"../components/elements/node_link\";\nimport { SelfLink } from \"../components/elements/self_link\";\nimport { StartLink } from \"../components/elements/start_link\";\nimport { StateNode } from \"../components/elements/state_node\";\nimport { EPSILON } from \"./constants\";\nimport { inplace_union, rand_pos, to_symbol, union } from \"./shared_utils\";\nimport { force_update } from \"../store/store\";\n\n/**\n * Utility data for FAs. Can be used to test strings,\n * and evaluate the delta function.\n */\nexport class FAData {\n    /** Names of all of the states. */\n    state_names: string[];\n    /** Transitions from the ith state via a string to a list of states. */\n    transitions: Map<number, Map<string, number[]>>;\n    /** Index of starting state. */\n    starting_state: number;\n    /** Index of accepting states. */\n    accepting_states: number[];\n\n    /**\n     * Create an empty FAData.\n     */\n    constructor() {\n        this.state_names = [];\n        this.transitions = new Map();\n        this.starting_state = -1;\n        this.accepting_states = [];\n    }\n    /**\n     * Load states and links from elements into this FAData.\n     * Automatically generate state transitions.\n     */\n    load(nodes: StateNode[], links: AnyLink[]) {\n        // Reset\n        this.state_names = [];\n        this.transitions = new Map();\n        this.starting_state = -1;\n        this.accepting_states = [];\n\n        const node_to_index = new Map<FSMElementString, number>();\n\n        // Get nodes.\n        let curr = 0;\n        for (let i = 0; i < nodes.length; i++) {\n            const node = nodes[i];\n\n            node_to_index.set(to_symbol(node), curr);\n            this.state_names.push(node.text);\n\n            if (node.isAcceptState)\n                this.accepting_states.push(curr);\n\n            curr++;\n        }\n\n        // Get links.\n        for (let i = 0; i < links.length; i++) {\n            const link = links[i];\n\n            if (link instanceof NodeLink) {\n                const start = node_to_index.get(to_symbol(link.nodeA));\n                const end = node_to_index.get(to_symbol(link.nodeB));\n                const options = link.text.split(',').map(s => s.trim());\n\n                if (start != null && end != null) {\n                    // Initialize transition map.\n                    let map = this.transitions.get(start);\n                    if (map == null) {\n                        map = new Map<string, number[]>();\n                        this.transitions.set(start, map);\n                    }\n\n                    // Append options.\n                    for (const option of options) {\n                        let opt = map.get(option);\n                        if (opt == null) {\n                            opt = [];\n                            map.set(option, opt);\n                        }\n\n                        opt.push(end);\n                    }\n                }\n            }\n            else if (link instanceof SelfLink) {\n                const start = node_to_index.get(to_symbol(link.node));\n                const end = start;\n                const options = link.text.split(',').map(s => s.trim());\n\n                if (start != null && end != null) {\n                    // Initialize transition map.\n                    let map = this.transitions.get(start);\n                    if (map == null) {\n                        map = new Map<string, number[]>();\n                        this.transitions.set(start, map);\n                    }\n\n                    // Append options.\n                    for (const option of options) {\n                        let opt = map.get(option);\n                        if (opt == null) {\n                            opt = [];\n                            map.set(option, opt);\n                        }\n\n                        opt.push(end);\n                    }\n                }\n            }\n            else if (link instanceof StartLink) {\n                const index = node_to_index.get(to_symbol(link.node));\n                if (index != null) this.starting_state = index;\n            }\n        }\n    }\n\n    /**\n     * Create StateNodes and Links from this FAData.\n     * All elements are created at a random position\n     * in the canvas.\n     */\n    create_elements(): FSMCanvasState {\n        const new_nodes: StateNode[] = [];\n        const new_links: FSMLink[] = [];\n\n        const index_to_node = new Map<number, StateNode>();\n\n        for (let i = 0; i < this.state_names.length; i++) {\n            const pos = rand_pos();\n            const node = new StateNode(pos.x, pos.y);\n            node.text = this.state_names[i];\n            index_to_node.set(i, node);\n\n            if (this.accepting_states.includes(i))\n                node.isAcceptState = true;\n\n            new_nodes.push(node);\n        }\n\n        for (const [start, transitions] of this.transitions.entries()) {\n            const start_node = index_to_node.get(start);\n\n            if (start_node != null) {\n                for (const [transition, ends] of transitions.entries()) {\n                    for (const end of ends) {\n                        const end_node = index_to_node.get(end);\n                        if (end_node != null) {\n                            let link;\n                            if (start == end) {\n                                link = new SelfLink(start_node);\n\n                            } else {\n                                link = new NodeLink(start_node, end_node);\n                                link.perpendicularPart += 100 * Math.random();\n                            }\n\n                            link.text = transition;\n                            new_links.push(link);\n                        }\n                    }\n                }\n            }\n        }\n\n        if (this.starting_state != -1) {\n            const start = index_to_node.get(this.starting_state);\n            if (start != null) {\n                const link = new StartLink(start);\n                const pos = rand_pos();\n                link.set_anchor_point(pos.x, pos.y);\n                link.text = 'start';\n                new_links.push(link);\n            }\n        }\n\n        return {\n            nodes: new_nodes,\n            links: new_links\n        }\n    }\n\n    /**\n     * Add a new transition from an index to another via a transition.\n     */\n    add_transitions(from: number, transition: string, to: number[]) {\n        let map = this.transitions.get(from);\n        if (map == null) {\n            map = new Map<string, number[]>();\n            this.transitions.set(from, map);\n        }\n\n        let opt = map.get(transition);\n        if (opt == null) {\n            opt = [];\n            map.set(transition, opt);\n        }\n\n        inplace_union(opt, to);\n    }\n\n    /**\n     * Add one new transition from an index to another via a transition.\n     */\n    add_transition(from: number, transition: string, to: number) {\n        let map = this.transitions.get(from);\n        if (map == null) {\n            map = new Map<string, number[]>();\n            this.transitions.set(from, map);\n        }\n\n        let opt = map.get(transition);\n        if (opt == null) {\n            opt = [];\n            map.set(transition, opt);\n        }\n\n        if (!opt.includes(to)) opt.push(to);\n    }\n\n    /**\n     * Delta transition for this FA.\n     * \n     * *transition must not be epsilon\n     */\n    deep_delta(state: number, transition: string): number[] {\n        const shallow_dests: number[] = [];\n\n        // Explore each equivalent starting state, and add the destinations.\n        for (const from of this.get_equivalents(state)) {\n            inplace_union(shallow_dests, this.shallow_delta(from, transition));\n        }\n\n        // Return each equivalent destination state.\n        return this.get_equivalents(shallow_dests).slice();\n    }\n\n    /**\n     * Shallow delta function for this FA, ignoring epsilon transitions.\n     */\n    shallow_delta(state: number, transition: string): number[] {\n        let map = this.transitions.get(state);\n        if (map != null) {\n            let opt = map.get(transition);\n            if (opt != null) {\n                return opt.slice();\n            }\n        }\n\n        return [];\n    }\n\n    /**\n     * Return the set of all equivalent states in this fa.\n     * Equivalent states are states reachable via epsilon transitions.\n     * @param {number|number>} state\n     */\n    get_equivalents(state: number | number[]): number[] {\n        // Make a set of the initial states from which to begin the search.\n        if (!Array.isArray(state))\n            state = [state];\n        else\n            state = state.slice();\n\n        const stack = state.slice();\n\n        let top = stack.pop();\n\n        while (top != null) {\n            let destinations = this.shallow_delta(top, EPSILON);\n\n            for (const dest of destinations.values())\n                // The state has not yet been explored, so add it to the stack and the set.\n                if (!state.includes(dest)) { stack.push(dest); state.push(dest); }\n\n            top = stack.pop();\n        }\n\n        return state;\n    }\n\n    /**\n     * Return true if the FA is deterministic.\n     */\n    is_deterministic() {\n        // Check that all transitions are non epsilon, and all transitions are\n        // deterministic (return size of 1 state).\n        for (const trans_map of this.transitions.values()) {\n            for (const [transition, result] of trans_map.entries()) {\n                if (transition == EPSILON || result.length > 1)\n                    return false;\n            }\n        }\n\n        return true;\n    }\n}\n\n/**\n * Utility data for a graph where StateNodes are vertices,\n * links' anchor points are vertices, and edges connect\n * vertices and links as needed.\n * \n * The graph is undirected.\n * \n * Each vertex has a {x, y} position object.\n */\nexport class FSAGraph {\n    private node_to_vert: Map<FSMElementString, number>;\n    private vert_to_node: Map<number, FSMStringableElement>;\n    private vertices: Point2D[];\n    private edges: [number, number][];\n\n    /**\n     * Create an empty FSAGraph.\n     * Modifying the vertices and edges does not modify\n     * the canvas until sync_positions is called.\n     */\n    constructor() {\n        /** Map from canvas element to vertex index. */\n        this.node_to_vert = new Map();\n        /** Map from vertex index to canvas element. */\n        this.vert_to_node = new Map();\n        /** List of vertex position objects. */\n        this.vertices = [];\n        /** List of edge tuples [a, b]. a,b are vertex indices\n         * with a < b always. */\n        this.edges = [];\n    }\n\n    /**\n     * Load states and links from elements into this FSAGraph.\n     */\n    load(nodes: StateNode[], links: AnyLink[]) {\n        this.node_to_vert = new Map();\n        this.vert_to_node = new Map();\n        this.vertices = [];\n        this.edges = [];\n\n        let curr = 0;\n\n        // Append nodes.\n        for (let i = 0; i < nodes.length; i++) {\n            const node = nodes[i];\n            this.vertices[curr] = { x: node.x, y: node.y };\n            this.node_to_vert.set(to_symbol(node), curr);\n            this.vert_to_node.set(curr, node);\n            curr++;\n        }\n\n        // Append links.\n        for (let i = 0; i < links.length; i++) {\n            const link = links[i];\n            if (link instanceof NodeLink) {\n                const pos = link.get_anchor_point();\n                this.vertices[curr] = { x: pos.x, y: pos.y };\n                this.node_to_vert.set(to_symbol(link), curr);\n                this.vert_to_node.set(curr, link);\n\n                // Add linking edges.\n                this.edges.push([this.node_to_vert.get(to_symbol(link.nodeA))!, curr]);\n                this.edges.push([this.node_to_vert.get(to_symbol(link.nodeB))!, curr]);\n\n\n                curr++;\n            } else if (link instanceof StartLink) {\n                const pos = link.get_start_point();\n                this.vertices[curr] = { x: pos.x, y: pos.y };\n                this.node_to_vert.set(to_symbol(link), curr);\n                this.vert_to_node.set(curr, link);\n\n                // Only 1 linking edge to StartLinks.\n                this.edges.push([this.node_to_vert.get(to_symbol(link.node))!, curr]);\n\n                curr++;\n            }\n\n        }\n    }\n\n    /**\n     * Update all of the nodes and links referenced by the graph to\n     * match its vertices' positions.\n     */\n    sync_positions() {\n        // Update StateNodes.\n        for (let i = 0; i < this.vertices.length; i++) {\n            /** @type {{x: number, y:number}} */\n            const v: Point2D = this.vertices[i];\n            const node = this.vert_to_node.get(i);\n\n            if (node instanceof StateNode) {\n                node.set_mouse_start(node.x, node.y);\n                node.set_anchor_point(v.x, v.y);\n            } else if (node instanceof Node || node instanceof StartLink) {\n                node.set_anchor_point(v.x, v.y);\n            }\n        }\n\n        force_update(['nodes', 'links']);\n    }\n}","/**\n * General purpose utilities for managing node data.\n */\n\nimport { FSMElementString, FSMStringableElement } from \"../components/elements/abstract\";\nimport { StateNode } from \"../components/elements/state_node\";\nimport { NodeLink } from \"../components/elements/node_link\";\nimport { StartLink } from \"../components/elements/start_link\";\nimport { get_canvas } from \"../store/store\";\nimport { Point2D } from \"../types\";\nimport { CANVAS_PADDING } from \"../components/elements/constants\";\n\n/**\n * Return the union of A and B.\n */\nexport function union<T>(a: T[], b: T[]) {\n    const set: T[] = [];\n\n    inplace_union(set, a);\n    inplace_union(set, b);\n\n    return set;\n}\n\n/**\n * Add B's elements to A, as a set.\n * Mutates A.\n */\nexport function inplace_union<T>(a: T[], b: T[]) {\n    for (const el of b)\n        if (!a.includes(el)) a.push(el);\n}\n\n/**\n * Return a unique string for each node or link.\n */\nexport function to_symbol(node: FSMStringableElement): FSMElementString {\n    if (node instanceof StateNode)\n        return `${node.text}:${node.x},${node.y}`;\n    else if (node instanceof NodeLink)\n        return `${to_symbol(node.nodeA)}->${to_symbol(node.nodeB)}:${node.text}${node.get_anchor_point().x},${node.get_anchor_point().y}`;\n    else if (node instanceof StartLink)\n        return `${to_symbol(node.node)}:${node.get_start_point().x},${node.get_start_point().y}`;\n    return JSON.stringify(node);\n}\n\n/**\n * Get a random position object.\n */\nexport function rand_pos(): Point2D {\n    const canvas = get_canvas();\n    if (canvas != null) {\n        const canvas_el = canvas.el;\n        if (canvas_el != null) {\n            return {\n                x: Math.random() * (canvas_el.width - 2 * CANVAS_PADDING) + CANVAS_PADDING,\n                y: Math.random() * (canvas_el.height - 2 * CANVAS_PADDING) + CANVAS_PADDING\n            }\n        }\n    }\n    return { x: 0, y: 0 };\n}","import { FSMContext, Point2D } from \"../../types\";\r\nimport { DrawableElement } from \"./abstract\";\r\nimport { NODE_RADIUS } from \"./constants\";\r\nimport { draw_text } from \"./text_utils\";\r\n\r\n/** A circular node representing a state in the finite automaton. */\r\nexport class StateNode extends DrawableElement {\r\n\tpublic x: number;\r\n\tpublic y: number;\r\n\tprivate mouseOffsetX: number;\r\n\tprivate mouseOffsetY: number;\r\n\tpublic isAcceptState: boolean;\r\n\tpublic text: string;\r\n\r\n\tconstructor(x: number, y: number) {\r\n\t\tsuper();\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\t\tthis.mouseOffsetX = 0;\r\n\t\tthis.mouseOffsetY = 0;\r\n\t\tthis.isAcceptState = false;\r\n\t\tthis.text = '';\r\n\t}\r\n\r\n\tset_mouse_start(x: number, y: number) {\r\n\t\tthis.mouseOffsetX = this.x - x;\r\n\t\tthis.mouseOffsetY = this.y - y;\r\n\t};\r\n\r\n\tset_anchor_point(x: number, y: number) {\r\n\t\tthis.x = x + this.mouseOffsetX;\r\n\t\tthis.y = y + this.mouseOffsetY;\r\n\t};\r\n\r\n\tdraw(c: FSMContext, with_caret: boolean = false) {\r\n\t\t// draw the circle\r\n\t\tc.beginPath();\r\n\t\tc.arc(this.x, this.y, NODE_RADIUS, 0, 2 * Math.PI, false);\r\n\t\tc.stroke();\r\n\r\n\t\t// draw the text\r\n\t\tdraw_text(c, this.text, this.x, this.y, null, this.selected, with_caret);\r\n\r\n\t\t// draw a double circle for an accept state\r\n\t\tif (this.isAcceptState) {\r\n\t\t\tc.beginPath();\r\n\t\t\tc.arc(this.x, this.y, NODE_RADIUS - 6, 0, 2 * Math.PI, false);\r\n\t\t\tc.stroke();\r\n\t\t}\r\n\t};\r\n\r\n\tclosest_point_on_circle(x: number, y: number): Point2D {\r\n\t\tconst dx = x - this.x;\r\n\t\tconst dy = y - this.y;\r\n\t\tconst scale = Math.sqrt(dx * dx + dy * dy);\r\n\t\treturn {\r\n\t\t\t'x': this.x + dx * NODE_RADIUS / scale,\r\n\t\t\t'y': this.y + dy * NODE_RADIUS / scale,\r\n\t\t};\r\n\t};\r\n\r\n\tcontains_point(pos: Point2D) {\r\n\t\treturn (pos.x - this.x) * (pos.x - this.x) + (pos.y - this.y) * (pos.y - this.y) < NODE_RADIUS * NODE_RADIUS;\r\n\t};\r\n}","import { save_canvas } from \"../store/files\";\nimport { State, StateKey } from \"../types\";\n\nexport function export_to_png(state: State): StateKey[] | undefined {\n\tif (state.selected_object != null) {\n\t\tstate.selected_object.selected = false;\n\t\tstate.selected_object = undefined;\n\t}\n\n    const temp = document.createElement('canvas');\n    temp.width = 800;\n    temp.height = 600;\n\n\tstate.canvas.draw_using(temp.getContext('2d')!);\n\n\tsave_canvas(\n        temp,\n        `${state.file_name}.png`\n    );\n\n\treturn ['selected_object'];\n}","// draw using this instead of a canvas and call toSVG() afterward\n\nimport { fixed } from \"../common/math\";\nimport { text_to_xml } from \"../components/elements/text_utils\";\nimport { save_file } from \"../store/files\";\nimport { Point2D, State, StateKey } from \"../types\";\n\n/**\n * SVG rendering context.\n * @extends CanvasRenderingContext2D\n */\nexport class ExportAsSVG {\n\tpublic fillStyle: string;\n\tpublic strokeStyle: string;\n\tpublic lineWidth: number;\n\tpublic font: string;\n\tprivate _points: Point2D[];\n\tprivate _svgData: string;\n\tprivate _transX: number;\n\tprivate _transY: number;\n\n\tconstructor() {\n\t\tthis.fillStyle = 'black';\n\t\tthis.strokeStyle = 'black';\n\t\tthis.lineWidth = 1;\n\t\tthis.font = '12px Arial, sans-serif';\n\t\tthis._points = [];\n\t\tthis._svgData = '';\n\t\tthis._transX = 0;\n\t\tthis._transY = 0;\n\t}\n\n\ttoSVG() {\n\t\treturn '<?xml version=\"1.0\" standalone=\"no\"?>\\n<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\\n\\n<svg width=\"800\" height=\"600\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\">\\n' + this._svgData + '</svg>\\n';\n\t}\n\n\tbeginPath() {\n\t\tthis._points = [];\n\t}\n\n\tarc(x: number, y: number, radius: number, startAngle: number, endAngle: number, isReversed: boolean) {\n\t\tx += this._transX;\n\t\ty += this._transY;\n\t\tconst style = 'stroke=\"' + this.strokeStyle + '\" stroke-width=\"' + this.lineWidth + '\" fill=\"none\"';\n\n\t\tif (endAngle - startAngle == Math.PI * 2) {\n\t\t\tthis._svgData += '\\t<ellipse ' + style + ' cx=\"' + fixed(x, 3) + '\" cy=\"' + fixed(y, 3) + '\" rx=\"' + fixed(radius, 3) + '\" ry=\"' + fixed(radius, 3) + '\"/>\\n';\n\t\t} else {\n\t\t\tif (isReversed) {\n\t\t\t\tconst temp = startAngle;\n\t\t\t\tstartAngle = endAngle;\n\t\t\t\tendAngle = temp;\n\t\t\t}\n\n\t\t\tif (endAngle < startAngle) {\n\t\t\t\tendAngle += Math.PI * 2;\n\t\t\t}\n\n\t\t\tconst startX = x + radius * Math.cos(startAngle);\n\t\t\tconst startY = y + radius * Math.sin(startAngle);\n\t\t\tconst endX = x + radius * Math.cos(endAngle);\n\t\t\tconst endY = y + radius * Math.sin(endAngle);\n\t\t\tconst useGreaterThan180 = (Math.abs(endAngle - startAngle) > Math.PI);\n\t\t\tconst goInPositiveDirection = 1;\n\n\t\t\tthis._svgData += '\\t<path ' + style + ' d=\"';\n\t\t\tthis._svgData += 'M ' + fixed(startX, 3) + ',' + fixed(startY, 3) + ' '; // startPoint(startX, startY)\n\t\t\tthis._svgData += 'A ' + fixed(radius, 3) + ',' + fixed(radius, 3) + ' '; // radii(radius, radius)\n\t\t\tthis._svgData += '0 '; // value of 0 means perfect circle, others mean ellipse\n\t\t\tthis._svgData += +useGreaterThan180 + ' ';\n\t\t\tthis._svgData += +goInPositiveDirection + ' ';\n\t\t\tthis._svgData += fixed(endX, 3) + ',' + fixed(endY, 3); // endPoint(endX, endY)\n\t\t\tthis._svgData += '\"/>\\n';\n\t\t}\n\t}\n\n\tmoveTo(x: number, y: number) {\n\t\tx += this._transX;\n\t\ty += this._transY;\n\t\tthis._points.push({ 'x': x, 'y': y });\n\t}\n\n\tlineTo(x: number, y: number) {\n\t\tx += this._transX;\n\t\ty += this._transY;\n\t\tthis._points.push({ 'x': x, 'y': y });\n\t}\n\n\tstroke() {\n\t\tif (this._points.length == 0) return;\n\t\tthis._svgData += '\\t<polygon stroke=\"' + this.strokeStyle + '\" stroke-width=\"' + this.lineWidth + '\" points=\"';\n\t\tfor (let i = 0; i < this._points.length; i++) {\n\t\t\tthis._svgData += (i > 0 ? ' ' : '') + fixed(this._points[i].x, 3) + ',' + fixed(this._points[i].y, 3);\n\t\t}\n\t\tthis._svgData += '\"/>\\n';\n\t}\n\n\tfill() {\n\t\tif (this._points.length == 0) return;\n\t\tthis._svgData += '\\t<polygon fill=\"' + this.fillStyle + '\" stroke-width=\"' + this.lineWidth + '\" points=\"';\n\t\tfor (let i = 0; i < this._points.length; i++) {\n\t\t\tthis._svgData += (i > 0 ? ' ' : '') + fixed(this._points[i].x, 3) + ',' + fixed(this._points[i].y, 3);\n\t\t}\n\t\tthis._svgData += '\"/>\\n';\n\t}\n\n\tfillText(text: string, x: number, y: number) {\n\t\tx += this._transX;\n\t\ty += this._transY;\n\t\tif (text.replace(' ', '').length > 0) {\n\t\t\tthis._svgData += '\\t<text x=\"' + fixed(x, 3) + '\" y=\"' + fixed(y, 3) + '\" font-family=\"Times New Roman\" font-size=\"20\">' + text_to_xml(text) + '</text>\\n';\n\t\t}\n\t}\n\n\ttranslate(x: number, y: number) {\n\t\tthis._transX = x;\n\t\tthis._transY = y;\n\t}\n\n\tsave() { }\n\trestore() { }\n\tclearRect() { }\n\trect() { }\n\n}\n\nexport function export_to_svg(state: State): StateKey[] | undefined {\n\tconst exporter = new ExportAsSVG();\n\n\tif (state.selected_object != null) {\n\t\tstate.selected_object.selected = false;\n\t\tstate.selected_object = undefined;\n\t}\n\n\tstate.canvas.draw_using(exporter);\n\n\tsave_file(\n\t\texporter.toSVG(),\n\t\t`${state.file_name}.svg`,\n\t\t'image/svg+xml'\n\t);\n\n\treturn ['selected_object'];\n}","import { Component, ComponentChild, Fragment, h } from \"preact\";\nimport { get_state, mutate, subscribe } from \"../../store/store\";\nimport { CanvasTool, State, StateKey } from \"../../types\";\n\n// Consider removing this parent reference and relying strictly on vDOM.\ntype ToolProps = {\n    tooltip: string,\n    icon: string,\n    tool_mode: CanvasTool,\n};\n\nexport class ToolBar extends Component {\n    constructor() {\n        super();\n        subscribe(['curr_tool'], this);\n    }\n\n    render(): ComponentChild {\n        return (<>\n            <div>Tools:</div>\n            <div style='display: flex; flex-direction: row;'>\n                <Tool tooltip='Select' icon='' tool_mode={CanvasTool.POINTER} />\n                <Tool tooltip='Draw Node' icon='' tool_mode={CanvasTool.DRAW_NODE} />\n                <Tool tooltip='Draw Link' icon='' tool_mode={CanvasTool.DRAW_LINK} />\n                <Tool tooltip='Draw Accept' icon='' tool_mode={CanvasTool.DRAW_ACCEPT} />\n                <Tool tooltip='Eliminate' icon='' tool_mode={CanvasTool.ELIMINATE} />\n                {/* <Tool tooltip='Pan (not yet implemented)' icon={''} tool_mode={CanvasTool.PAN} /> */}\n            </div>\n        </>);\n    }\n}\n\nclass Tool extends Component<ToolProps> {\n\n\n    constructor(props: ToolProps) {\n        super(props);\n    }\n\n    render(): ComponentChild {\n        return (\n            <div\n                onClick={e => mutate(this.mutator)}\n\n                style={\n                    this.props.tool_mode == get_state('curr_tool') ? 'color: cyan' : 'color: black'\n                }\n            >{this.props.tooltip}</div>\n        );\n    }\n\n    mutator = (state: State): StateKey[] | undefined => {\n        if (state.curr_tool == this.props.tool_mode) return;\n        state.curr_tool = this.props.tool_mode;\n        return ['curr_tool'];\n    }\n}","/* global __webpack_public_path__ */\n\nimport * as Preact from 'preact';\nconst { h, render, hydrate } = Preact;\n\nconst interopDefault = m => (m && m.default ? m.default : m);\n\nconst normalizeURL = url => (url[url.length - 1] === '/' ? url : url + '/');\n\nif (process.env.NODE_ENV === 'development') {\n\t// enable preact devtools\n\trequire('preact/debug');\n\n\t// only add a debug sw if webpack service worker is not requested.\n\tif (process.env.ADD_SW === undefined && 'serviceWorker' in navigator) {\n\t\t// eslint-disable-next-line no-undef\n\t\tnavigator.serviceWorker.register(__webpack_public_path__ + 'sw-debug.js');\n\t} else if (process.env.ADD_SW && 'serviceWorker' in navigator) {\n\t\t// eslint-disable-next-line no-undef\n\t\tnavigator.serviceWorker.register(\n\t\t\t__webpack_public_path__ + (process.env.ES_BUILD ? 'sw-esm.js' : 'sw.js')\n\t\t);\n\t}\n} else if (process.env.ADD_SW && 'serviceWorker' in navigator) {\n\t// eslint-disable-next-line no-undef\n\tnavigator.serviceWorker.register(\n\t\t__webpack_public_path__ + (process.env.ES_BUILD ? 'sw-esm.js' : 'sw.js')\n\t);\n}\n\nlet app = interopDefault(require('preact-cli-entrypoint'));\n\nif (typeof app === 'function') {\n\tlet root =\n\t\tdocument.getElementById('preact_root') || document.body.firstElementChild;\n\n\tlet init = () => {\n\t\tlet app = interopDefault(require('preact-cli-entrypoint'));\n\t\tlet preRenderData = {};\n\t\tconst inlineDataElement = document.querySelector(\n\t\t\t'[type=\"__PREACT_CLI_DATA__\"]'\n\t\t);\n\t\tif (inlineDataElement) {\n\t\t\tpreRenderData =\n\t\t\t\tJSON.parse(decodeURI(inlineDataElement.innerHTML)).preRenderData ||\n\t\t\t\tpreRenderData;\n\t\t}\n\t\t/* An object named CLI_DATA is passed as a prop,\n\t\t * this keeps us future proof if in case we decide,\n\t\t * to send other data like at some point in time.\n\t\t */\n\t\tconst CLI_DATA = { preRenderData };\n\t\tconst currentURL = preRenderData.url ? normalizeURL(preRenderData.url) : '';\n\t\tconst canHydrate =\n\t\t\tprocess.env.PRERENDER &&\n\t\t\tprocess.env.NODE_ENV === 'production' &&\n\t\t\thydrate &&\n\t\t\tcurrentURL === normalizeURL(location.pathname);\n\t\tconst doRender = canHydrate ? hydrate : render;\n\t\troot = doRender(h(app, { CLI_DATA }), document.body, root);\n\t};\n\n\tif (module.hot) module.hot.accept('preact-cli-entrypoint', init);\n\n\tinit();\n}\n","/**\n * Various constants for parsing regular expressions.\n */\n\n/** Internal operators. */\nexport const OPS = {\n    CONCAT: \"*&*\",\n    KLEIN: \"*\",\n    OR: \"+\",\n    OPEN_LEFT: \"(\",\n    CLOSE_RIGHT: \")\",\n}\n\n/** Operators which already follow infix notation. */\nexport const INFIX_CHAR_OPS = [OPS.OR, OPS.OPEN_LEFT, OPS.CLOSE_RIGHT];\n/** Standard operators which can be recognized in user inputted strings. */\nexport const STANDARD_CHAR_OPS = [OPS.KLEIN, OPS.OR, OPS.OPEN_LEFT, OPS.CLOSE_RIGHT];\n/** Binary operators. */\nexport const BIN_OPS = [OPS.CONCAT, OPS.OR];\n/** Operators which should be recognized as function. */\nexport const FUNCTIONS_OPS = [OPS.KLEIN];\n/** Operators which should not be concatenated from the left side. */\nexport const L_NON_CONCAT_OPS = [OPS.OPEN_LEFT, OPS.OR, OPS.CONCAT, OPS.KLEIN];\n/** Operators which should not be concatenated from the right side. */\nexport const R_NON_CONCAT_OPS = [OPS.CLOSE_RIGHT, OPS.OR, OPS.CONCAT];\n\n/** Operator precedence lookup. Higher precedence is a higher number.\n * \n * \\* > concatenation > +\n */\nexport const OP_PRECEDENCE = {\n    [OPS.KLEIN]: 8,\n    [OPS.CONCAT]: 4,\n    [OPS.OR]: 2,\n}\n\n/** Epsilon empty string character. */\nexport const EPSILON = '\\\\epsilon';","import { union } from \"../algs/shared_utils\";\nimport { State, StateKey } from \"../types\"\nimport { canvas_to_string, string_to_canvas } from \"./backup\";\nimport { force_update } from \"./store\";\nimport { reset_undo_redo } from \"./undo_redo\";\n\nexport function save_as(state: State): StateKey[] | undefined {\n    save_file(\n        canvas_to_string(state),\n        `${state.file_name || new Date().toISOString().replace(/[^0-9|-]/g, '')}.fsmjson`,\n        'application/json',\n    );\n\n    return;\n}\n\n/** Save the file using the given data string. */\nexport function save_canvas(canvas: HTMLCanvasElement, file_name: string) {\n    // Use anchors instead of injecting anchor into UI.\n    const anchor = document.createElement('a');\n    anchor.href = canvas.toDataURL();\n    anchor.download = file_name;\n    anchor.click();\n\n    URL.revokeObjectURL(anchor.href);\n};\n\n/** Save the file using the given data string. */\nexport function save_file(data: string, file_name: string, type: string = 'text/plain') {\n    const f = new Blob([data], { type: type });\n\n    // Use anchors instead of injecting anchor into UI.\n    const anchor = document.createElement('a');\n    anchor.href = URL.createObjectURL(f);\n    anchor.download = file_name;\n    anchor.click();\n\n    URL.revokeObjectURL(anchor.href);\n};\n\nexport function open(state: State): StateKey[] | undefined {\n    _open_text()\n        .then(rep => {\n            const [s, name] = rep;\n            try {\n                const next_state = string_to_canvas(s);\n                state.nodes = next_state.nodes;\n                state.links = next_state.links;\n                state.file_name = name.substring(0, name.lastIndexOf('.'));\n\n                // Force the update only when the call resolves.\n                force_update(['nodes', 'links', 'can', 'file_name', 'canvas']);\n            } catch (error) {\n                console.error(error);\n            }\n        });\n\n    return;\n}\n\nasync function _open_text(): Promise<[string, string]> {\n    return new Promise<[string, string]>((resolve, reject) => {\n        // TODO: verify that element creation is not causing a memory leak.\n        // js may not be garbage collecting this properly.\n        const f_input = document.createElement('input');\n        f_input.type = 'file';\n        f_input.accept = '.fsmjson';\n\n        f_input.oninput = (e: Event) => {\n            const f = (<HTMLInputElement>e.target).files![0];\n            f.text()\n                .then(s => resolve([s, f.name]));\n        }\n\n        f_input.click();\n    });\n}","/**\n * In charge of loading strings, undoing and redoing actions.\n * Stores the global state and its subscribers.\n */\n\nimport { Component } from \"preact\";\nimport { Canvas } from \"../components/canvas/canvas\";\nimport { CanvasTool, EffectOf, State, StateEffects, StateKey, Subscribers } from \"../types\";\nimport { effect_canvas, effect_prev_tool, effect_save_backup, effect_undo_redo } from \"./effects\";\n\nconst _state: State = {\n    temp_link: undefined, // a Link\n\n    canvas: undefined!,\n    view_zone: {\n        zoom: 1,\n        x: 0,\n        y: 0,\n    },\n\n    active_objects: [],\n    selected_object: undefined, // either a Link or a Node\n    nodes: [],\n    links: [],\n\n    last_tool: CanvasTool.POINTER,\n    curr_tool: CanvasTool.POINTER,\n\n    can: { undo: false, redo: false },\n    file_name: 'untitled',\n};\n\nconst _subscribers: Subscribers<State> = {\n    temp_link: [],\n\n    canvas: [],\n    view_zone: [],\n\n    active_objects: [],\n    selected_object: [],\n    nodes: [],\n    links: [],\n\n    last_tool: [],\n    curr_tool: [],\n\n    can: [],\n    file_name: [],\n};\n\nconst _post_effects: StateEffects<State> = {\n    temp_link: [],\n\n    canvas: [effect_canvas],\n    view_zone: [],\n\n    active_objects: [],\n    selected_object: [effect_undo_redo, effect_save_backup],\n    nodes: [effect_undo_redo, effect_save_backup],\n    links: [effect_undo_redo, effect_save_backup],\n\n    last_tool: [],\n    curr_tool: [effect_prev_tool],\n\n    can: [],\n    file_name: [],\n};\n\nconst _subscriber_map: Map<Component, StateKey[]> = new Map();\n\n/**\n * Subscribe the component to certain keys.\n */\nexport function subscribe(keys: StateKey[], component: Component) {\n    for (const key of keys) {\n        if (!_subscribers[key].includes(component)) _subscribers[key].push(component);\n    }\n    _subscriber_map.set(component, keys);\n}\n\n/**\n * Unsubscribe the component from all keys.\n */\nexport function unsubscribe(component: Component) {\n    const subbed_keys = _subscriber_map.get(component);\n\n    if (subbed_keys != null) {\n        for (let key of subbed_keys) {\n            for (let i = _subscribers[key].length - 1; i >= 0; i--) {\n                if (component == _subscribers[key][i]) {\n                    _subscribers[key].splice(i, 1);\n                    i--;\n                }\n            }\n        }\n    }\n}\n\nlet _canvas: Canvas;\nexport function get_canvas(): Canvas { return _canvas; }\n/** Set the canvas if not already set. */\nexport function set_default_canvas(c: Canvas): void { if (_canvas == null) _canvas = c; _state.canvas = c; }\n\n\n// /**\n//  * Apply a function onto the state.\n//  * @param func Function of the state.\n//  */\n// export function mutate_mediate(keys: StateKey[], func: (state: State) => StateKey[] | undefined, execute_actions: boolean = true) {\n//     if (execute_actions) pre_actions(keys);\n\n//     func(_state);\n\n//     if (keys != null) {\n//         if (execute_actions) post_actions(keys);\n\n//         // And update.\n//         push_update(keys);\n//     };\n// }\n\n// function pre_actions(keys: StateKey[]) {\n//     // Fetch actions.\n//     const actions: EffectOf<State>[] = [];\n//     for (const key of keys)\n//         for (const action of _pre_effects[key])\n//             if (!actions.includes(action)) actions.push(action);\n\n//     // Execute actions.  \n//     for (const action of actions)\n//         action(_state);\n// }\n\nfunction post_actions(keys: StateKey[]) {\n    // Fetch actions.\n    const actions: EffectOf<State>[] = [];\n    for (const key of keys)\n        for (const action of _post_effects[key])\n            if (!actions.includes(action)) actions.push(action);\n\n    // Execute actions.  \n    for (const action of actions)\n        action(_state);\n}\n\n/**\n * Apply a function onto the state.\n * @param func Function of the state.\n */\nexport function mutate(func: (state: State) => StateKey[] | undefined, execute_actions: boolean = true) {\n    let keys = func(_state);\n\n    if (keys != null) {\n        if (execute_actions) post_actions(keys);\n\n        // And update.\n        push_update(keys);\n    };\n}\n\n/**\n * Apply a function onto the state with extra arguments.\n * @param func Function of the state.\n */\nexport function mutate_with_args<Args>(func: (state: State, ...args: Args[]) => StateKey[] | undefined, execute_actions: boolean = true, ...args: Args[]) {\n    let keys = func(_state, ...args);\n\n    if (keys != null) {\n        if (execute_actions) post_actions(keys);\n\n        // And update.\n        push_update(keys);\n    };\n}\n\n/**\n * Update the keys without explicit mutation.\n * \n * Use with caution.\n */\nexport function force_update(keys: StateKey[]) {\n    push_update(keys);\n    post_actions(keys);\n}\n\n/**\n * Get a state.\n * \n * Must not mutate the state.\n */\nexport function get_state<K extends StateKey>(key: K): State[K] {\n    return _state[key];\n}\n\n/**\n * Apply a function onto the state and return the result.\n * \n * Must not mutate the state.\n * @param func Function of the state.\n */\nexport function access<T>(func: (state: State) => T): T {\n    return func(_state);\n}\n\n/**\n * Update all the subscribers to this key.\n * @param key \n */\nfunction push_update(keys: StateKey[]) {\n    // Store update-ables in set to minimize duplicate rerenders.\n    const will_update: Component[] = [];\n    for (const key of keys) {\n        for (const subscriber of _subscribers[key])\n            if (!will_update.includes(subscriber)) will_update.push(subscriber);\n    }\n\n    for (const comp of will_update) {\n        comp.setState({});\n    }\n}","import { State } from \"../types\";\n\n\n/** Update the undo/redo stack. */\nexport function effect_prev_tool(state: State) {\n    state.last_tool = state.curr_tool;\n}\n\n/** Force the canvas to redraw. Avoid using. */\nexport function effect_canvas(state: State) {\n    state.canvas.draw();\n}\n\nexport { effect_undo_redo } from \"./undo_redo\";\n\nexport { effect_save_backup } from \"./backup\";","import { CanvasJSON, FSMCanvasState, State, StateKey } from \"../types\";\nimport { canvas_to_string, string_to_canvas } from \"./backup\";\nimport { mutate } from \"./store\";\n\nlet _undo_stack: CanvasJSON[] = [];\nlet _curr: CanvasJSON = '';\nlet _redo_stack: CanvasJSON[] = [];\n\n/** Reset the undo and redo stacks. */\nexport function reset_undo_redo(state: State): StateKey[] | undefined {\n    _undo_stack = [];\n    _redo_stack = [];\n    _curr = canvas_to_string(state);\n    state.can = { undo: false, redo: false };\n    return ['can'];\n}\n\n/**\n * Save the canvas to the undo/redo stacks and to localStorage.\n */\nexport function effect_undo_redo(prev: State) {\n    const str = canvas_to_string(prev);\n\n    if (_curr != str) {\n        _undo_stack.push(_curr);\n        _curr = str;\n        _redo_stack = [];\n    }\n}\n\n/** Deselect an object and mutate the store if necessary.\n * The state update causes the undo_redo effect to store otherwise\n * unrecorded text changes of the selected object.\n */\nfunction deselect(state: State): StateKey[] | undefined {\n    if (state.selected_object != null) {\n        state.selected_object.selected = false;\n        state.selected_object = undefined;\n        return ['selected_object'];\n    }\n    return;\n}\n\n/**\n * Undo a canvas change if possible.\n */\nexport function undo(state: State): StateKey[] | undefined {\n    mutate(deselect);\n\n    if (_undo_stack.length > 0) {\n        let next_str = _undo_stack.pop()!;\n        // Push current state to the redo stack.\n        _redo_stack.push(_curr);\n        _curr = next_str;\n\n        // Load the new state from the undo stack.\n        const next_state: FSMCanvasState = string_to_canvas(next_str!);\n        state.nodes = next_state.nodes;\n        state.links = next_state.links;\n\n        state.can.undo = _undo_stack.length > 0;\n        state.can.redo = _redo_stack.length > 0;\n\n        // Update subscribers.\n        return ['nodes', 'links', 'can'];\n    } else { console.warn('Tried to undo with no actions to undo.'); return; }\n}\n\n/**\n * Redo an undone canvas change if possible.\n */\nexport function redo(state: State): StateKey[] | undefined {\n    mutate(deselect);\n\n    let next_str = _redo_stack.pop();\n    if (next_str != null) {\n        // Push current state to the undo stack.\n        _undo_stack.push(_curr);\n        _curr = next_str;\n\n        // Load the new state from the undo stack.\n        const next_state: FSMCanvasState = string_to_canvas(next_str);\n        state.nodes = next_state.nodes;\n        state.links = next_state.links;\n\n        state.can.undo = _undo_stack.length > 0;\n        state.can.redo = _redo_stack.length > 0;\n\n        // Update subscribers.\n        return ['nodes', 'links', 'can'];\n    } else { console.warn('Tried to redo with no actions to redo.'); return; }\n}","/**\n * Non-specific types.\n */\n\nimport { Component } from \"preact\";\nimport { Canvas } from \"./components/canvas/canvas\";\nimport { AnyLink, DrawableElement, FSMLink } from \"./components/elements/abstract\";\nimport { StateNode } from \"./components/elements/state_node\";\nimport { ExportAsLaTeX } from \"./export_as/latex\";\nimport { ExportAsSVG } from \"./export_as/svg\";\n\nexport enum CanvasTool {\n    POINTER = 1,\n    DRAW_NODE,\n    DRAW_LINK,\n    DRAW_ACCEPT,\n    ELIMINATE,\n    PAN,\n};\n\nexport interface State {\n    temp_link: AnyLink | undefined, // a Link\n\n    canvas: Canvas,\n    view_zone: CanvasViewTransform,\n\n    // Active objects is an experimental property and should not be used.\n    active_objects: StateNode[],\n    selected_object: DrawableElement | undefined, // either a Link or a Node\n    nodes: StateNode[],\n    links: FSMLink[],\n\n    last_tool: CanvasTool,\n    curr_tool: CanvasTool,\n\n    can: { undo: boolean, redo: boolean },\n    file_name: string,\n};\n\nexport type Subscribers<State> = {\n    [K in keyof State]: Component[];\n};\n\nexport type StateEffects<State> = {\n    [K in keyof State]: EffectOf<State>[];\n};\n\nexport type EffectOf<State> = (state: State) => any;\n\nexport enum CanvasAction {\n    LOAD = 1,\n    SAVE,\n    UNDO,\n    REDO,\n    SUBSET_CONSTRUCT,\n    RESET_ZOOM,\n    FORCE_EXPAND,\n}\n\nexport enum MouseButton {\n    LEFT = 0,\n    MIDDLE = 1,\n    RIGHT = 2,\n}\n\n\nexport type CursorFlags = {\n    moving: boolean,\n    down: boolean,\n}\n\nexport interface CanvasRectangle {\n    top: number,\n    left: number,\n    width: number,\n    height: number,\n}\n\nexport interface CanvasViewTransform {\n    zoom: number,\n    x: number,\n    y: number,\n}\n\nexport type FSMContext = CanvasRenderingContext2D | ExportAsLaTeX | ExportAsSVG;\n\nexport type NodeLinkEndPointsAndCircle = LinkNoCircle | LinkCircleReversible;\nexport type SelfLinkCircle = LinkCircle;\n\ninterface LinkEndPoints {\n    startX: number,\n    startY: number,\n    endX: number,\n    endY: number,\n};\n\ninterface LinkNoCircle extends LinkEndPoints {\n    hasCircle: false\n};\n\ninterface LinkCircle extends LinkEndPoints {\n    hasCircle: true,\n    startAngle: number,\n    endAngle: number,\n    circleX: number,\n    circleY: number,\n    circleRadius: number,\n}\n\ninterface LinkCircleReversible extends LinkCircle {\n    reverseScale: number,\n    isReversed: boolean,\n}\n\nexport type StateKey = keyof State;\n\n/** A JSON string containing nodes and links properties. */\nexport type CanvasJSON = string;\n\nexport type FSMCanvasState = {\n    nodes: StateNode[],\n    links: FSMLink[],\n};\n\nexport interface Point2D {\n    x: number;\n    y: number;\n};\n\nexport type Backup = {\n    nodes: BackupNode[],\n    links: BackupLink[]\n};\n\nexport type BackupNode = {\n    x: number,\n    y: number,\n    text: string,\n    isAcceptState: boolean,\n};\n\nexport type BackupLink = BackupNodeLink | BackupStartLink | BackupSelfLink;\n\ntype _BackupLink = {\n    text: string,\n};\n\ntype BackupNodeLink = _BackupLink & {\n    type: 'NodeLink' | 'Link',\n    nodeA: number,\n    nodeB: number,\n    lineAngleAdjust: number,\n    parallelPart: number,\n    perpendicularPart: number,\n}\n\ntype BackupStartLink = _BackupLink & {\n    type: 'StartLink',\n    node: number,\n    deltaX: number,\n    deltaY: number,\n}\n\ntype BackupSelfLink = _BackupLink & {\n    type: 'SelfLink',\n    node: number,\n    anchorAngle: number,\n}","/**\n * Regex parsing and utilities.\n */\n\nimport { convert_latex_shortcuts } from \"../components/elements/text_utils\";\nimport { BIN_OPS, FUNCTIONS_OPS, INFIX_CHAR_OPS, L_NON_CONCAT_OPS, OPS, OP_PRECEDENCE, R_NON_CONCAT_OPS } from \"./constants\";\n\n\n/**\n * Convert string to RPN stack.\n * Using https://en.wikipedia.org/wiki/Shunting-yard_algorithm.\n */\nexport function to_RPN(s: string) {\n    const lst = _parse_tokens(s);\n    const output: string[] = [];\n    const op_stack: string[] = [];\n\n    for (let i = 0; i < lst.length; i++) {\n        const token: string = lst[i];\n\n\n        if (token == OPS.KLEIN) {\n            // Function case.\n            op_stack.push(token);\n\n        } else if (BIN_OPS.includes(token)) {\n            // Binary operands.\n            while (op_stack.length > 0) {\n                let top = op_stack[op_stack.length - 1];\n\n                if (top != OPS.OPEN_LEFT && OP_PRECEDENCE[top] >= OP_PRECEDENCE[token]) {\n                    const next = op_stack.pop();\n                    if (next != null) output.push(next);\n                } else break;\n            }\n\n            op_stack.push(token);\n        } else if (token == OPS.OPEN_LEFT) {\n            // (\n            op_stack.push(token);\n        } else if (token == OPS.CLOSE_RIGHT) {\n            // )\n            while (op_stack.length > 0) {\n                let top = op_stack[op_stack.length - 1];\n\n                if (top != OPS.OPEN_LEFT) {\n                    const next = op_stack.pop();\n                    if (next != null) output.push(next);\n                } else break;\n            }\n\n            if (op_stack.length == 0)\n                console.error('The operator stack is empty, fix the parentheses.');\n\n            op_stack.pop();\n\n            if (op_stack.length > 0 && FUNCTIONS_OPS.includes(op_stack[length - 1])) {\n                const next = op_stack.pop();\n                if (next != null) output.push(next);\n            }\n        } else {\n            output.push(token);\n        }\n\n    }\n\n    let top = op_stack.pop();\n    while (top != null) {\n        output.push(top);\n        top = op_stack.pop();\n    }\n\n    return output;\n}\n\n/**\n * Convert string to token list.\n */\nfunction _parse_tokens(s: string) {\n    // Add explicity brackets to a* single character expressions.\n    s = s.replace(/(\\w)\\*/g, '($1)*');\n    s = convert_latex_shortcuts(s);\n    const lst: string[] = [];\n    let last = 0;\n    let i = 0;\n\n    while (i < s.length) {\n        if (INFIX_CHAR_OPS.includes(s[i])) {\n            if (last != i)\n                lst.push(s.slice(last, i));\n            last = i + 1;\n            lst.push(s[i]);\n        } else if (s[i] == OPS.KLEIN) {\n            // Reverse order as * (operand)\n            let locator = lst.length - 1;\n            let score = 0;\n\n            // Find where to insert *\n            while (locator >= 0) {\n                if (lst[locator] == OPS.CLOSE_RIGHT)\n                    score++;\n                else if (lst[locator] == OPS.OPEN_LEFT)\n                    score--;\n\n                if (score == 0)\n                    break;\n\n                locator--;\n            }\n            // Insert *\n            lst.splice(locator, 0, s[i]);\n\n            last = i + 1;\n        }\n\n        i++;\n    }\n\n    // Add remaining chars.\n    if (last != i)\n        lst.push(s.slice(last));\n\n    // Insert concatenation operators.\n    i = lst.length - 1;\n    while (i > 0) {\n        // Left is not: (x  +x  &x  *x\n        // Right is not: x)  x+  x&\n        // but x(  )x  *x allowed.\n        if (!L_NON_CONCAT_OPS.includes(lst[i - 1]) && !R_NON_CONCAT_OPS.includes(lst[i])) {\n            lst.splice(i, 0, OPS.CONCAT);\n        }\n\n        i--;\n    }\n\n    return lst;\n}","/**\n * State elimination of nodes.\n */\nimport { AnyLink, FSMElementString, FSMLink } from \"../components/elements/abstract\";\nimport { NodeLink } from \"../components/elements/node_link\";\nimport { SelfLink } from \"../components/elements/self_link\";\nimport { StartLink } from \"../components/elements/start_link\";\nimport { StateNode } from \"../components/elements/state_node\";\nimport { EPSILON, OPS } from \"./constants\";\nimport { to_RPN } from \"./expr\";\nimport { to_symbol } from \"./shared_utils\";\n\n/**\n * Eliminate node from nodes.\n * Replace transitions with a partial regex.\n * \n * @return Whether any states were eliminated.\n */\nexport function _eliminate(node: StateNode, nodes: StateNode[], links: AnyLink[]): boolean {\n\n    if (node.isAcceptState)\n        return false;\n\n    const incoming_links = [];\n    const outgoing_links = [];\n    const self_links = [];\n\n    const new_links: FSMLink[] = [];\n\n    // Find and categorize links.\n    for (let i = 0; i < links.length; i++) {\n        const link = links[i];\n\n        if (link instanceof SelfLink && link.node == node)\n            self_links.push(link);\n        else if (link instanceof NodeLink) {\n            if (link.nodeA == node)\n                outgoing_links.push(link);\n            else if (link.nodeB == node)\n                incoming_links.push(link);\n        } else if (link instanceof StartLink) {\n            if (link.node == node)\n                return false;\n        }\n    }\n\n    // Create self pathway regex.\n    let self_reg = '';\n    if (self_links.length > 0) {\n        const self_options = [];\n        for (let _ = 0; _ < self_links.length; _++) {\n            self_options.push(...self_links[_].text.split(','));\n        }\n        if (self_options.length == 1 && self_options[0].length == 1)\n            self_reg = `${self_options[0]}*`\n        else if (self_options.length > 0)\n            self_reg = `(${self_options.join('+')})*`\n    }\n\n    // Create new links, 1 for each pair of incoming and outgoing links.\n    for (let i = 0; i < incoming_links.length; i++) {\n        const in_link = incoming_links[i];\n\n        for (let j = 0; j < outgoing_links.length; j++) {\n            const out_link = outgoing_links[j];\n\n            let new_link;\n            let text;\n\n            text = `${to_safe_str(in_link.text.split(',').map(s => s.trim()).join('+'))}${self_reg}${to_safe_str(out_link.text.split(',').map(s => s.trim()).join('+'))}`;\n\n            if (in_link.nodeA == out_link.nodeB)\n                new_link = new SelfLink(in_link.nodeA);\n            else\n                new_link = new NodeLink(in_link.nodeA, out_link.nodeB);\n\n            text = strip_parenthesis(remove_epsilon(text));\n            new_link.text = text;\n            links.push(new_link);\n        }\n    }\n\n    // Delete old links and node.\n    let i = links.length;\n    // js moment\n    while (i--)\n        if (incoming_links.some(link => link == links[i]) || outgoing_links.some(link => link == links[i]) || self_links.some(link => link == links[i]))\n            links.splice(i, 1);\n\n    nodes.splice(nodes.indexOf(node), 1);\n\n    for (let i = 0; i < new_links.length; i++) {\n        links.push(new_links[i]);\n    }\n\n    minimize_links(links);\n\n    return true;\n}\n\n/**\n * Remove redundant \\epsilon from the regex string.\n */\nfunction remove_epsilon(s: string) {\n    // xe or x*e or )e case\n    // And\n    // ex or e(\n    return s.replace(new RegExp(`/([)*\\w])(${EPSILON})/g`), '$1')\n        .replace(new RegExp(`/(${EPSILON})([(\\w])/g`), '$2');\n}\n\n/**\n * Minimize redundant links.\n */\nfunction minimize_links(links: AnyLink[]) {\n    const deletable: AnyLink[] = [];\n\n    const node_link_data = new Map<String, (NodeLink | SelfLink)[]>();\n\n    for (let i = 0; i < links.length; i++) {\n        const link = links[i];\n\n        if (link instanceof SelfLink) {\n            let key: FSMElementString = to_symbol(link.node);\n            const similar = node_link_data.get(key);\n\n            if (similar != null)\n                similar.push(link);\n            else\n                node_link_data.set(key, [link]);\n        } else if (link instanceof NodeLink) {\n            let key: FSMElementString = to_symbol(link.nodeA) + to_symbol(link.nodeB);\n            const similar = node_link_data.get(key);\n\n            if (similar != null)\n                similar.push(link);\n            else\n                node_link_data.set(key, [link]);\n        }\n    }\n\n    // Squish and mark as deletable.\n    for (const similar of node_link_data.values()) {\n        if (similar.length > 1) {\n            similar[0].text = `${similar.map\n                (l => l.text)\n                .join('+')}`;\n\n            for (let i = 1; i < similar.length; i++)\n                deletable.push(similar[i]);\n        }\n    }\n\n    let i = links.length;\n    // js moment\n    while (i--)\n        if (deletable.includes(links[i]))\n            links.splice(i, 1);\n}\n\n/**\n * Take a regular expression string and add parenthesis if needed.\n * Parentheses are needed for when there is an exposed binary operator +.\n */\nfunction to_safe_str(s: string) {\n    if (s.includes('+')) {\n        let rpn = to_RPN(s);\n        // Has first level binary operator (+) which needs parentheses.\n        if (rpn.length > 0 && rpn[rpn.length - 1] == OPS.OR) {\n            // Has parentheses already, ex: (x+x)\n            // Must check if those are needed.\n            if (s.charAt(0) == OPS.OPEN_LEFT && s.charAt(s.length - 1) == OPS.CLOSE_RIGHT) {\n                // Check if the parenthesis are needed.\n                // By checking validity of x[1:-1] without them.\n                let score = 0;\n                for (let i = 1; i < s.length - 1; i++) {\n                    if (s[i] == OPS.OPEN_LEFT)\n                        score++;\n                    else if (s[i] == OPS.CLOSE_RIGHT)\n                        score--;\n\n                    // More closed than expected (counting from the first index), ex: (x+y)+(x+z)\n                    // So return s back immediately.\n                    if (score < 0) return `(${s})`;\n                }\n                // More open that expected (counting from the first index), ex: (()\n                if (score != 0) {\n                    console.warn(`String \"${s}\" has non matching number of parentheses.`);\n                    return s;\n                };\n                // Otherwise, just return s.\n            }\n            // Add brackets, ex: x+y --> (x+y) \n            else return `(${s})`;\n        }\n    }\n\n    // All other operators are safely concatenated.\n    return s;\n}\n\n/**\n * Remove unnecessary outer parenthesis if needed.\n */\nfunction strip_parenthesis(s: string) {\n    if (s.length > 2 && s.charAt(0) == OPS.OPEN_LEFT && s.charAt(s.length - 1) == OPS.CLOSE_RIGHT) {\n        // Check if the parenthesis are needed.\n        // By checking validity of x[1:-1] without them.\n        let score = 0;\n        for (let i = 1; i < s.length - 1; i++) {\n            if (s[i] == OPS.OPEN_LEFT)\n                score++;\n            else if (s[i] == OPS.CLOSE_RIGHT)\n                score--;\n\n            // More closed than expected (counting from the first index), ex: (x+y)+(x+z)\n            // So return s back immediately.\n            if (score < 0) return s;\n        }\n        // More open that expected (counting from the first index), ex: (()\n        if (score != 0) {\n            return s;\n        };\n        // Otherwise, return s[1:-1] without those parenthesis as they were not needed.\n        return s.substring(1, s.length - 1);\n    }\n    return s;\n}\n\n// {\"nodes\":[{\"x\":124,\"y\":106,\"text\":\"q_0\",\"isAcceptState\":false},{\"x\":366,\"y\":98,\"text\":\"q_1\",\"isAcceptState\":false},{\"x\":609,\"y\":98,\"text\":\"q_2\",\"isAcceptState\":false},{\"x\":685,\"y\":328,\"text\":\"q_3\",\"isAcceptState\":false},{\"x\":557,\"y\":512,\"text\":\"q_4\",\"isAcceptState\":false},{\"x\":358,\"y\":328,\"text\":\"q_5\",\"isAcceptState\":false},{\"x\":150,\"y\":428,\"text\":\"q_6\",\"isAcceptState\":true}],\"links\":[{\"type\":\"Link\",\"nodeA\":0,\"nodeB\":1,\"text\":\"\\\\epsilon\",\"lineAngleAdjust\":0,\"parallelPart\":0.5,\"perpendicularPart\":0},{\"type\":\"SelfLink\",\"node\":1,\"text\":\"0\",\"anchorAngle\":-2.0344439357957027},{\"type\":\"Link\",\"nodeA\":1,\"nodeB\":2,\"text\":\"1\",\"lineAngleAdjust\":0,\"parallelPart\":0.5,\"perpendicularPart\":0},{\"type\":\"Link\",\"nodeA\":1,\"nodeB\":6,\"text\":\"\\\\epsilon\",\"lineAngleAdjust\":0,\"parallelPart\":0.5,\"perpendicularPart\":0},{\"type\":\"Link\",\"nodeA\":5,\"nodeB\":1,\"text\":\"0\",\"lineAngleAdjust\":0,\"parallelPart\":0.5,\"perpendicularPart\":0},{\"type\":\"Link\",\"nodeA\":4,\"nodeB\":6,\"text\":\"\\\\epsilon\",\"lineAngleAdjust\":0,\"parallelPart\":0.5,\"perpendicularPart\":0},{\"type\":\"SelfLink\",\"node\":4,\"text\":\"0,1\",\"anchorAngle\":0.866302262552679},{\"type\":\"Link\",\"nodeA\":5,\"nodeB\":4,\"text\":\"1\",\"lineAngleAdjust\":0,\"parallelPart\":0.5,\"perpendicularPart\":0},{\"type\":\"Link\",\"nodeA\":3,\"nodeB\":5,\"text\":\"0\",\"lineAngleAdjust\":0,\"parallelPart\":0.5,\"perpendicularPart\":0},{\"type\":\"Link\",\"nodeA\":2,\"nodeB\":4,\"text\":\"1\",\"lineAngleAdjust\":0,\"parallelPart\":0.5,\"perpendicularPart\":0},{\"type\":\"Link\",\"nodeA\":2,\"nodeB\":3,\"text\":\"0\",\"lineAngleAdjust\":0,\"parallelPart\":0.5,\"perpendicularPart\":0},{\"type\":\"Link\",\"nodeA\":3,\"nodeB\":4,\"text\":\"1\",\"lineAngleAdjust\":0,\"parallelPart\":0.5,\"perpendicularPart\":0}]}\n\n// {\"nodes\":[{\"x\":166,\"y\":269,\"text\":\"q_0\",\"isAcceptState\":false},{\"x\":315,\"y\":269,\"text\":\"q_1\",\"isAcceptState\":false},{\"x\":485,\"y\":269,\"text\":\"q_2\",\"isAcceptState\":false},{\"x\":676,\"y\":276,\"text\":\"q_3\",\"isAcceptState\":false},{\"x\":585,\"y\":144,\"text\":\"q_5\",\"isAcceptState\":true},{\"x\":158,\"y\":463,\"text\":\"q_4\",\"isAcceptState\":false}],\"links\":[{\"type\":\"StartLink\",\"node\":5,\"text\":\"start\",\"deltaX\":0,\"deltaY\":78},{\"type\":\"Link\",\"nodeA\":5,\"nodeB\":0,\"text\":\"\\\\epsilon\",\"lineAngleAdjust\":0,\"parallelPart\":0.5,\"perpendicularPart\":0},{\"type\":\"Link\",\"nodeA\":2,\"nodeB\":4,\"text\":\"\\\\epsilon\",\"lineAngleAdjust\":0,\"parallelPart\":0.5,\"perpendicularPart\":0},{\"type\":\"Link\",\"nodeA\":3,\"nodeB\":4,\"text\":\"\\\\epsilon\",\"lineAngleAdjust\":0,\"parallelPart\":0.5,\"perpendicularPart\":0},{\"type\":\"Link\",\"nodeA\":1,\"nodeB\":0,\"text\":\"a\",\"lineAngleAdjust\":0,\"parallelPart\":0.44966442953020136,\"perpendicularPart\":-25},{\"type\":\"Link\",\"nodeA\":0,\"nodeB\":1,\"text\":\"a\",\"lineAngleAdjust\":3.141592653589793,\"parallelPart\":0.6174496644295302,\"perpendicularPart\":-28},{\"type\":\"Link\",\"nodeA\":0,\"nodeB\":2,\"text\":\"b\",\"lineAngleAdjust\":3.141592653589793,\"parallelPart\":0.6807205087375884,\"perpendicularPart\":-79.68112458455441},{\"type\":\"Link\",\"nodeA\":1,\"nodeB\":2,\"text\":\"\\\\epsilon\",\"lineAngleAdjust\":0,\"parallelPart\":0.5,\"perpendicularPart\":0},{\"type\":\"Link\",\"nodeA\":3,\"nodeB\":2,\"text\":\"a\",\"lineAngleAdjust\":3.141592653589793,\"parallelPart\":0.37839384167273493,\"perpendicularPart\":-27.283137716577034},{\"type\":\"Link\",\"nodeA\":3,\"nodeB\":1,\"text\":\"a\",\"lineAngleAdjust\":3.141592653589793,\"parallelPart\":0.364309273605891,\"perpendicularPart\":-76.56455478932932},{\"type\":\"Link\",\"nodeA\":2,\"nodeB\":3,\"text\":\"b\",\"lineAngleAdjust\":3.141592653589793,\"parallelPart\":0.6044073364358062,\"perpendicularPart\":-15.241076695359656},{\"type\":\"SelfLink\",\"node\":2,\"text\":\"b\",\"anchorAngle\":-1.5707963267948966}]}\n","/**\n * Tool functions for canvas handlers and actions.\n * All tools are functions of the state.\n * \n * @note Move this to a class in the future to avoid dependencies.\n */\n\nimport { _eliminate } from \"../../algs/eliminate\";\nimport { State, StateKey } from \"../../types\";\nimport { NodeLink } from \"../elements/node_link\";\nimport { SelfLink } from \"../elements/self_link\";\nimport { StartLink } from \"../elements/start_link\";\nimport { StateNode } from \"../elements/state_node\";\nimport { TemporaryLink } from \"../elements/temporary_link\";\n\n\n\n// Tools:\n\n/** Select an object if necessary. */\nexport function update_select(state: State): StateKey[] | undefined {\n    // Deselect old object.\n    if (state.selected_object != null) state.selected_object.selected = false;\n\n    // Select the new object if applicable.\n    const at_cursor = state.canvas.cursor.obj_at_last_pos;\n    state.selected_object = at_cursor;\n\n    // Update the selected object's state.\n    if (at_cursor != null) {\n        at_cursor.selected = true;\n\n        if (at_cursor instanceof StateNode || at_cursor instanceof SelfLink)\n            at_cursor.set_mouse_start(state.canvas.cursor.mouse_down_pos.x, state.canvas.cursor.mouse_down_pos.y);\n    }\n\n    return ['selected_object'];\n}\n\n/** Draw a new node at the cursor's position and select it. */\nexport function draw_node(state: State): StateKey[] | undefined {\n    if (state.canvas.cursor.obj_at_last_pos == null) {\n        const pos = state.canvas.cursor.last_pos;\n\n        const new_node = new StateNode(pos.x, pos.y);\n        new_node.selected = true;\n\n        // Deselect old object.\n        if (state.selected_object != null) state.selected_object.selected = false;\n        state.selected_object = new_node;\n\n        state.nodes.push(new_node);\n\n        return ['nodes', 'selected_object'];\n    }\n}\n\n/** Toggle the selected node's accepting node / vice versa. */\nexport function toggle_accept_state(state: State): StateKey[] | undefined {\n    const obj = state.canvas.cursor.obj_at_last_pos;\n    if (obj instanceof StateNode)\n        obj.isAcceptState = !obj.isAcceptState;\n\n    state.selected_object = obj;\n\n    return ['selected_object'];\n}\n\n/** Drag the selected object across the canvas / drag the canvas around. */\nexport function drag(state: State): StateKey[] | undefined {\n    const anchor = state.canvas.cursor.last_pos;\n\n    if (state.selected_object != undefined) {\n        state.selected_object.set_anchor_point(anchor.x, anchor.y);\n        return ['nodes', 'links', 'selected_object'];\n    } else {\n        // Drag canvas itself.\n        const next_view = { ...state.view_zone };\n\n        next_view.x = next_view.zoom * (anchor.x - state.canvas.cursor.mouse_down_pos.x) + next_view.x;\n        next_view.y = next_view.zoom * (anchor.y - state.canvas.cursor.mouse_down_pos.y) + next_view.y;\n\n        state.view_zone = next_view;\n\n        return ['view_zone'];\n    }\n}\n\n/** Update the temporary link that should be created given the state of the cursor. */\nexport function update_temp_link(state: State): StateKey[] | undefined {\n    let temp;\n\n    const start = state.canvas.cursor.obj_at_mouse_down;\n    const end = state.canvas.cursor.obj_at_last_pos;\n    const start_pos = { ...state.canvas.cursor.mouse_down_pos };\n    const end_pos = { ...state.canvas.cursor.last_pos };\n\n    // The link starts and ends at a node.\n    if (start instanceof StateNode && end instanceof StateNode) {\n        if (start == end) {\n            // The links start and ends at the same node.\n            temp = new SelfLink(start);\n            temp.set_mouse_start(start_pos.x, start_pos.y);\n            temp.set_anchor_point(end_pos.x, end_pos.y);\n        } else {\n            // If it ends at a different node, create a regular link.\n            temp = new NodeLink(start, end);\n        }\n\n    } else if (end instanceof StateNode) {\n        temp = new StartLink(end, start_pos);\n    } else {\n        // Starting anywhere else, it is a temp link, possibly with a starting node.\n        temp = new TemporaryLink(\n            (start instanceof StateNode)\n                ? start.closest_point_on_circle(end_pos.x, end_pos.y)\n                : start_pos,\n            end_pos);\n    }\n\n    state.temp_link = temp;\n\n    return ['temp_link'];\n}\n\n/** Add the currently worked on temporary link to the list of links. */\nexport function end_temp_link(state: State): StateKey[] | undefined {\n    if (!(state.temp_link instanceof TemporaryLink)) {\n        state.links.push(state.temp_link!);\n\n        // Select the new link automatically.\n        state.temp_link!.selected = true;\n        if (state.selected_object != null) state.selected_object.selected = false;\n        state.selected_object = state.temp_link;\n    }\n\n    state.temp_link = undefined;\n\n    return ['links', 'temp_link'];\n}\n\n/** Eliminate the selected state node. */\nexport function eliminate(state: State): StateKey[] | undefined {\n    let should_update = false;\n    const active_objects = [state.selected_object, ...state.active_objects];\n\n    for (const obj of active_objects) {\n        if (obj instanceof StateNode)\n            should_update = should_update || _eliminate(obj, state.nodes, state.links);\n    }\n\n    if (state.selected_object != null) {\n        state.selected_object.selected = false;\n        state.selected_object = undefined;\n    }\n\n    return should_update ? ['nodes', 'links', 'selected_object'] : undefined;\n}\n\n// Actions:\n\n/** Element deletion from model. */\nexport function delete_element(state: State): StateKey[] | undefined {\n\n    if (state.selected_object != null) {\n\n        if (state.selected_object instanceof StateNode) {\n            // Delete the node.\n            for (let i = state.nodes.length - 1; i >= 0; i--)\n                if (state.selected_object == state.nodes[i]) {\n                    state.nodes.splice(i, 1);\n                    break;\n                }\n\n            // Delete links attached to the node.\n            for (let i = state.links.length - 1; i >= 0; i--) {\n                const link = state.links[i];\n                let should_delete = false;\n\n                if (link instanceof NodeLink)\n                    should_delete = link.nodeA == state.selected_object || link.nodeB == state.selected_object;\n                else if (link instanceof StartLink || link instanceof SelfLink)\n                    should_delete = link.node == state.selected_object;\n\n                if (should_delete) state.links.splice(i, 1);\n\n            }\n        } else {\n            // Delete links themselves.\n            for (let i = state.links.length - 1; i >= 0; i--)\n                if (state.selected_object == state.links[i]) {\n                    state.links.splice(i, 1);\n                    break;\n                }\n        }\n        state.selected_object = undefined;\n        return ['nodes', 'links', 'selected_object'];\n    }\n    return;\n}\n\n/** Typing text into an object. */\nexport function type_text(state: State, text: string): StateKey[] | undefined {\n    if (state.selected_object != null) {\n        state.selected_object.text = state.selected_object.text + text;\n        return ['selected_object'];\n    }\n}\n\n/** Deleting text from object. */\nexport function delete_char(state: State): StateKey[] | undefined {\n    if (state.selected_object != null) {\n        state.selected_object.text = state.selected_object.text.substring(0, state.selected_object.text.length - 1);\n        return ['selected_object'];\n    }\n}\n\n/** Update the state when dragging is ended to update the undo queue. */\nexport function end_drag(state: State): StateKey[] | undefined {\n    if (state.selected_object != null) {\n        return ['nodes', 'links'];\n    }\n}\n\ntype NewType = StateKey;\n\n/**  */\nexport function zoom(state: State, e: WheelEvent): NewType[] | undefined {\n    const prev_view = state.view_zone;\n    const next_view = { ...prev_view };\n    const draw_space = state.canvas.event_to_canvas_space(e);\n\n    // Restrict zoom so user doesn't get lost.\n    next_view.zoom = Math.min(Math.max(next_view.zoom * Math.exp(-e.deltaY / 1000), 0.3), 3);\n\n    // Do math to find where mouse is pointing (via x,y offsets).\n    // Move towards mouse position.\n    next_view.x = (prev_view.zoom - next_view.zoom) * draw_space.x + prev_view.x;\n    next_view.y = (prev_view.zoom - next_view.zoom) * draw_space.y + prev_view.y;\n\n    state.view_zone = next_view;\n\n    return ['view_zone'];\n}","import { FSMContext, Point2D } from \"../../types\";\r\nimport { DrawableElement } from \"./abstract\";\r\nimport { draw_arrow } from \"./text_utils\";\r\n\r\n/** An arbitrary link in space. */\r\nexport class TemporaryLink extends DrawableElement {\r\n\tfrom: Point2D;\r\n\tto: Point2D;\r\n\r\n\tconstructor(from: Point2D, to: Point2D) {\r\n\t\tsuper();\r\n\t\tthis.from = from;\r\n\t\tthis.to = to;\r\n\t}\r\n\r\n\tdraw(c: FSMContext, selected: boolean = false) {\r\n\t\t// draw the line\r\n\t\tc.beginPath();\r\n\t\tc.moveTo(this.to.x, this.to.y);\r\n\t\tc.lineTo(this.from.x, this.from.y);\r\n\t\tc.stroke();\r\n\r\n\t\t// draw the head of the arrow\r\n\t\tdraw_arrow(c, this.to.x, this.to.y, Math.atan2(this.to.y - this.from.y, this.to.x - this.from.x));\r\n\t};\r\n\r\n\tcontains_point(pos: Point2D): boolean {\r\n\t\treturn false;\r\n\t}\r\n\r\n\tset_anchor_point(x: number, y: number): void { }\r\n}","import { get_canvas } from \"../../store/store\";\nimport { FSMContext } from \"../../types\";\n\nconst greek_letter_names = ['Alpha', 'Beta', 'Gamma', 'Delta', 'Epsilon', 'Zeta', 'Eta', 'Theta', 'Iota', 'Kappa', 'Lambda', 'Mu', 'Nu', 'Xi', 'Omicron', 'Pi', 'Rho', 'Sigma', 'Tau', 'Upsilon', 'Phi', 'Chi', 'Psi', 'Omega'];\n\n/**\n * Draw text using the context and with a caret if necessary.\n */\nexport function draw_text(c: FSMContext, original_text: string, x: number, y: number, angle_or_null: number | null, is_selected: boolean, caret_visible: boolean = false) {\n    const text = convert_latex_shortcuts(original_text);\n    c.font = '20px \"Times New Roman\", serif';\n    const width = measure_text(text);\n\n    // center the text\n    x -= width / 2;\n\n    // position the text intelligently if given an angle\n    if (angle_or_null != null) {\n        const cos = Math.cos(angle_or_null);\n        const sin = Math.sin(angle_or_null);\n        const cornerPointX = (width / 2 + 5) * (cos > 0 ? 1 : -1);\n        const cornerPointY = (10 + 5) * (sin > 0 ? 1 : -1);\n        const slide = sin * Math.pow(Math.abs(sin), 40) * cornerPointX - cos * Math.pow(Math.abs(cos), 10) * cornerPointY;\n        x += cornerPointX - sin * slide;\n        y += cornerPointY + cos * slide;\n    }\n\n    // draw text and caret (round the coordinates so the caret falls on a pixel)\n    // Used for exports.\n    if ('advancedFillText' in c) {\n        // @ts-ignore\n        c.advancedFillText(text, original_text, x + width / 2, y, angle_or_null);\n    } else {\n        x = Math.round(x);\n        y = Math.round(y);\n        c.fillText(text, x, y + 6);\n        if (is_selected && caret_visible && document.hasFocus()) {\n            x += width;\n            c.beginPath();\n            c.moveTo(x, y - 10);\n            c.lineTo(x, y + 10);\n            c.stroke();\n        }\n    }\n}\n\n/**\n * Draw an arrow at (x,y).\n * @param c Context.\n * @param x\n * @param y \n * @param angle in rad.\n */\nexport function draw_arrow(c: FSMContext, x: number, y: number, angle: number) {\n    const dx = Math.cos(angle);\n    const dy = Math.sin(angle);\n    c.beginPath();\n    c.moveTo(x, y);\n    c.lineTo(x - 8 * dx + 5 * dy, y - 8 * dy - 5 * dx);\n    c.lineTo(x - 8 * dx - 5 * dy, y - 8 * dy + 5 * dx);\n    c.fill();\n}\n\n/** Return the length of the text in the default 20px font, in px. */\nexport function measure_text(text: string): number {\n    const c = get_canvas();\n    if (c != null) {\n        const ctx = c.ctx;\n        if (ctx != null) {\n            ctx.font = '20px \"Times New Roman\", serif';\n            return ctx.measureText(text).width;\n        }\n    }\n    return 0;\n}\n\n/**\n * Replace all LaTeX greek letter shortcuts with their characters.\n * @returns Converted string.\n */\nexport function convert_latex_shortcuts(text: string) {\n    // html greek characters\n    for (let i = 0; i < greek_letter_names.length; i++) {\n        const name = greek_letter_names[i];\n        text = text.replace(new RegExp('\\\\\\\\' + name, 'g'), String.fromCharCode(913 + i + +(i > 16)));\n        text = text.replace(new RegExp('\\\\\\\\' + name.toLowerCase(), 'g'), String.fromCharCode(945 + i + +(i > 16)));\n    }\n\n    // subscripts\n    for (let i = 0; i < 10; i++) {\n        text = text.replace(new RegExp('_' + i, 'g'), String.fromCharCode(8320 + i));\n    }\n\n    return text;\n}\n\n/**\n * Convert text string to XML safe text.\n * @returns XML string.\n */\nexport function text_to_xml(text: string) {\n    text = text.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');\n    let result = '';\n    for (let i = 0; i < text.length; i++) {\n        let c = text.charCodeAt(i);\n        if (c >= 0x20 && c <= 0x7E) {\n            result += text[i];\n        } else {\n            result += '&#' + c + ';';\n        }\n    }\n    return result;\n}","import { EMPTY_ARR } from \"./constants\";\r\n\r\n/**\r\n * Assign properties from `props` to `obj`\r\n * @template O, P The obj and props types\r\n * @param {O} obj The object to copy properties to\r\n * @param {P} props The object to copy properties from\r\n * @returns {O & P}\r\n */\r\nexport function assign(obj, props) {\r\n\t// @ts-ignore We change the type of `obj` to be `O & P`\r\n\tfor (let i in props) obj[i] = props[i];\r\n\treturn /** @type {O & P} */ (obj);\r\n}\r\n\r\n/**\r\n * Remove a child node from its parent if attached. This is a workaround for\r\n * IE11 which doesn't support `Element.prototype.remove()`. Using this function\r\n * is smaller than including a dedicated polyfill.\r\n * @param {Node} node The node to remove\r\n */\r\nexport function removeNode(node) {\r\n\tlet parentNode = node.parentNode;\r\n\tif (parentNode) parentNode.removeChild(node);\r\n}\r\n\r\nexport const slice = EMPTY_ARR.slice;\r\n","import { slice } from './util';\r\nimport options from './options';\r\n\r\nlet vnodeId = 0;\r\n\r\n/**\r\n * Create an virtual node (used for JSX)\r\n * @param {import('./internal').VNode[\"type\"]} type The node name or Component\r\n * constructor for this virtual node\r\n * @param {object | null | undefined} [props] The properties of the virtual node\r\n * @param {Array<import('.').ComponentChildren>} [children] The children of the virtual node\r\n * @returns {import('./internal').VNode}\r\n */\r\nexport function createElement(type, props, children) {\r\n\tlet normalizedProps = {},\r\n\t\tkey,\r\n\t\tref,\r\n\t\ti;\r\n\tfor (i in props) {\r\n\t\tif (i == 'key') key = props[i];\r\n\t\telse if (i == 'ref') ref = props[i];\r\n\t\telse normalizedProps[i] = props[i];\r\n\t}\r\n\r\n\tif (arguments.length > 2) {\r\n\t\tnormalizedProps.children =\r\n\t\t\targuments.length > 3 ? slice.call(arguments, 2) : children;\r\n\t}\r\n\r\n\t// If a Component VNode, check for and apply defaultProps\r\n\t// Note: type may be undefined in development, must never error here.\r\n\tif (typeof type == 'function' && type.defaultProps != null) {\r\n\t\tfor (i in type.defaultProps) {\r\n\t\t\tif (normalizedProps[i] === undefined) {\r\n\t\t\t\tnormalizedProps[i] = type.defaultProps[i];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn createVNode(type, normalizedProps, key, ref, null);\r\n}\r\n\r\n/**\r\n * Create a VNode (used internally by Preact)\r\n * @param {import('./internal').VNode[\"type\"]} type The node name or Component\r\n * Constructor for this virtual node\r\n * @param {object | string | number | null} props The properties of this virtual node.\r\n * If this virtual node represents a text node, this is the text of the node (string or number).\r\n * @param {string | number | null} key The key for this virtual node, used when\r\n * diffing it against its children\r\n * @param {import('./internal').VNode[\"ref\"]} ref The ref property that will\r\n * receive a reference to its created child\r\n * @returns {import('./internal').VNode}\r\n */\r\nexport function createVNode(type, props, key, ref, original) {\r\n\t// V8 seems to be better at detecting type shapes if the object is allocated from the same call site\r\n\t// Do not inline into createElement and coerceToVNode!\r\n\tconst vnode = {\r\n\t\ttype,\r\n\t\tprops,\r\n\t\tkey,\r\n\t\tref,\r\n\t\t_children: null,\r\n\t\t_parent: null,\r\n\t\t_depth: 0,\r\n\t\t_dom: null,\r\n\t\t// _nextDom must be initialized to undefined b/c it will eventually\r\n\t\t// be set to dom.nextSibling which can return `null` and it is important\r\n\t\t// to be able to distinguish between an uninitialized _nextDom and\r\n\t\t// a _nextDom that has been set to `null`\r\n\t\t_nextDom: undefined,\r\n\t\t_component: null,\r\n\t\t_hydrating: null,\r\n\t\tconstructor: undefined,\r\n\t\t_original: original == null ? ++vnodeId : original\r\n\t};\r\n\r\n\t// Only invoke the vnode hook if this was *not* a direct copy:\r\n\tif (original == null && options.vnode != null) options.vnode(vnode);\r\n\r\n\treturn vnode;\r\n}\r\n\r\nexport function createRef() {\r\n\treturn { current: null };\r\n}\r\n\r\nexport function Fragment(props) {\r\n\treturn props.children;\r\n}\r\n\r\n/**\r\n * Check if a the argument is a valid Preact VNode.\r\n * @param {*} vnode\r\n * @returns {vnode is import('./internal').VNode}\r\n */\r\nexport const isValidElement = vnode =>\r\n\tvnode != null && vnode.constructor === undefined;\r\n","import { assign } from './util';\r\nimport { diff, commitRoot } from './diff/index';\r\nimport options from './options';\r\nimport { Fragment } from './create-element';\r\n\r\n/**\r\n * Base Component class. Provides `setState()` and `forceUpdate()`, which\r\n * trigger rendering\r\n * @param {object} props The initial component props\r\n * @param {object} context The initial context from parent components'\r\n * getChildContext\r\n */\r\nexport function Component(props, context) {\r\n\tthis.props = props;\r\n\tthis.context = context;\r\n}\r\n\r\n/**\r\n * Update component state and schedule a re-render.\r\n * @this {import('./internal').Component}\r\n * @param {object | ((s: object, p: object) => object)} update A hash of state\r\n * properties to update with new values or a function that given the current\r\n * state and props returns a new partial state\r\n * @param {() => void} [callback] A function to be called once component state is\r\n * updated\r\n */\r\nComponent.prototype.setState = function(update, callback) {\r\n\t// only clone state when copying to nextState the first time.\r\n\tlet s;\r\n\tif (this._nextState != null && this._nextState !== this.state) {\r\n\t\ts = this._nextState;\r\n\t} else {\r\n\t\ts = this._nextState = assign({}, this.state);\r\n\t}\r\n\r\n\tif (typeof update == 'function') {\r\n\t\t// Some libraries like `immer` mark the current state as readonly,\r\n\t\t// preventing us from mutating it, so we need to clone it. See #2716\r\n\t\tupdate = update(assign({}, s), this.props);\r\n\t}\r\n\r\n\tif (update) {\r\n\t\tassign(s, update);\r\n\t}\r\n\r\n\t// Skip update if updater function returned null\r\n\tif (update == null) return;\r\n\r\n\tif (this._vnode) {\r\n\t\tif (callback) this._renderCallbacks.push(callback);\r\n\t\tenqueueRender(this);\r\n\t}\r\n};\r\n\r\n/**\r\n * Immediately perform a synchronous re-render of the component\r\n * @this {import('./internal').Component}\r\n * @param {() => void} [callback] A function to be called after component is\r\n * re-rendered\r\n */\r\nComponent.prototype.forceUpdate = function(callback) {\r\n\tif (this._vnode) {\r\n\t\t// Set render mode so that we can differentiate where the render request\r\n\t\t// is coming from. We need this because forceUpdate should never call\r\n\t\t// shouldComponentUpdate\r\n\t\tthis._force = true;\r\n\t\tif (callback) this._renderCallbacks.push(callback);\r\n\t\tenqueueRender(this);\r\n\t}\r\n};\r\n\r\n/**\r\n * Accepts `props` and `state`, and returns a new Virtual DOM tree to build.\r\n * Virtual DOM is generally constructed via [JSX](http://jasonformat.com/wtf-is-jsx).\r\n * @param {object} props Props (eg: JSX attributes) received from parent\r\n * element/component\r\n * @param {object} state The component's current state\r\n * @param {object} context Context object, as returned by the nearest\r\n * ancestor's `getChildContext()`\r\n * @returns {import('./index').ComponentChildren | void}\r\n */\r\nComponent.prototype.render = Fragment;\r\n\r\n/**\r\n * @param {import('./internal').VNode} vnode\r\n * @param {number | null} [childIndex]\r\n */\r\nexport function getDomSibling(vnode, childIndex) {\r\n\tif (childIndex == null) {\r\n\t\t// Use childIndex==null as a signal to resume the search from the vnode's sibling\r\n\t\treturn vnode._parent\r\n\t\t\t? getDomSibling(vnode._parent, vnode._parent._children.indexOf(vnode) + 1)\r\n\t\t\t: null;\r\n\t}\r\n\r\n\tlet sibling;\r\n\tfor (; childIndex < vnode._children.length; childIndex++) {\r\n\t\tsibling = vnode._children[childIndex];\r\n\r\n\t\tif (sibling != null && sibling._dom != null) {\r\n\t\t\t// Since updateParentDomPointers keeps _dom pointer correct,\r\n\t\t\t// we can rely on _dom to tell us if this subtree contains a\r\n\t\t\t// rendered DOM node, and what the first rendered DOM node is\r\n\t\t\treturn sibling._dom;\r\n\t\t}\r\n\t}\r\n\r\n\t// If we get here, we have not found a DOM node in this vnode's children.\r\n\t// We must resume from this vnode's sibling (in it's parent _children array)\r\n\t// Only climb up and search the parent if we aren't searching through a DOM\r\n\t// VNode (meaning we reached the DOM parent of the original vnode that began\r\n\t// the search)\r\n\treturn typeof vnode.type == 'function' ? getDomSibling(vnode) : null;\r\n}\r\n\r\n/**\r\n * Trigger in-place re-rendering of a component.\r\n * @param {import('./internal').Component} component The component to rerender\r\n */\r\nfunction renderComponent(component) {\r\n\tlet vnode = component._vnode,\r\n\t\toldDom = vnode._dom,\r\n\t\tparentDom = component._parentDom;\r\n\r\n\tif (parentDom) {\r\n\t\tlet commitQueue = [];\r\n\t\tconst oldVNode = assign({}, vnode);\r\n\t\toldVNode._original = vnode._original + 1;\r\n\r\n\t\tdiff(\r\n\t\t\tparentDom,\r\n\t\t\tvnode,\r\n\t\t\toldVNode,\r\n\t\t\tcomponent._globalContext,\r\n\t\t\tparentDom.ownerSVGElement !== undefined,\r\n\t\t\tvnode._hydrating != null ? [oldDom] : null,\r\n\t\t\tcommitQueue,\r\n\t\t\toldDom == null ? getDomSibling(vnode) : oldDom,\r\n\t\t\tvnode._hydrating\r\n\t\t);\r\n\t\tcommitRoot(commitQueue, vnode);\r\n\r\n\t\tif (vnode._dom != oldDom) {\r\n\t\t\tupdateParentDomPointers(vnode);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * @param {import('./internal').VNode} vnode\r\n */\r\nfunction updateParentDomPointers(vnode) {\r\n\tif ((vnode = vnode._parent) != null && vnode._component != null) {\r\n\t\tvnode._dom = vnode._component.base = null;\r\n\t\tfor (let i = 0; i < vnode._children.length; i++) {\r\n\t\t\tlet child = vnode._children[i];\r\n\t\t\tif (child != null && child._dom != null) {\r\n\t\t\t\tvnode._dom = vnode._component.base = child._dom;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn updateParentDomPointers(vnode);\r\n\t}\r\n}\r\n\r\n/**\r\n * The render queue\r\n * @type {Array<import('./internal').Component>}\r\n */\r\nlet rerenderQueue = [];\r\n\r\n/**\r\n * Asynchronously schedule a callback\r\n * @type {(cb: () => void) => void}\r\n */\r\n/* istanbul ignore next */\r\n// Note the following line isn't tree-shaken by rollup cuz of rollup/rollup#2566\r\nconst defer =\r\n\ttypeof Promise == 'function'\r\n\t\t? Promise.prototype.then.bind(Promise.resolve())\r\n\t\t: setTimeout;\r\n\r\n/*\r\n * The value of `Component.debounce` must asynchronously invoke the passed in callback. It is\r\n * important that contributors to Preact can consistently reason about what calls to `setState`, etc.\r\n * do, and when their effects will be applied. See the links below for some further reading on designing\r\n * asynchronous APIs.\r\n * * [Designing APIs for Asynchrony](https://blog.izs.me/2013/08/designing-apis-for-asynchrony)\r\n * * [Callbacks synchronous and asynchronous](https://blog.ometer.com/2011/07/24/callbacks-synchronous-and-asynchronous/)\r\n */\r\n\r\nlet prevDebounce;\r\n\r\n/**\r\n * Enqueue a rerender of a component\r\n * @param {import('./internal').Component} c The component to rerender\r\n */\r\nexport function enqueueRender(c) {\r\n\tif (\r\n\t\t(!c._dirty &&\r\n\t\t\t(c._dirty = true) &&\r\n\t\t\trerenderQueue.push(c) &&\r\n\t\t\t!process._rerenderCount++) ||\r\n\t\tprevDebounce !== options.debounceRendering\r\n\t) {\r\n\t\tprevDebounce = options.debounceRendering;\r\n\t\t(prevDebounce || defer)(process);\r\n\t}\r\n}\r\n\r\n/** Flush the render queue by rerendering all queued components */\r\nfunction process() {\r\n\tlet queue;\r\n\twhile ((process._rerenderCount = rerenderQueue.length)) {\r\n\t\tqueue = rerenderQueue.sort((a, b) => a._vnode._depth - b._vnode._depth);\r\n\t\trerenderQueue = [];\r\n\t\t// Don't update `renderCount` yet. Keep its value non-zero to prevent unnecessary\r\n\t\t// process() calls from getting scheduled while `queue` is still being consumed.\r\n\t\tqueue.some(c => {\r\n\t\t\tif (c._dirty) renderComponent(c);\r\n\t\t});\r\n\t}\r\n}\r\nprocess._rerenderCount = 0;\r\n","import { diff, unmount, applyRef } from './index';\r\nimport { createVNode, Fragment } from '../create-element';\r\nimport { EMPTY_OBJ, EMPTY_ARR } from '../constants';\r\nimport { getDomSibling } from '../component';\r\n\r\n/**\r\n * Diff the children of a virtual node\r\n * @param {import('../internal').PreactElement} parentDom The DOM element whose\r\n * children are being diffed\r\n * @param {import('../internal').ComponentChildren[]} renderResult\r\n * @param {import('../internal').VNode} newParentVNode The new virtual\r\n * node whose children should be diff'ed against oldParentVNode\r\n * @param {import('../internal').VNode} oldParentVNode The old virtual\r\n * node whose children should be diff'ed against newParentVNode\r\n * @param {object} globalContext The current context object - modified by getChildContext\r\n * @param {boolean} isSvg Whether or not this DOM node is an SVG node\r\n * @param {Array<import('../internal').PreactElement>} excessDomChildren\r\n * @param {Array<import('../internal').Component>} commitQueue List of components\r\n * which have callbacks to invoke in commitRoot\r\n * @param {import('../internal').PreactElement} oldDom The current attached DOM\r\n * element any new dom elements should be placed around. Likely `null` on first\r\n * render (except when hydrating). Can be a sibling DOM element when diffing\r\n * Fragments that have siblings. In most cases, it starts out as `oldChildren[0]._dom`.\r\n * @param {boolean} isHydrating Whether or not we are in hydration\r\n */\r\nexport function diffChildren(\r\n\tparentDom,\r\n\trenderResult,\r\n\tnewParentVNode,\r\n\toldParentVNode,\r\n\tglobalContext,\r\n\tisSvg,\r\n\texcessDomChildren,\r\n\tcommitQueue,\r\n\toldDom,\r\n\tisHydrating\r\n) {\r\n\tlet i, j, oldVNode, childVNode, newDom, firstChildDom, refs;\r\n\r\n\t// This is a compression of oldParentVNode!=null && oldParentVNode != EMPTY_OBJ && oldParentVNode._children || EMPTY_ARR\r\n\t// as EMPTY_OBJ._children should be `undefined`.\r\n\tlet oldChildren = (oldParentVNode && oldParentVNode._children) || EMPTY_ARR;\r\n\r\n\tlet oldChildrenLength = oldChildren.length;\r\n\r\n\tnewParentVNode._children = [];\r\n\tfor (i = 0; i < renderResult.length; i++) {\r\n\t\tchildVNode = renderResult[i];\r\n\r\n\t\tif (childVNode == null || typeof childVNode == 'boolean') {\r\n\t\t\tchildVNode = newParentVNode._children[i] = null;\r\n\t\t}\r\n\t\t// If this newVNode is being reused (e.g. <div>{reuse}{reuse}</div>) in the same diff,\r\n\t\t// or we are rendering a component (e.g. setState) copy the oldVNodes so it can have\r\n\t\t// it's own DOM & etc. pointers\r\n\t\telse if (\r\n\t\t\ttypeof childVNode == 'string' ||\r\n\t\t\ttypeof childVNode == 'number' ||\r\n\t\t\t// eslint-disable-next-line valid-typeof\r\n\t\t\ttypeof childVNode == 'bigint'\r\n\t\t) {\r\n\t\t\tchildVNode = newParentVNode._children[i] = createVNode(\r\n\t\t\t\tnull,\r\n\t\t\t\tchildVNode,\r\n\t\t\t\tnull,\r\n\t\t\t\tnull,\r\n\t\t\t\tchildVNode\r\n\t\t\t);\r\n\t\t} else if (Array.isArray(childVNode)) {\r\n\t\t\tchildVNode = newParentVNode._children[i] = createVNode(\r\n\t\t\t\tFragment,\r\n\t\t\t\t{ children: childVNode },\r\n\t\t\t\tnull,\r\n\t\t\t\tnull,\r\n\t\t\t\tnull\r\n\t\t\t);\r\n\t\t} else if (childVNode._depth > 0) {\r\n\t\t\t// VNode is already in use, clone it. This can happen in the following\r\n\t\t\t// scenario:\r\n\t\t\t//   const reuse = <div />\r\n\t\t\t//   <div>{reuse}<span />{reuse}</div>\r\n\t\t\tchildVNode = newParentVNode._children[i] = createVNode(\r\n\t\t\t\tchildVNode.type,\r\n\t\t\t\tchildVNode.props,\r\n\t\t\t\tchildVNode.key,\r\n\t\t\t\tnull,\r\n\t\t\t\tchildVNode._original\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\tchildVNode = newParentVNode._children[i] = childVNode;\r\n\t\t}\r\n\r\n\t\t// Terser removes the `continue` here and wraps the loop body\r\n\t\t// in a `if (childVNode) { ... } condition\r\n\t\tif (childVNode == null) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\r\n\t\tchildVNode._parent = newParentVNode;\r\n\t\tchildVNode._depth = newParentVNode._depth + 1;\r\n\r\n\t\t// Check if we find a corresponding element in oldChildren.\r\n\t\t// If found, delete the array item by setting to `undefined`.\r\n\t\t// We use `undefined`, as `null` is reserved for empty placeholders\r\n\t\t// (holes).\r\n\t\toldVNode = oldChildren[i];\r\n\r\n\t\tif (\r\n\t\t\toldVNode === null ||\r\n\t\t\t(oldVNode &&\r\n\t\t\t\tchildVNode.key == oldVNode.key &&\r\n\t\t\t\tchildVNode.type === oldVNode.type)\r\n\t\t) {\r\n\t\t\toldChildren[i] = undefined;\r\n\t\t} else {\r\n\t\t\t// Either oldVNode === undefined or oldChildrenLength > 0,\r\n\t\t\t// so after this loop oldVNode == null or oldVNode is a valid value.\r\n\t\t\tfor (j = 0; j < oldChildrenLength; j++) {\r\n\t\t\t\toldVNode = oldChildren[j];\r\n\t\t\t\t// If childVNode is unkeyed, we only match similarly unkeyed nodes, otherwise we match by key.\r\n\t\t\t\t// We always match by type (in either case).\r\n\t\t\t\tif (\r\n\t\t\t\t\toldVNode &&\r\n\t\t\t\t\tchildVNode.key == oldVNode.key &&\r\n\t\t\t\t\tchildVNode.type === oldVNode.type\r\n\t\t\t\t) {\r\n\t\t\t\t\toldChildren[j] = undefined;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\toldVNode = null;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\toldVNode = oldVNode || EMPTY_OBJ;\r\n\r\n\t\t// Morph the old element into the new one, but don't append it to the dom yet\r\n\t\tdiff(\r\n\t\t\tparentDom,\r\n\t\t\tchildVNode,\r\n\t\t\toldVNode,\r\n\t\t\tglobalContext,\r\n\t\t\tisSvg,\r\n\t\t\texcessDomChildren,\r\n\t\t\tcommitQueue,\r\n\t\t\toldDom,\r\n\t\t\tisHydrating\r\n\t\t);\r\n\r\n\t\tnewDom = childVNode._dom;\r\n\r\n\t\tif ((j = childVNode.ref) && oldVNode.ref != j) {\r\n\t\t\tif (!refs) refs = [];\r\n\t\t\tif (oldVNode.ref) refs.push(oldVNode.ref, null, childVNode);\r\n\t\t\trefs.push(j, childVNode._component || newDom, childVNode);\r\n\t\t}\r\n\r\n\t\tif (newDom != null) {\r\n\t\t\tif (firstChildDom == null) {\r\n\t\t\t\tfirstChildDom = newDom;\r\n\t\t\t}\r\n\r\n\t\t\tif (\r\n\t\t\t\ttypeof childVNode.type == 'function' &&\r\n\t\t\t\tchildVNode._children === oldVNode._children\r\n\t\t\t) {\r\n\t\t\t\tchildVNode._nextDom = oldDom = reorderChildren(\r\n\t\t\t\t\tchildVNode,\r\n\t\t\t\t\toldDom,\r\n\t\t\t\t\tparentDom\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\toldDom = placeChild(\r\n\t\t\t\t\tparentDom,\r\n\t\t\t\t\tchildVNode,\r\n\t\t\t\t\toldVNode,\r\n\t\t\t\t\toldChildren,\r\n\t\t\t\t\tnewDom,\r\n\t\t\t\t\toldDom\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\tif (typeof newParentVNode.type == 'function') {\r\n\t\t\t\t// Because the newParentVNode is Fragment-like, we need to set it's\r\n\t\t\t\t// _nextDom property to the nextSibling of its last child DOM node.\r\n\t\t\t\t//\r\n\t\t\t\t// `oldDom` contains the correct value here because if the last child\r\n\t\t\t\t// is a Fragment-like, then oldDom has already been set to that child's _nextDom.\r\n\t\t\t\t// If the last child is a DOM VNode, then oldDom will be set to that DOM\r\n\t\t\t\t// node's nextSibling.\r\n\t\t\t\tnewParentVNode._nextDom = oldDom;\r\n\t\t\t}\r\n\t\t} else if (\r\n\t\t\toldDom &&\r\n\t\t\toldVNode._dom == oldDom &&\r\n\t\t\toldDom.parentNode != parentDom\r\n\t\t) {\r\n\t\t\t// The above condition is to handle null placeholders. See test in placeholder.test.js:\r\n\t\t\t// `efficiently replace null placeholders in parent rerenders`\r\n\t\t\toldDom = getDomSibling(oldVNode);\r\n\t\t}\r\n\t}\r\n\r\n\tnewParentVNode._dom = firstChildDom;\r\n\r\n\t// Remove remaining oldChildren if there are any.\r\n\tfor (i = oldChildrenLength; i--; ) {\r\n\t\tif (oldChildren[i] != null) {\r\n\t\t\tif (\r\n\t\t\t\ttypeof newParentVNode.type == 'function' &&\r\n\t\t\t\toldChildren[i]._dom != null &&\r\n\t\t\t\toldChildren[i]._dom == newParentVNode._nextDom\r\n\t\t\t) {\r\n\t\t\t\t// If the newParentVNode.__nextDom points to a dom node that is about to\r\n\t\t\t\t// be unmounted, then get the next sibling of that vnode and set\r\n\t\t\t\t// _nextDom to it\r\n\t\t\t\tnewParentVNode._nextDom = getDomSibling(oldParentVNode, i + 1);\r\n\t\t\t}\r\n\r\n\t\t\tunmount(oldChildren[i], oldChildren[i]);\r\n\t\t}\r\n\t}\r\n\r\n\t// Set refs only after unmount\r\n\tif (refs) {\r\n\t\tfor (i = 0; i < refs.length; i++) {\r\n\t\t\tapplyRef(refs[i], refs[++i], refs[++i]);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction reorderChildren(childVNode, oldDom, parentDom) {\r\n\t// Note: VNodes in nested suspended trees may be missing _children.\r\n\tlet c = childVNode._children;\r\n\tlet tmp = 0;\r\n\tfor (; c && tmp < c.length; tmp++) {\r\n\t\tlet vnode = c[tmp];\r\n\t\tif (vnode) {\r\n\t\t\t// We typically enter this code path on sCU bailout, where we copy\r\n\t\t\t// oldVNode._children to newVNode._children. If that is the case, we need\r\n\t\t\t// to update the old children's _parent pointer to point to the newVNode\r\n\t\t\t// (childVNode here).\r\n\t\t\tvnode._parent = childVNode;\r\n\r\n\t\t\tif (typeof vnode.type == 'function') {\r\n\t\t\t\toldDom = reorderChildren(vnode, oldDom, parentDom);\r\n\t\t\t} else {\r\n\t\t\t\toldDom = placeChild(\r\n\t\t\t\t\tparentDom,\r\n\t\t\t\t\tvnode,\r\n\t\t\t\t\tvnode,\r\n\t\t\t\t\tc,\r\n\t\t\t\t\tvnode._dom,\r\n\t\t\t\t\toldDom\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn oldDom;\r\n}\r\n\r\n/**\r\n * Flatten and loop through the children of a virtual node\r\n * @param {import('../index').ComponentChildren} children The unflattened\r\n * children of a virtual node\r\n * @returns {import('../internal').VNode[]}\r\n */\r\nexport function toChildArray(children, out) {\r\n\tout = out || [];\r\n\tif (children == null || typeof children == 'boolean') {\r\n\t} else if (Array.isArray(children)) {\r\n\t\tchildren.some(child => {\r\n\t\t\ttoChildArray(child, out);\r\n\t\t});\r\n\t} else {\r\n\t\tout.push(children);\r\n\t}\r\n\treturn out;\r\n}\r\n\r\nfunction placeChild(\r\n\tparentDom,\r\n\tchildVNode,\r\n\toldVNode,\r\n\toldChildren,\r\n\tnewDom,\r\n\toldDom\r\n) {\r\n\tlet nextDom;\r\n\tif (childVNode._nextDom !== undefined) {\r\n\t\t// Only Fragments or components that return Fragment like VNodes will\r\n\t\t// have a non-undefined _nextDom. Continue the diff from the sibling\r\n\t\t// of last DOM child of this child VNode\r\n\t\tnextDom = childVNode._nextDom;\r\n\r\n\t\t// Eagerly cleanup _nextDom. We don't need to persist the value because\r\n\t\t// it is only used by `diffChildren` to determine where to resume the diff after\r\n\t\t// diffing Components and Fragments. Once we store it the nextDOM local var, we\r\n\t\t// can clean up the property\r\n\t\tchildVNode._nextDom = undefined;\r\n\t} else if (\r\n\t\toldVNode == null ||\r\n\t\tnewDom != oldDom ||\r\n\t\tnewDom.parentNode == null\r\n\t) {\r\n\t\touter: if (oldDom == null || oldDom.parentNode !== parentDom) {\r\n\t\t\tparentDom.appendChild(newDom);\r\n\t\t\tnextDom = null;\r\n\t\t} else {\r\n\t\t\t// `j<oldChildrenLength; j+=2` is an alternative to `j++<oldChildrenLength/2`\r\n\t\t\tfor (\r\n\t\t\t\tlet sibDom = oldDom, j = 0;\r\n\t\t\t\t(sibDom = sibDom.nextSibling) && j < oldChildren.length;\r\n\t\t\t\tj += 2\r\n\t\t\t) {\r\n\t\t\t\tif (sibDom == newDom) {\r\n\t\t\t\t\tbreak outer;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tparentDom.insertBefore(newDom, oldDom);\r\n\t\t\tnextDom = oldDom;\r\n\t\t}\r\n\t}\r\n\r\n\t// If we have pre-calculated the nextDOM node, use it. Else calculate it now\r\n\t// Strictly check for `undefined` here cuz `null` is a valid value of `nextDom`.\r\n\t// See more detail in create-element.js:createVNode\r\n\tif (nextDom !== undefined) {\r\n\t\toldDom = nextDom;\r\n\t} else {\r\n\t\toldDom = newDom.nextSibling;\r\n\t}\r\n\r\n\treturn oldDom;\r\n}\r\n","import { IS_NON_DIMENSIONAL } from '../constants';\r\nimport options from '../options';\r\n\r\n/**\r\n * Diff the old and new properties of a VNode and apply changes to the DOM node\r\n * @param {import('../internal').PreactElement} dom The DOM node to apply\r\n * changes to\r\n * @param {object} newProps The new props\r\n * @param {object} oldProps The old props\r\n * @param {boolean} isSvg Whether or not this node is an SVG node\r\n * @param {boolean} hydrate Whether or not we are in hydration mode\r\n */\r\nexport function diffProps(dom, newProps, oldProps, isSvg, hydrate) {\r\n\tlet i;\r\n\r\n\tfor (i in oldProps) {\r\n\t\tif (i !== 'children' && i !== 'key' && !(i in newProps)) {\r\n\t\t\tsetProperty(dom, i, null, oldProps[i], isSvg);\r\n\t\t}\r\n\t}\r\n\r\n\tfor (i in newProps) {\r\n\t\tif (\r\n\t\t\t(!hydrate || typeof newProps[i] == 'function') &&\r\n\t\t\ti !== 'children' &&\r\n\t\t\ti !== 'key' &&\r\n\t\t\ti !== 'value' &&\r\n\t\t\ti !== 'checked' &&\r\n\t\t\toldProps[i] !== newProps[i]\r\n\t\t) {\r\n\t\t\tsetProperty(dom, i, newProps[i], oldProps[i], isSvg);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction setStyle(style, key, value) {\r\n\tif (key[0] === '-') {\r\n\t\tstyle.setProperty(key, value);\r\n\t} else if (value == null) {\r\n\t\tstyle[key] = '';\r\n\t} else if (typeof value != 'number' || IS_NON_DIMENSIONAL.test(key)) {\r\n\t\tstyle[key] = value;\r\n\t} else {\r\n\t\tstyle[key] = value + 'px';\r\n\t}\r\n}\r\n\r\n/**\r\n * Set a property value on a DOM node\r\n * @param {import('../internal').PreactElement} dom The DOM node to modify\r\n * @param {string} name The name of the property to set\r\n * @param {*} value The value to set the property to\r\n * @param {*} oldValue The old value the property had\r\n * @param {boolean} isSvg Whether or not this DOM node is an SVG node or not\r\n */\r\nexport function setProperty(dom, name, value, oldValue, isSvg) {\r\n\tlet useCapture;\r\n\r\n\to: if (name === 'style') {\r\n\t\tif (typeof value == 'string') {\r\n\t\t\tdom.style.cssText = value;\r\n\t\t} else {\r\n\t\t\tif (typeof oldValue == 'string') {\r\n\t\t\t\tdom.style.cssText = oldValue = '';\r\n\t\t\t}\r\n\r\n\t\t\tif (oldValue) {\r\n\t\t\t\tfor (name in oldValue) {\r\n\t\t\t\t\tif (!(value && name in value)) {\r\n\t\t\t\t\t\tsetStyle(dom.style, name, '');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (value) {\r\n\t\t\t\tfor (name in value) {\r\n\t\t\t\t\tif (!oldValue || value[name] !== oldValue[name]) {\r\n\t\t\t\t\t\tsetStyle(dom.style, name, value[name]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t// Benchmark for comparison: https://esbench.com/bench/574c954bdb965b9a00965ac6\r\n\telse if (name[0] === 'o' && name[1] === 'n') {\r\n\t\tuseCapture = name !== (name = name.replace(/Capture$/, ''));\r\n\r\n\t\t// Infer correct casing for DOM built-in events:\r\n\t\tif (name.toLowerCase() in dom) name = name.toLowerCase().slice(2);\r\n\t\telse name = name.slice(2);\r\n\r\n\t\tif (!dom._listeners) dom._listeners = {};\r\n\t\tdom._listeners[name + useCapture] = value;\r\n\r\n\t\tif (value) {\r\n\t\t\tif (!oldValue) {\r\n\t\t\t\tconst handler = useCapture ? eventProxyCapture : eventProxy;\r\n\t\t\t\tdom.addEventListener(name, handler, useCapture);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tconst handler = useCapture ? eventProxyCapture : eventProxy;\r\n\t\t\tdom.removeEventListener(name, handler, useCapture);\r\n\t\t}\r\n\t} else if (name !== 'dangerouslySetInnerHTML') {\r\n\t\tif (isSvg) {\r\n\t\t\t// Normalize incorrect prop usage for SVG:\r\n\t\t\t// - xlink:href / xlinkHref --> href (xlink:href was removed from SVG and isn't needed)\r\n\t\t\t// - className --> class\r\n\t\t\tname = name.replace(/xlink[H:h]/, 'h').replace(/sName$/, 's');\r\n\t\t} else if (\r\n\t\t\tname !== 'href' &&\r\n\t\t\tname !== 'list' &&\r\n\t\t\tname !== 'form' &&\r\n\t\t\t// Default value in browsers is `-1` and an empty string is\r\n\t\t\t// cast to `0` instead\r\n\t\t\tname !== 'tabIndex' &&\r\n\t\t\tname !== 'download' &&\r\n\t\t\tname in dom\r\n\t\t) {\r\n\t\t\ttry {\r\n\t\t\t\tdom[name] = value == null ? '' : value;\r\n\t\t\t\t// labelled break is 1b smaller here than a return statement (sorry)\r\n\t\t\t\tbreak o;\r\n\t\t\t} catch (e) {}\r\n\t\t}\r\n\r\n\t\t// ARIA-attributes have a different notion of boolean values.\r\n\t\t// The value `false` is different from the attribute not\r\n\t\t// existing on the DOM, so we can't remove it. For non-boolean\r\n\t\t// ARIA-attributes we could treat false as a removal, but the\r\n\t\t// amount of exceptions would cost us too many bytes. On top of\r\n\t\t// that other VDOM frameworks also always stringify `false`.\r\n\r\n\t\tif (typeof value === 'function') {\r\n\t\t\t// never serialize functions as attribute values\r\n\t\t} else if (\r\n\t\t\tvalue != null &&\r\n\t\t\t(value !== false || (name[0] === 'a' && name[1] === 'r'))\r\n\t\t) {\r\n\t\t\tdom.setAttribute(name, value);\r\n\t\t} else {\r\n\t\t\tdom.removeAttribute(name);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * Proxy an event to hooked event handlers\r\n * @param {Event} e The event object from the browser\r\n * @private\r\n */\r\nfunction eventProxy(e) {\r\n\tthis._listeners[e.type + false](options.event ? options.event(e) : e);\r\n}\r\n\r\nfunction eventProxyCapture(e) {\r\n\tthis._listeners[e.type + true](options.event ? options.event(e) : e);\r\n}\r\n","import { EMPTY_OBJ } from '../constants';\r\nimport { Component, getDomSibling } from '../component';\r\nimport { Fragment } from '../create-element';\r\nimport { diffChildren } from './children';\r\nimport { diffProps, setProperty } from './props';\r\nimport { assign, removeNode, slice } from '../util';\r\nimport options from '../options';\r\n\r\n/**\r\n * Diff two virtual nodes and apply proper changes to the DOM\r\n * @param {import('../internal').PreactElement} parentDom The parent of the DOM element\r\n * @param {import('../internal').VNode} newVNode The new virtual node\r\n * @param {import('../internal').VNode} oldVNode The old virtual node\r\n * @param {object} globalContext The current context object. Modified by getChildContext\r\n * @param {boolean} isSvg Whether or not this element is an SVG node\r\n * @param {Array<import('../internal').PreactElement>} excessDomChildren\r\n * @param {Array<import('../internal').Component>} commitQueue List of components\r\n * which have callbacks to invoke in commitRoot\r\n * @param {import('../internal').PreactElement} oldDom The current attached DOM\r\n * element any new dom elements should be placed around. Likely `null` on first\r\n * render (except when hydrating). Can be a sibling DOM element when diffing\r\n * Fragments that have siblings. In most cases, it starts out as `oldChildren[0]._dom`.\r\n * @param {boolean} [isHydrating] Whether or not we are in hydration\r\n */\r\nexport function diff(\r\n\tparentDom,\r\n\tnewVNode,\r\n\toldVNode,\r\n\tglobalContext,\r\n\tisSvg,\r\n\texcessDomChildren,\r\n\tcommitQueue,\r\n\toldDom,\r\n\tisHydrating\r\n) {\r\n\tlet tmp,\r\n\t\tnewType = newVNode.type;\r\n\r\n\t// When passing through createElement it assigns the object\r\n\t// constructor as undefined. This to prevent JSON-injection.\r\n\tif (newVNode.constructor !== undefined) return null;\r\n\r\n\t// If the previous diff bailed out, resume creating/hydrating.\r\n\tif (oldVNode._hydrating != null) {\r\n\t\tisHydrating = oldVNode._hydrating;\r\n\t\toldDom = newVNode._dom = oldVNode._dom;\r\n\t\t// if we resume, we want the tree to be \"unlocked\"\r\n\t\tnewVNode._hydrating = null;\r\n\t\texcessDomChildren = [oldDom];\r\n\t}\r\n\r\n\tif ((tmp = options._diff)) tmp(newVNode);\r\n\r\n\ttry {\r\n\t\touter: if (typeof newType == 'function') {\r\n\t\t\tlet c, isNew, oldProps, oldState, snapshot, clearProcessingException;\r\n\t\t\tlet newProps = newVNode.props;\r\n\r\n\t\t\t// Necessary for createContext api. Setting this property will pass\r\n\t\t\t// the context value as `this.context` just for this component.\r\n\t\t\ttmp = newType.contextType;\r\n\t\t\tlet provider = tmp && globalContext[tmp._id];\r\n\t\t\tlet componentContext = tmp\r\n\t\t\t\t? provider\r\n\t\t\t\t\t? provider.props.value\r\n\t\t\t\t\t: tmp._defaultValue\r\n\t\t\t\t: globalContext;\r\n\r\n\t\t\t// Get component and set it to `c`\r\n\t\t\tif (oldVNode._component) {\r\n\t\t\t\tc = newVNode._component = oldVNode._component;\r\n\t\t\t\tclearProcessingException = c._processingException = c._pendingError;\r\n\t\t\t} else {\r\n\t\t\t\t// Instantiate the new component\r\n\t\t\t\tif ('prototype' in newType && newType.prototype.render) {\r\n\t\t\t\t\t// @ts-ignore The check above verifies that newType is suppose to be constructed\r\n\t\t\t\t\tnewVNode._component = c = new newType(newProps, componentContext); // eslint-disable-line new-cap\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// @ts-ignore Trust me, Component implements the interface we want\r\n\t\t\t\t\tnewVNode._component = c = new Component(newProps, componentContext);\r\n\t\t\t\t\tc.constructor = newType;\r\n\t\t\t\t\tc.render = doRender;\r\n\t\t\t\t}\r\n\t\t\t\tif (provider) provider.sub(c);\r\n\r\n\t\t\t\tc.props = newProps;\r\n\t\t\t\tif (!c.state) c.state = {};\r\n\t\t\t\tc.context = componentContext;\r\n\t\t\t\tc._globalContext = globalContext;\r\n\t\t\t\tisNew = c._dirty = true;\r\n\t\t\t\tc._renderCallbacks = [];\r\n\t\t\t}\r\n\r\n\t\t\t// Invoke getDerivedStateFromProps\r\n\t\t\tif (c._nextState == null) {\r\n\t\t\t\tc._nextState = c.state;\r\n\t\t\t}\r\n\t\t\tif (newType.getDerivedStateFromProps != null) {\r\n\t\t\t\tif (c._nextState == c.state) {\r\n\t\t\t\t\tc._nextState = assign({}, c._nextState);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tassign(\r\n\t\t\t\t\tc._nextState,\r\n\t\t\t\t\tnewType.getDerivedStateFromProps(newProps, c._nextState)\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\toldProps = c.props;\r\n\t\t\toldState = c.state;\r\n\r\n\t\t\t// Invoke pre-render lifecycle methods\r\n\t\t\tif (isNew) {\r\n\t\t\t\tif (\r\n\t\t\t\t\tnewType.getDerivedStateFromProps == null &&\r\n\t\t\t\t\tc.componentWillMount != null\r\n\t\t\t\t) {\r\n\t\t\t\t\tc.componentWillMount();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (c.componentDidMount != null) {\r\n\t\t\t\t\tc._renderCallbacks.push(c.componentDidMount);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (\r\n\t\t\t\t\tnewType.getDerivedStateFromProps == null &&\r\n\t\t\t\t\tnewProps !== oldProps &&\r\n\t\t\t\t\tc.componentWillReceiveProps != null\r\n\t\t\t\t) {\r\n\t\t\t\t\tc.componentWillReceiveProps(newProps, componentContext);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (\r\n\t\t\t\t\t(!c._force &&\r\n\t\t\t\t\t\tc.shouldComponentUpdate != null &&\r\n\t\t\t\t\t\tc.shouldComponentUpdate(\r\n\t\t\t\t\t\t\tnewProps,\r\n\t\t\t\t\t\t\tc._nextState,\r\n\t\t\t\t\t\t\tcomponentContext\r\n\t\t\t\t\t\t) === false) ||\r\n\t\t\t\t\tnewVNode._original === oldVNode._original\r\n\t\t\t\t) {\r\n\t\t\t\t\tc.props = newProps;\r\n\t\t\t\t\tc.state = c._nextState;\r\n\t\t\t\t\t// More info about this here: https://gist.github.com/JoviDeCroock/bec5f2ce93544d2e6070ef8e0036e4e8\r\n\t\t\t\t\tif (newVNode._original !== oldVNode._original) c._dirty = false;\r\n\t\t\t\t\tc._vnode = newVNode;\r\n\t\t\t\t\tnewVNode._dom = oldVNode._dom;\r\n\t\t\t\t\tnewVNode._children = oldVNode._children;\r\n\t\t\t\t\tnewVNode._children.forEach(vnode => {\r\n\t\t\t\t\t\tif (vnode) vnode._parent = newVNode;\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif (c._renderCallbacks.length) {\r\n\t\t\t\t\t\tcommitQueue.push(c);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak outer;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (c.componentWillUpdate != null) {\r\n\t\t\t\t\tc.componentWillUpdate(newProps, c._nextState, componentContext);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (c.componentDidUpdate != null) {\r\n\t\t\t\t\tc._renderCallbacks.push(() => {\r\n\t\t\t\t\t\tc.componentDidUpdate(oldProps, oldState, snapshot);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tc.context = componentContext;\r\n\t\t\tc.props = newProps;\r\n\t\t\tc.state = c._nextState;\r\n\r\n\t\t\tif ((tmp = options._render)) tmp(newVNode);\r\n\r\n\t\t\tc._dirty = false;\r\n\t\t\tc._vnode = newVNode;\r\n\t\t\tc._parentDom = parentDom;\r\n\r\n\t\t\ttmp = c.render(c.props, c.state, c.context);\r\n\r\n\t\t\t// Handle setState called in render, see #2553\r\n\t\t\tc.state = c._nextState;\r\n\r\n\t\t\tif (c.getChildContext != null) {\r\n\t\t\t\tglobalContext = assign(assign({}, globalContext), c.getChildContext());\r\n\t\t\t}\r\n\r\n\t\t\tif (!isNew && c.getSnapshotBeforeUpdate != null) {\r\n\t\t\t\tsnapshot = c.getSnapshotBeforeUpdate(oldProps, oldState);\r\n\t\t\t}\r\n\r\n\t\t\tlet isTopLevelFragment =\r\n\t\t\t\ttmp != null && tmp.type === Fragment && tmp.key == null;\r\n\t\t\tlet renderResult = isTopLevelFragment ? tmp.props.children : tmp;\r\n\r\n\t\t\tdiffChildren(\r\n\t\t\t\tparentDom,\r\n\t\t\t\tArray.isArray(renderResult) ? renderResult : [renderResult],\r\n\t\t\t\tnewVNode,\r\n\t\t\t\toldVNode,\r\n\t\t\t\tglobalContext,\r\n\t\t\t\tisSvg,\r\n\t\t\t\texcessDomChildren,\r\n\t\t\t\tcommitQueue,\r\n\t\t\t\toldDom,\r\n\t\t\t\tisHydrating\r\n\t\t\t);\r\n\r\n\t\t\tc.base = newVNode._dom;\r\n\r\n\t\t\t// We successfully rendered this VNode, unset any stored hydration/bailout state:\r\n\t\t\tnewVNode._hydrating = null;\r\n\r\n\t\t\tif (c._renderCallbacks.length) {\r\n\t\t\t\tcommitQueue.push(c);\r\n\t\t\t}\r\n\r\n\t\t\tif (clearProcessingException) {\r\n\t\t\t\tc._pendingError = c._processingException = null;\r\n\t\t\t}\r\n\r\n\t\t\tc._force = false;\r\n\t\t} else if (\r\n\t\t\texcessDomChildren == null &&\r\n\t\t\tnewVNode._original === oldVNode._original\r\n\t\t) {\r\n\t\t\tnewVNode._children = oldVNode._children;\r\n\t\t\tnewVNode._dom = oldVNode._dom;\r\n\t\t} else {\r\n\t\t\tnewVNode._dom = diffElementNodes(\r\n\t\t\t\toldVNode._dom,\r\n\t\t\t\tnewVNode,\r\n\t\t\t\toldVNode,\r\n\t\t\t\tglobalContext,\r\n\t\t\t\tisSvg,\r\n\t\t\t\texcessDomChildren,\r\n\t\t\t\tcommitQueue,\r\n\t\t\t\tisHydrating\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tif ((tmp = options.diffed)) tmp(newVNode);\r\n\t} catch (e) {\r\n\t\tnewVNode._original = null;\r\n\t\t// if hydrating or creating initial tree, bailout preserves DOM:\r\n\t\tif (isHydrating || excessDomChildren != null) {\r\n\t\t\tnewVNode._dom = oldDom;\r\n\t\t\tnewVNode._hydrating = !!isHydrating;\r\n\t\t\texcessDomChildren[excessDomChildren.indexOf(oldDom)] = null;\r\n\t\t\t// ^ could possibly be simplified to:\r\n\t\t\t// excessDomChildren.length = 0;\r\n\t\t}\r\n\t\toptions._catchError(e, newVNode, oldVNode);\r\n\t}\r\n}\r\n\r\n/**\r\n * @param {Array<import('../internal').Component>} commitQueue List of components\r\n * which have callbacks to invoke in commitRoot\r\n * @param {import('../internal').VNode} root\r\n */\r\nexport function commitRoot(commitQueue, root) {\r\n\tif (options._commit) options._commit(root, commitQueue);\r\n\r\n\tcommitQueue.some(c => {\r\n\t\ttry {\r\n\t\t\t// @ts-ignore Reuse the commitQueue variable here so the type changes\r\n\t\t\tcommitQueue = c._renderCallbacks;\r\n\t\t\tc._renderCallbacks = [];\r\n\t\t\tcommitQueue.some(cb => {\r\n\t\t\t\t// @ts-ignore See above ts-ignore on commitQueue\r\n\t\t\t\tcb.call(c);\r\n\t\t\t});\r\n\t\t} catch (e) {\r\n\t\t\toptions._catchError(e, c._vnode);\r\n\t\t}\r\n\t});\r\n}\r\n\r\n/**\r\n * Diff two virtual nodes representing DOM element\r\n * @param {import('../internal').PreactElement} dom The DOM element representing\r\n * the virtual nodes being diffed\r\n * @param {import('../internal').VNode} newVNode The new virtual node\r\n * @param {import('../internal').VNode} oldVNode The old virtual node\r\n * @param {object} globalContext The current context object\r\n * @param {boolean} isSvg Whether or not this DOM node is an SVG node\r\n * @param {*} excessDomChildren\r\n * @param {Array<import('../internal').Component>} commitQueue List of components\r\n * which have callbacks to invoke in commitRoot\r\n * @param {boolean} isHydrating Whether or not we are in hydration\r\n * @returns {import('../internal').PreactElement}\r\n */\r\nfunction diffElementNodes(\r\n\tdom,\r\n\tnewVNode,\r\n\toldVNode,\r\n\tglobalContext,\r\n\tisSvg,\r\n\texcessDomChildren,\r\n\tcommitQueue,\r\n\tisHydrating\r\n) {\r\n\tlet oldProps = oldVNode.props;\r\n\tlet newProps = newVNode.props;\r\n\tlet nodeType = newVNode.type;\r\n\tlet i = 0;\r\n\r\n\t// Tracks entering and exiting SVG namespace when descending through the tree.\r\n\tif (nodeType === 'svg') isSvg = true;\r\n\r\n\tif (excessDomChildren != null) {\r\n\t\tfor (; i < excessDomChildren.length; i++) {\r\n\t\t\tconst child = excessDomChildren[i];\r\n\r\n\t\t\t// if newVNode matches an element in excessDomChildren or the `dom`\r\n\t\t\t// argument matches an element in excessDomChildren, remove it from\r\n\t\t\t// excessDomChildren so it isn't later removed in diffChildren\r\n\t\t\tif (\r\n\t\t\t\tchild &&\r\n\t\t\t\t'setAttribute' in child === !!nodeType &&\r\n\t\t\t\t(nodeType ? child.localName === nodeType : child.nodeType === 3)\r\n\t\t\t) {\r\n\t\t\t\tdom = child;\r\n\t\t\t\texcessDomChildren[i] = null;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tif (dom == null) {\r\n\t\tif (nodeType === null) {\r\n\t\t\t// @ts-ignore createTextNode returns Text, we expect PreactElement\r\n\t\t\treturn document.createTextNode(newProps);\r\n\t\t}\r\n\r\n\t\tif (isSvg) {\r\n\t\t\tdom = document.createElementNS(\r\n\t\t\t\t'http://www.w3.org/2000/svg',\r\n\t\t\t\t// @ts-ignore We know `newVNode.type` is a string\r\n\t\t\t\tnodeType\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\tdom = document.createElement(\r\n\t\t\t\t// @ts-ignore We know `newVNode.type` is a string\r\n\t\t\t\tnodeType,\r\n\t\t\t\tnewProps.is && newProps\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\t// we created a new parent, so none of the previously attached children can be reused:\r\n\t\texcessDomChildren = null;\r\n\t\t// we are creating a new node, so we can assume this is a new subtree (in case we are hydrating), this deopts the hydrate\r\n\t\tisHydrating = false;\r\n\t}\r\n\r\n\tif (nodeType === null) {\r\n\t\t// During hydration, we still have to split merged text from SSR'd HTML.\r\n\t\tif (oldProps !== newProps && (!isHydrating || dom.data !== newProps)) {\r\n\t\t\tdom.data = newProps;\r\n\t\t}\r\n\t} else {\r\n\t\t// If excessDomChildren was not null, repopulate it with the current element's children:\r\n\t\texcessDomChildren = excessDomChildren && slice.call(dom.childNodes);\r\n\r\n\t\toldProps = oldVNode.props || EMPTY_OBJ;\r\n\r\n\t\tlet oldHtml = oldProps.dangerouslySetInnerHTML;\r\n\t\tlet newHtml = newProps.dangerouslySetInnerHTML;\r\n\r\n\t\t// During hydration, props are not diffed at all (including dangerouslySetInnerHTML)\r\n\t\t// @TODO we should warn in debug mode when props don't match here.\r\n\t\tif (!isHydrating) {\r\n\t\t\t// But, if we are in a situation where we are using existing DOM (e.g. replaceNode)\r\n\t\t\t// we should read the existing DOM attributes to diff them\r\n\t\t\tif (excessDomChildren != null) {\r\n\t\t\t\toldProps = {};\r\n\t\t\t\tfor (i = 0; i < dom.attributes.length; i++) {\r\n\t\t\t\t\toldProps[dom.attributes[i].name] = dom.attributes[i].value;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (newHtml || oldHtml) {\r\n\t\t\t\t// Avoid re-applying the same '__html' if it did not changed between re-render\r\n\t\t\t\tif (\r\n\t\t\t\t\t!newHtml ||\r\n\t\t\t\t\t((!oldHtml || newHtml.__html != oldHtml.__html) &&\r\n\t\t\t\t\t\tnewHtml.__html !== dom.innerHTML)\r\n\t\t\t\t) {\r\n\t\t\t\t\tdom.innerHTML = (newHtml && newHtml.__html) || '';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tdiffProps(dom, newProps, oldProps, isSvg, isHydrating);\r\n\r\n\t\t// If the new vnode didn't have dangerouslySetInnerHTML, diff its children\r\n\t\tif (newHtml) {\r\n\t\t\tnewVNode._children = [];\r\n\t\t} else {\r\n\t\t\ti = newVNode.props.children;\r\n\t\t\tdiffChildren(\r\n\t\t\t\tdom,\r\n\t\t\t\tArray.isArray(i) ? i : [i],\r\n\t\t\t\tnewVNode,\r\n\t\t\t\toldVNode,\r\n\t\t\t\tglobalContext,\r\n\t\t\t\tisSvg && nodeType !== 'foreignObject',\r\n\t\t\t\texcessDomChildren,\r\n\t\t\t\tcommitQueue,\r\n\t\t\t\texcessDomChildren\r\n\t\t\t\t\t? excessDomChildren[0]\r\n\t\t\t\t\t: oldVNode._children && getDomSibling(oldVNode, 0),\r\n\t\t\t\tisHydrating\r\n\t\t\t);\r\n\r\n\t\t\t// Remove children that are not part of any vnode.\r\n\t\t\tif (excessDomChildren != null) {\r\n\t\t\t\tfor (i = excessDomChildren.length; i--; ) {\r\n\t\t\t\t\tif (excessDomChildren[i] != null) removeNode(excessDomChildren[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// (as above, don't diff props during hydration)\r\n\t\tif (!isHydrating) {\r\n\t\t\tif (\r\n\t\t\t\t'value' in newProps &&\r\n\t\t\t\t(i = newProps.value) !== undefined &&\r\n\t\t\t\t// #2756 For the <progress>-element the initial value is 0,\r\n\t\t\t\t// despite the attribute not being present. When the attribute\r\n\t\t\t\t// is missing the progress bar is treated as indeterminate.\r\n\t\t\t\t// To fix that we'll always update it when it is 0 for progress elements\r\n\t\t\t\t(i !== oldProps.value ||\r\n\t\t\t\t\ti !== dom.value ||\r\n\t\t\t\t\t(nodeType === 'progress' && !i))\r\n\t\t\t) {\r\n\t\t\t\tsetProperty(dom, 'value', i, oldProps.value, false);\r\n\t\t\t}\r\n\t\t\tif (\r\n\t\t\t\t'checked' in newProps &&\r\n\t\t\t\t(i = newProps.checked) !== undefined &&\r\n\t\t\t\ti !== dom.checked\r\n\t\t\t) {\r\n\t\t\t\tsetProperty(dom, 'checked', i, oldProps.checked, false);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn dom;\r\n}\r\n\r\n/**\r\n * Invoke or update a ref, depending on whether it is a function or object ref.\r\n * @param {object|function} ref\r\n * @param {any} value\r\n * @param {import('../internal').VNode} vnode\r\n */\r\nexport function applyRef(ref, value, vnode) {\r\n\ttry {\r\n\t\tif (typeof ref == 'function') ref(value);\r\n\t\telse ref.current = value;\r\n\t} catch (e) {\r\n\t\toptions._catchError(e, vnode);\r\n\t}\r\n}\r\n\r\n/**\r\n * Unmount a virtual node from the tree and apply DOM changes\r\n * @param {import('../internal').VNode} vnode The virtual node to unmount\r\n * @param {import('../internal').VNode} parentVNode The parent of the VNode that\r\n * initiated the unmount\r\n * @param {boolean} [skipRemove] Flag that indicates that a parent node of the\r\n * current element is already detached from the DOM.\r\n */\r\nexport function unmount(vnode, parentVNode, skipRemove) {\r\n\tlet r;\r\n\tif (options.unmount) options.unmount(vnode);\r\n\r\n\tif ((r = vnode.ref)) {\r\n\t\tif (!r.current || r.current === vnode._dom) applyRef(r, null, parentVNode);\r\n\t}\r\n\r\n\tif ((r = vnode._component) != null) {\r\n\t\tif (r.componentWillUnmount) {\r\n\t\t\ttry {\r\n\t\t\t\tr.componentWillUnmount();\r\n\t\t\t} catch (e) {\r\n\t\t\t\toptions._catchError(e, parentVNode);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tr.base = r._parentDom = null;\r\n\t}\r\n\r\n\tif ((r = vnode._children)) {\r\n\t\tfor (let i = 0; i < r.length; i++) {\r\n\t\t\tif (r[i]) {\r\n\t\t\t\tunmount(r[i], parentVNode, typeof vnode.type != 'function');\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tif (!skipRemove && vnode._dom != null) removeNode(vnode._dom);\r\n\r\n\t// Must be set to `undefined` to properly clean up `_nextDom`\r\n\t// for which `null` is a valid value. See comment in `create-element.js`\r\n\tvnode._dom = vnode._nextDom = undefined;\r\n}\r\n\r\n/** The `.render()` method for a PFC backing instance. */\r\nfunction doRender(props, state, context) {\r\n\treturn this.constructor(props, context);\r\n}\r\n","import { EMPTY_OBJ } from './constants';\r\nimport { commitRoot, diff } from './diff/index';\r\nimport { createElement, Fragment } from './create-element';\r\nimport options from './options';\r\nimport { slice } from './util';\r\n\r\n/**\r\n * Render a Preact virtual node into a DOM element\r\n * @param {import('./internal').ComponentChild} vnode The virtual node to render\r\n * @param {import('./internal').PreactElement} parentDom The DOM element to\r\n * render into\r\n * @param {import('./internal').PreactElement | object} [replaceNode] Optional: Attempt to re-use an\r\n * existing DOM tree rooted at `replaceNode`\r\n */\r\nexport function render(vnode, parentDom, replaceNode) {\r\n\tif (options._root) options._root(vnode, parentDom);\r\n\r\n\t// We abuse the `replaceNode` parameter in `hydrate()` to signal if we are in\r\n\t// hydration mode or not by passing the `hydrate` function instead of a DOM\r\n\t// element..\r\n\tlet isHydrating = typeof replaceNode === 'function';\r\n\r\n\t// To be able to support calling `render()` multiple times on the same\r\n\t// DOM node, we need to obtain a reference to the previous tree. We do\r\n\t// this by assigning a new `_children` property to DOM nodes which points\r\n\t// to the last rendered tree. By default this property is not present, which\r\n\t// means that we are mounting a new tree for the first time.\r\n\tlet oldVNode = isHydrating\r\n\t\t? null\r\n\t\t: (replaceNode && replaceNode._children) || parentDom._children;\r\n\r\n\tvnode = (\r\n\t\t(!isHydrating && replaceNode) ||\r\n\t\tparentDom\r\n\t)._children = createElement(Fragment, null, [vnode]);\r\n\r\n\t// List of effects that need to be called after diffing.\r\n\tlet commitQueue = [];\r\n\tdiff(\r\n\t\tparentDom,\r\n\t\t// Determine the new vnode tree and store it on the DOM element on\r\n\t\t// our custom `_children` property.\r\n\t\tvnode,\r\n\t\toldVNode || EMPTY_OBJ,\r\n\t\tEMPTY_OBJ,\r\n\t\tparentDom.ownerSVGElement !== undefined,\r\n\t\t!isHydrating && replaceNode\r\n\t\t\t? [replaceNode]\r\n\t\t\t: oldVNode\r\n\t\t\t? null\r\n\t\t\t: parentDom.firstChild\r\n\t\t\t? slice.call(parentDom.childNodes)\r\n\t\t\t: null,\r\n\t\tcommitQueue,\r\n\t\t!isHydrating && replaceNode\r\n\t\t\t? replaceNode\r\n\t\t\t: oldVNode\r\n\t\t\t? oldVNode._dom\r\n\t\t\t: parentDom.firstChild,\r\n\t\tisHydrating\r\n\t);\r\n\r\n\t// Flush all queued effects\r\n\tcommitRoot(commitQueue, vnode);\r\n}\r\n\r\n/**\r\n * Update an existing DOM element with data from a Preact virtual node\r\n * @param {import('./internal').ComponentChild} vnode The virtual node to render\r\n * @param {import('./internal').PreactElement} parentDom The DOM element to\r\n * update\r\n */\r\nexport function hydrate(vnode, parentDom) {\r\n\trender(vnode, parentDom, hydrate);\r\n}\r\n","import { assign, slice } from './util';\r\nimport { createVNode } from './create-element';\r\n\r\n/**\r\n * Clones the given VNode, optionally adding attributes/props and replacing its children.\r\n * @param {import('./internal').VNode} vnode The virtual DOM element to clone\r\n * @param {object} props Attributes/props to add when cloning\r\n * @param {Array<import('./internal').ComponentChildren>} rest Any additional arguments will be used as replacement children.\r\n * @returns {import('./internal').VNode}\r\n */\r\nexport function cloneElement(vnode, props, children) {\r\n\tlet normalizedProps = assign({}, vnode.props),\r\n\t\tkey,\r\n\t\tref,\r\n\t\ti;\r\n\tfor (i in props) {\r\n\t\tif (i == 'key') key = props[i];\r\n\t\telse if (i == 'ref') ref = props[i];\r\n\t\telse normalizedProps[i] = props[i];\r\n\t}\r\n\r\n\tif (arguments.length > 2) {\r\n\t\tnormalizedProps.children =\r\n\t\t\targuments.length > 3 ? slice.call(arguments, 2) : children;\r\n\t}\r\n\r\n\treturn createVNode(\r\n\t\tvnode.type,\r\n\t\tnormalizedProps,\r\n\t\tkey || vnode.key,\r\n\t\tref || vnode.ref,\r\n\t\tnull\r\n\t);\r\n}\r\n","import { enqueueRender } from './component';\r\n\r\nexport let i = 0;\r\n\r\nexport function createContext(defaultValue, contextId) {\r\n\tcontextId = '__cC' + i++;\r\n\r\n\tconst context = {\r\n\t\t_id: contextId,\r\n\t\t_defaultValue: defaultValue,\r\n\t\t/** @type {import('./internal').FunctionComponent} */\r\n\t\tConsumer(props, contextValue) {\r\n\t\t\t// return props.children(\r\n\t\t\t// \tcontext[contextId] ? context[contextId].props.value : defaultValue\r\n\t\t\t// );\r\n\t\t\treturn props.children(contextValue);\r\n\t\t},\r\n\t\t/** @type {import('./internal').FunctionComponent} */\r\n\t\tProvider(props) {\r\n\t\t\tif (!this.getChildContext) {\r\n\t\t\t\tlet subs = [];\r\n\t\t\t\tlet ctx = {};\r\n\t\t\t\tctx[contextId] = this;\r\n\r\n\t\t\t\tthis.getChildContext = () => ctx;\r\n\r\n\t\t\t\tthis.shouldComponentUpdate = function(_props) {\r\n\t\t\t\t\tif (this.props.value !== _props.value) {\r\n\t\t\t\t\t\t// I think the forced value propagation here was only needed when `options.debounceRendering` was being bypassed:\r\n\t\t\t\t\t\t// https://github.com/preactjs/preact/commit/4d339fb803bea09e9f198abf38ca1bf8ea4b7771#diff-54682ce380935a717e41b8bfc54737f6R358\r\n\t\t\t\t\t\t// In those cases though, even with the value corrected, we're double-rendering all nodes.\r\n\t\t\t\t\t\t// It might be better to just tell folks not to use force-sync mode.\r\n\t\t\t\t\t\t// Currently, using `useContext()` in a class component will overwrite its `this.context` value.\r\n\t\t\t\t\t\t// subs.some(c => {\r\n\t\t\t\t\t\t// \tc.context = _props.value;\r\n\t\t\t\t\t\t// \tenqueueRender(c);\r\n\t\t\t\t\t\t// });\r\n\r\n\t\t\t\t\t\t// subs.some(c => {\r\n\t\t\t\t\t\t// \tc.context[contextId] = _props.value;\r\n\t\t\t\t\t\t// \tenqueueRender(c);\r\n\t\t\t\t\t\t// });\r\n\t\t\t\t\t\tsubs.some(enqueueRender);\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\r\n\t\t\t\tthis.sub = c => {\r\n\t\t\t\t\tsubs.push(c);\r\n\t\t\t\t\tlet old = c.componentWillUnmount;\r\n\t\t\t\t\tc.componentWillUnmount = () => {\r\n\t\t\t\t\t\tsubs.splice(subs.indexOf(c), 1);\r\n\t\t\t\t\t\tif (old) old.call(c);\r\n\t\t\t\t\t};\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\treturn props.children;\r\n\t\t}\r\n\t};\r\n\r\n\t// Devtools needs access to the context object when it\r\n\t// encounters a Provider. This is necessary to support\r\n\t// setting `displayName` on the context object instead\r\n\t// of on the component itself. See:\r\n\t// https://reactjs.org/docs/context.html#contextdisplayname\r\n\r\n\treturn (context.Provider._contextRef = context.Consumer.contextType = context);\r\n}\r\n","export const EMPTY_OBJ = {};\r\nexport const EMPTY_ARR = [];\r\nexport const IS_NON_DIMENSIONAL = /acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;\r\n","import { _catchError } from './diff/catch-error';\r\n\r\n/**\r\n * The `option` object can potentially contain callback functions\r\n * that are called during various stages of our renderer. This is the\r\n * foundation on which all our addons like `preact/debug`, `preact/compat`,\r\n * and `preact/hooks` are based on. See the `Options` type in `internal.d.ts`\r\n * for a full list of available option hooks (most editors/IDEs allow you to\r\n * ctrl+click or cmd+click on mac the type definition below).\r\n * @type {import('./internal').Options}\r\n */\r\nconst options = {\r\n\t_catchError\r\n};\r\n\r\nexport default options;\r\n","/**\r\n * Find the closest error boundary to a thrown error and call it\r\n * @param {object} error The thrown value\r\n * @param {import('../internal').VNode} vnode The vnode that threw\r\n * the error that was caught (except for unmounting when this parameter\r\n * is the highest parent that was being unmounted)\r\n */\r\nexport function _catchError(error, vnode) {\r\n\t/** @type {import('../internal').Component} */\r\n\tlet component, ctor, handled;\r\n\r\n\tfor (; (vnode = vnode._parent); ) {\r\n\t\tif ((component = vnode._component) && !component._processingException) {\r\n\t\t\ttry {\r\n\t\t\t\tctor = component.constructor;\r\n\r\n\t\t\t\tif (ctor && ctor.getDerivedStateFromError != null) {\r\n\t\t\t\t\tcomponent.setState(ctor.getDerivedStateFromError(error));\r\n\t\t\t\t\thandled = component._dirty;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (component.componentDidCatch != null) {\r\n\t\t\t\t\tcomponent.componentDidCatch(error);\r\n\t\t\t\t\thandled = component._dirty;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// This is an error boundary. Mark it as having bailed out, and whether it was mid-hydration.\r\n\t\t\t\tif (handled) {\r\n\t\t\t\t\treturn (component._pendingError = component);\r\n\t\t\t\t}\r\n\t\t\t} catch (e) {\r\n\t\t\t\terror = e;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tthrow error;\r\n}\r\n","import { Component, ComponentChild, Fragment, h } from \"preact\";\nimport { mutate, subscribe } from \"../../store/store\";\nimport { open, redo, reset_camera, save_as, subset_construct, undo } from \"./actions\";\nimport { State, StateKey } from \"../../types\";\nimport { export_to_svg } from \"../../export_as/svg\";\nimport { export_to_latex } from \"../../export_as/latex\";\nimport { export_to_png } from \"../../export_as/png\";\n\ntype ActionProps = {\n    text: string,\n    icon: string,\n    handle_click: (state: State) => StateKey[] | undefined,\n};\n\nexport class ActionBar extends Component {\n    constructor() {\n        super();\n        subscribe(['can'], this);\n    }\n\n    render(): ComponentChild {\n        return (<>\n            <div>Actions:</div>\n            <div style='display: flex; flex-direction: row; flex-wrap: wrap;'>\n                <Action text='Undo' icon='' handle_click={undo} />\n                <Action text='Redo' icon='' handle_click={redo} />\n                <Action text='Subset Construction' icon='' handle_click={subset_construct} />\n                <Action text='Save' icon='' handle_click={save_as} />\n                <Action text='Load' icon='' handle_click={open} />\n                <Action text='Reset Cam' icon='' handle_click={reset_camera} />\n                <Action text='Save PNG' icon='' handle_click={export_to_png} />\n                <Action text='Save SVG' icon='' handle_click={export_to_svg} />\n                <Action text='Copy LaTeX' icon='' handle_click={export_to_latex} />\n            </div>\n        </>);\n    }\n}\n\nclass Action extends Component<ActionProps> {\n    constructor(props: ActionProps) {\n        super(props);\n    }\n\n    render(): ComponentChild {\n        return (\n            <div\n                onClick={e => mutate(this.props.handle_click)}\n\n            >{this.props.text}</div>\n        );\n    }\n}","export const NODE_RADIUS = 30;\nexport const SNAP_TO_PADDING = 6; // pixels\nexport const HIT_TARGET_PADDING = 6; // pixels\nexport const CANVAS_PADDING = 30;\nexport const CANVAS_SIZE = { x: 800, y: 600 };\nexport const STANDARD_COLOUR = 'black';\nexport const SELECTED_COLOUR = 'blue';\nexport const ACTIVE_COLOUR = 'green';\n","import { FSMLink } from \"../components/elements/abstract\";\nimport { NodeLink } from \"../components/elements/node_link\";\nimport { SelfLink } from \"../components/elements/self_link\";\nimport { StartLink } from \"../components/elements/start_link\";\nimport { StateNode } from \"../components/elements/state_node\";\nimport { Backup, BackupLink, BackupNode, CanvasJSON, FSMCanvasState, State, StateKey } from \"../types\";\n\n\n/**\n * Save the current canvas to localStorage.\n */\nexport function effect_save_backup(curr: State) {\n    if (typeof window != 'undefined')\n        if (localStorage && JSON)\n            localStorage['fsm'] = canvas_to_string(curr);\n}\n\n/**\n * Load the canvas from localStorage.\n */\nexport function restore_backup(state: State): StateKey[] | undefined {\n    if (typeof window != 'undefined') {\n        if (!localStorage || !JSON) {\n            return;\n        }\n\n        try {\n            const storage = localStorage.getItem(\"fsm\");\n            if (storage != null) {\n                const next_state = string_to_canvas(storage);\n                state.nodes = next_state.nodes;\n                state.links = next_state.links;\n            }\n\n        } catch (error) {\n            localStorage['fsm'] = \"\";\n        }\n\n        return ['nodes', 'links'];\n    }\n}\n\n/**\n * Get the node and link elements corresponding to the given json string.\n */\nexport function string_to_canvas(json: CanvasJSON): FSMCanvasState {\n    const nodes: StateNode[] = [];\n    const links: FSMLink[] = [];\n\n    if (!JSON) {\n        return { nodes, links };\n    }\n\n    const backup = JSON.parse(json);\n\n    for (let i = 0; i < backup.nodes.length; i++) {\n        const backupNode: BackupNode = backup.nodes[i];\n        const node = new StateNode(backupNode.x, backupNode.y);\n        node.isAcceptState = backupNode.isAcceptState;\n        node.text = backupNode.text;\n        nodes.push(node);\n    }\n\n    for (let i = 0; i < backup.links.length; i++) {\n        const backupLink: BackupLink = backup.links[i];\n        let link = null;\n        if (backupLink.type == 'SelfLink') {\n            link = new SelfLink(nodes[backupLink.node]);\n            link.anchorAngle = backupLink.anchorAngle;\n            link.text = backupLink.text;\n        } else if (backupLink.type == 'StartLink') {\n            link = new StartLink(nodes[backupLink.node]);\n            link.deltaX = backupLink.deltaX;\n            link.deltaY = backupLink.deltaY;\n            link.text = backupLink.text;\n        } else if (backupLink.type == 'NodeLink' || backupLink.type == 'Link') {\n            link = new NodeLink(nodes[backupLink.nodeA], nodes[backupLink.nodeB]);\n            link.parallelPart = backupLink.parallelPart;\n            link.perpendicularPart = backupLink.perpendicularPart;\n            link.text = backupLink.text;\n            link.lineAngleAdjust = backupLink.lineAngleAdjust;\n        }\n        if (link != null) {\n            links.push(link);\n        }\n    }\n\n    return { nodes, links };\n}\n\n/**\n * Convert the current canvas state to a JSON string.\n * @returns The string representation of the current canvas.\n */\nexport function canvas_to_string(state: State): CanvasJSON {\n    if (!JSON) {\n        return \"\";\n    }\n\n    const nodes = state.nodes;\n    const links = state.links;\n\n    const backup: Backup = {\n        nodes: [],\n        links: [],\n    };\n    for (let i = 0; i < nodes.length; i++) {\n        const node = nodes[i];\n        let backup_node = {\n            x: node.x,\n            y: node.y,\n            text: node.text,\n            isAcceptState: node.isAcceptState,\n        };\n        backup.nodes.push(backup_node);\n    }\n    for (let i = 0; i < links.length; i++) {\n        const link = links[i];\n        let backup_link: BackupLink | undefined = undefined;\n        if (link instanceof SelfLink) {\n            backup_link = {\n                type: 'SelfLink',\n                node: nodes.indexOf(link.node),\n                text: link.text,\n                anchorAngle: link.anchorAngle,\n            };\n        } else if (link instanceof StartLink) {\n            backup_link = {\n                type: 'StartLink',\n                node: nodes.indexOf(link.node),\n                text: link.text,\n                deltaX: link.deltaX,\n                deltaY: link.deltaY,\n            };\n        } else if (link instanceof NodeLink) {\n            backup_link = {\n                type: 'NodeLink',\n                nodeA: nodes.indexOf(link.nodeA),\n                nodeB: nodes.indexOf(link.nodeB),\n                text: link.text,\n                lineAngleAdjust: link.lineAngleAdjust,\n                parallelPart: link.parallelPart,\n                perpendicularPart: link.perpendicularPart,\n            };\n        }\n        if (backup_link != null) {\n            backup.links.push(backup_link);\n        }\n    }\n\n    return JSON.stringify(backup);\n}"],"sourceRoot":""}